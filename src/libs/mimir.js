!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Mimir",[],t):"object"==typeof exports?exports.Mimir=t():e.Mimir=t()}(this,(()=>(()=>{var e={436:(e,t,n)=>{"use strict";n.d(t,{c:()=>d});var i=n(500),o=n.n(i),s=n(312),r=n.n(s),a=n(276),l=r()(o());l.i(a.c),l.push([e.id,"/* Mimir core styles. */\n\n#mimir-body-container {\n    overflow-y: auto;\n    border: 1px solid silver;\n    padding: 10px;\n    margin-left: auto;\n    margin-right: auto;\n    overflow-x: visible;\n    width: fit-content;\n}\n\n#mimir-body {\n    white-space: pre-wrap;\n    word-wrap: break-word;\n}\n\n#mimir-body:focus {\n    outline: none;\n}\n\n#mimir-body p, div, br {\n    margin: 0;\n    line-height: 1;\n}\n\n#mimir-body blockquote {\n    border-left: 2px solid #aaaaaa;\n    padding: 5px;\n}\n\n/* Editor menubar. */\n#mimir-menubar {\n    display: flex;\n    gap: 5px;\n    padding: 5px;\n    flex-wrap: wrap;\n    align-items: center;\n\n    --ui-font-family: Segoe UI, Arial, Helvetica, sans-serif;\n}\n\n#mimir-menubar > .mimir-menubar-spacer {\n    height: 20px;\n    width: 1px;\n    border-radius: 1px;\n    background-color: #aaaaaa;\n}\n\n#mimir-menubar > button,\n#mimir-menubar .mimir-menubar-option-fore-color-button-container button,\n#mimir-menubar .mimir-menubar-option-back-color-button-container button,\n#mimir-menubar .mimir-menubar-option-link-button,\n#mimir-menubar .mimir-menubar-option-image-button {\n    min-width: 30px;\n    min-height: 30px;\n    background: none;\n    border: none;\n    border-radius: 5px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-family: var(--ui-font-family);\n}\n\n#mimir-menubar > button:hover,\n#mimir-menubar > button:focus,\n#mimir-menubar .mimir-menubar-option-fore-color-button-container button:hover,\n#mimir-menubar .mimir-menubar-option-fore-color-button-container button:focus,\n#mimir-menubar .mimir-menubar-option-back-color-button-container button:hover,\n#mimir-menubar .mimir-menubar-option-back-color-button-container button:focus,\n#mimir-menubar .mimir-menubar-option-link-button:hover,\n#mimir-menubar .mimir-menubar-option-link-button:focus,\n#mimir-menubar .mimir-menubar-option-image-button:hover,\n#mimir-menubar .mimir-menubar-option-image-button:focus {\n    background: #e0e0e0;\n}\n\n#mimir-menubar > select {\n    min-height: 30px;\n    padding: 5px 35px 5px 5px;\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    appearance: none;\n    border: none;\n    border-radius: 5px;\n    background-color: white;\n    background-repeat: no-repeat;\n    background-image: linear-gradient(45deg, transparent 50%, currentColor 50%), linear-gradient(135deg, currentColor 50%, transparent 50%);\n    background-position: right 15px top 1em, right 10px top 1em;\n    background-size: 5px 5px, 5px 5px;\n    font-family: var(--ui-font-family);\n}\n\n#mimir-menubar > select:hover,\n#mimir-menubar > select:focus {\n    background-color: #e0e0e0;\n}\n\n#mimir-menubar > .mimir-pressed {\n    background: #cee2ff;\n}\n\n#mimir-menubar > #mimir-menubar-option-bold { font-weight: bold; }\n\n#mimir-menubar > #mimir-menubar-option-italic { font-style: italic; }\n\n#mimir-menubar > #mimir-menubar-option-underline { text-decoration: underline; }\n\n#mimir-menubar > #mimir-menubar-option-strikethrough { text-decoration: line-through; }\n\n#mimir-menubar > #mimir-menubar-option-fore-color .mimir-menubar-option-fore-color-button-container,\n#mimir-menubar > #mimir-menubar-option-back-color .mimir-menubar-option-back-color-button-container {\n    display: flex;\n}\n\n#mimir-menubar > #mimir-menubar-option-fore-color > .mimir-menubar-option-fore-color-button-container > .mimir-menubar-option-fore-color-button,\n#mimir-menubar > #mimir-menubar-option-back-color > .mimir-menubar-option-back-color-button-container > .mimir-menubar-option-back-color-button {\n    text-decoration: underline;\n}\n\n#mimir-menubar > #mimir-menubar-option-fore-color > .mimir-menubar-option-fore-color-button-container > .mimir-menubar-option-fore-color-button,\n#mimir-menubar > #mimir-menubar-option-back-color > .mimir-menubar-option-back-color-button-container > .mimir-menubar-option-back-color-button {\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n}\n\n#mimir-menubar > #mimir-menubar-option-fore-color > .mimir-menubar-option-fore-color-button-container > .mimir-dropdown-button > .mimir-color-picker-button,\n#mimir-menubar > #mimir-menubar-option-back-color > .mimir-menubar-option-back-color-button-container > .mimir-dropdown-button > .mimir-color-picker-button {\n    min-width: 10px;\n    width: 10px;\n    font-size: 10px;\n    text-align: center;\n    padding: 0;\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n}",""]);const d=l},276:(e,t,n)=>{"use strict";n.d(t,{c:()=>a});var i=n(500),o=n.n(i),s=n(312),r=n.n(s)()(o());r.push([e.id,'/* Custom UI. */\n\n/* Action buttons and general UI. */\n.mimir-action-button-primary {\n    background-color: #cee2ff;\n    min-width: 30px;\n    min-height: 30px;\n    border: 1px solid silver;\n    border-radius: 5px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-family: var(--ui-font-family);\n}\n\n.mimir-action-button-primary:hover {\n    background-color: #a8cbff;\n}\n\n.mimir-action-button-secondary {\n    background-color: #e0e0e0;\n    min-width: 30px;\n    min-height: 30px;\n    border: 1px solid silver;\n    border-radius: 5px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-family: var(--ui-font-family);\n}\n\n.mimir-action-button-secondary:hover {\n    background-color: #d3d3d3;\n}\n\n.mimir-modal-label {\n    margin: 0px;\n    font-weight: normal;\n}\n\n.mimir-modal-row {\n    display: flex;\n    gap: 10px;\n}\n\n.mimir-modal-input {\n    border: 1px solid silver;\n    font-family: var(--ui-font-family);\n    border-radius: 3px;\n    background-color: white;\n    height: 20px;\n    padding: 2px;\n    padding-left: 3px;\n}\n\n/* Dropdown. */\n.mimir-dropdown {\n    position: relative;\n}\n\n.mimir-dropdown-body {\n    position: absolute;\n    background-color: white;\n    border: 1px solid silver;\n    border-radius: 2px;\n    z-index: 2;\n    padding: 10px;\n    display: none;\n    box-shadow: 0px 10px 30px 10px rgba(140, 150, 160, 0.15);\n    font-family: var(--ui-font-family);\n}\n\n.mimir-dropdown-show {\n    display: block;\n}\n\n/* List dropdown. */\n.mimir-dropdown-list > .mimir-dropdown-body {\n    padding-left: 0px;\n    padding-right: 0px;\n    font-family: var(--ui-font-family);\n}\n\n.mimir-dropdown-list-open-button {\n    height: 30px;\n    padding: 5px 30px 5px 5px;\n    border: none;\n    border-radius: 5px;\n    background-color: white;\n    background-repeat: no-repeat;\n    background-image: linear-gradient(45deg, transparent 50%, currentColor 50%), linear-gradient(135deg, currentColor 50%, transparent 50%);\n    background-position: right 15px top 1em, right 10px top 1em;\n    background-size: 5px 5px, 5px 5px;\n    width: 100%;\n    font-family: var(--ui-font-family);\n}\n\n.mimir-dropdown-list-open-button div {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    text-align: left;\n    white-space: nowrap;\n}\n\n.mimir-dropdown-list-open-button:hover,\n.mimir-dropdown-list-open-button:focus {\n    background-color: #e0e0e0;\n}\n\n.mimir-dropdown-list-options {\n    width: max-content;\n}\n\n.mimir-dropdown-list-options button {\n    min-height: 30px;\n    border: none;\n    padding: 5px 12px 5px 12px;\n    background-color: white;\n    width: 100%;\n    font-family: var(--ui-font-family);\n    text-align: left;\n}\n\n.mimir-dropdown-list-options button:hover,\n.mimir-dropdown-list-options button:focus {\n    background-color: #e0e0e0;\n}\n\n/* Number input. */\n.mimir-number-input {\n    background-color: #f7f7f7;\n    border-radius: 5px;\n}\n\n.mimir-number-input :first-child {\n    border-radius: 5px 0 0 5px;\n}\n\n.mimir-number-input :last-child {\n    border-radius: 0 5px 5px 0;\n}\n\n.mimir-number-input-input[type="number"] {\n    background-color: #f7f7f7;\n    border: none;\n    outline: none;\n    height: 100%;\n    padding: 0;\n    font-family: var(--ui-font-family);\n}\n\n.mimir-number-input-input[type="number"]:focus,\n.mimir-number-input-input[type="number"]:hover {\n    background: #e0e0e0;\n    border: none;\n    outline: none;\n}\n\n.mimir-number-input-input[type="number"]::-webkit-inner-spin-button,\n.mimir-number-input-input[type="number"]::-webkit-outer-spin-button {\n    -webkit-appearance: none;\n    margin: 0;\n}\n\n.mimir-number-input-input[type="number"] {\n    -moz-appearance: textfield;\n    background-color: #f7f7f7;\n}\n\n.mimir-number-input-button {\n    min-width: 20px;\n    min-height: 30px;\n    background: none;\n    border: none;\n    font-family: var(--ui-font-family);\n}\n\n.mimir-number-input-button:hover {\n    background: #e0e0e0;\n}\n\n/* Color input. */\n.mimir-color-picker-row {\n    display: flex;\n    gap: 10px;\n}\n\n.mimir-color-picker-row + .mimir-color-picker-row {\n    margin-top: 10px;\n}\n\n.mimir-color-picker-primary-container {\n    position: relative;\n    user-select: none;\n}\n\n.mimir-color-picker-primary-canvas {\n    user-select: none;\n}\n\n.mimir-color-picker-primary-thumb {\n    position: absolute;\n    width: 10px;\n    height: 10px;\n    border-radius: 100%;\n    z-index: 0;\n    border: 1px solid black;\n    top: 0;\n    left: 0;\n    user-select: none;\n    pointer-events: none;\n}\n\n.mimir-color-picker-hue-container {\n    position: relative;\n}\n\n.mimir-color-picker-hue-slider {\n    position: absolute;\n    width: 100%;\n    height: 0px;\n    z-index: 0;\n    border: 1px solid black;\n    top: 0;\n    left: 0;\n    user-select: none;\n    pointer-events: none;\n    box-sizing: border-box;\n}\n\n.mimir-color-picker-rgb-form-input-container {\n    width: 80px;\n    display: flex;\n    gap: 3px;\n}\n\n.mimir-color-picker-rgb-form {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.mimir-color-picker-rgb-form-color {\n    width: 100%;\n    flex-grow: 1;\n    border: 1px solid black;\n    box-sizing: border-box;\n}\n\n.mimir-color-picker-rgb-form-input-label {\n    display: block;\n    width: 15px;\n    display: flex;\n    align-items: center;\n    font-family: var(--ui-font-family);\n}\n\n.mimir-color-picker-rgb-form-input-container > input {\n    display: block;\n    flex-grow: 1;\n    height: 20px;\n    border: 1px solid silver;\n    font-family: var(--ui-font-family);\n    width: 100%;\n    border-radius: 3px;\n    background-color: white;\n    padding: 2px;\n    padding-left: 3px;\n}\n\n.mimir-color-picker-rgb-form-input-container > input[type="number"]::-webkit-inner-spin-button,\n.mimir-color-picker-rgb-form-input-container > input[type="number"]::-webkit-outer-spin-button {\n    -webkit-appearance: none;\n    margin: 0;\n}\n\n.mimir-color-picker-rgb-form-input-container > input[type="number"] {\n    -moz-appearance: textfield;\n    background-color: #f7f7f7;\n    font-family: var(--ui-font-family);\n}\n\n/* Link and image insert UIs. */\n.mimir-link-input-input {\n    margin-top: 10px;\n    margin-bottom: 10px;\n}\n\n.mimir-image-input-body {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n/* Image editing UI. */\n#mimir-image-editing-ui > .resize-box {\n    position: absolute;\n    width: 10px;\n    height: 10px;\n    background-color: #408cff;\n    display: none;\n    z-index: 5;\n}\n\n#mimir-image-editing-ui > .resize-box-top-right {\n    cursor: nesw-resize;\n}\n\n#mimir-image-editing-ui > .resize-box-top-left {\n    cursor: nwse-resize;\n}\n\n#mimir-image-editing-ui > .resize-box-bottom-right {\n    cursor: nwse-resize;\n}\n\n#mimir-image-editing-ui > .resize-box-bottom-left {\n    cursor: nesw-resize;\n}\n\n#mimir-image-editing-ui > .resize-bar {\n    position: absolute;\n    background-color: #70a9ff;\n    display: none;\n}\n\n#mimir-image-editing-ui > .resize-bar-horizontal {\n    height: 3px;\n}\n\n#mimir-image-editing-ui > .resize-bar-vertical {\n    width: 3px;\n}\n\n#mimir-image-editing-ui > .resize-bar-top {\n    cursor: ns-resize;\n}\n\n#mimir-image-editing-ui > .resize-bar-bottom {\n    cursor: ns-resize;\n}\n\n#mimir-image-editing-ui > .resize-bar-right {\n    cursor: ew-resize;\n}\n\n#mimir-image-editing-ui > .resize-bar-left {\n    cursor: ew-resize;\n}\n\n#mimir-body img.mimir-hide-selection::selection {\n    background: none;\n}\n\n#mimir-body img.mimir-hide-selection::-moz-selection {\n    background: none;\n}\n\n/* Find and replace UI. */\n#mimir-find-and-replace-ui {\n    display: none;\n    z-index: 5;\n    position: absolute;\n    padding: 7px;\n    box-shadow: 0px 10px 30px 10px rgba(140, 150, 160, 0.15);\n    background-color: white;\n    border: 1px solid silver;\n    border-radius: 2px;\n    gap: 5px;\n    flex-direction: column;\n\n    --ui-font-family: Segoe UI, Arial, Helvetica, sans-serif;\n}\n\n.mimir-find-and-replace-toggle-case-sensitive-button {\n    min-width: 30px;\n    min-height: 30px;\n    background: none;\n    border: none;\n    border-radius: 5px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-family: var(--ui-font-family);\n}\n\n.mimir-find-and-replace-toggle-case-sensitive-button:hover {\n    background: #e0e0e0;\n}\n\n.mimir-find-and-replace-toggle-case-sensitive-button.mimir-toggled {\n    background: #cee2ff;\n}\n\n.mimir-find-and-replace-find-input {\n    flex-grow: 1;\n}\n\n.mimir-find-and-replace-replace-input {\n    flex-grow: 1;\n}\n\n#mimir-body .mimir-find-and-replace-match {\n    background-color: yellow;\n}\n\n#mimir-body .mimir-find-and-replace-current {\n    background-color: orange;\n}',""]);const a=r},312:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,o,s){"string"==typeof e&&(e=[[null,e,void 0]]);var r={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(r[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);i&&r[c[0]]||(void 0!==s&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=s),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),t.push(c))}},t}},500:e=>{"use strict";e.exports=function(e){return e[1]}},528:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>b});var i=n(596),o=n.n(i),s=n(520),r=n.n(s),a=n(176),l=n.n(a),d=n(120),c=n.n(d),u=n(808),m=n.n(u),h=n(936),p=n.n(h),g=n(436),f={};f.styleTagTransform=p(),f.setAttributes=c(),f.insert=l().bind(null,"head"),f.domAPI=r(),f.insertStyleElement=m(),o()(g.c,f);const b=g.c&&g.c.locals?g.c.locals:void 0},596:e=>{"use strict";var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var s={},r=[],a=0;a<e.length;a++){var l=e[a],d=i.base?l[0]+i.base:l[0],c=s[d]||0,u="".concat(d," ").concat(c);s[d]=c+1;var m=n(u),h={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)t[m].references++,t[m].updater(h);else{var p=o(h,i);i.byIndex=a,t.splice(a,0,{identifier:u,updater:p,references:1})}r.push(u)}return r}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var s=i(e=e||[],o=o||{});return function(e){e=e||[];for(var r=0;r<s.length;r++){var a=n(s[r]);t[a].references--}for(var l=i(e,o),d=0;d<s.length;d++){var c=n(s[d]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}s=l}}},176:e=>{"use strict";var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},808:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},120:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},520:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,o&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},936:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},956:e=>{e.exports='<svg fill="currentColor" class="bi bi-type-bold" viewBox="0 0 16 16" version="1.1" id="svg4" sodipodi:docname="a.svg" inkscape:version="1.2.2 (732a01da63, 2022-12-09)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><defs id="defs8"></defs><sodipodi:namedview id="namedview6" pagecolor="#ffffff" bordercolor="#000000" borderopacity="0.25" inkscape:showpageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1" showgrid="false" inkscape:zoom="15.65625" inkscape:cx="-23.824351" inkscape:cy="6.0678643" inkscape:window-width="2560" inkscape:window-height="1369" inkscape:window-x="2552" inkscape:window-y="-8" inkscape:window-maximized="1" inkscape:current-layer="svg4"></sodipodi:namedview><text xml:space="preserve" style="font-size:210.095px;font-family:serif;-inkscape-font-specification:&#x27;serif, Normal&#x27;;text-align:center;text-anchor:middle;fill:#000000;stroke:#000000;stroke-width:0;stroke-opacity:0.992908" x="8.0039454" y="13.657977" id="text219"><tspan sodipodi:role="line" id="tspan217" x="8.0039454" y="13.657977" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:16.1611px;font-family:&#x27;Segoe UI&#x27;;-inkscape-font-specification:&#x27;Segoe UI, Normal&#x27;;font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke-width:0">A</tspan></text></svg>'},160:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-text-center" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 12.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5"></path></svg>'},8:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-justify" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2 12.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5"></path></svg>'},892:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-text-left" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2 12.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m0-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5"></path></svg>'},980:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-text-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m-4-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m4-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m-4-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5"></path></svg>'},288:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-type-bold" viewBox="0 0 16 16"><path d="M8.21 13c2.106 0 3.412-1.087 3.412-2.823 0-1.306-.984-2.283-2.324-2.386v-.055a2.176 2.176 0 0 0 1.852-2.14c0-1.51-1.162-2.46-3.014-2.46H3.843V13zM5.908 4.674h1.696c.963 0 1.517.451 1.517 1.244 0 .834-.629 1.32-1.73 1.32H5.908V4.673zm0 6.788V8.598h1.73c1.217 0 1.88.492 1.88 1.415 0 .943-.643 1.449-1.832 1.449H5.907z"></path></svg>'},652:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-paint-bucket" viewBox="0 0 16 16"><path d="M6.192 2.78c-.458-.677-.927-1.248-1.35-1.643a3 3 0 0 0-.71-.515c-.217-.104-.56-.205-.882-.02-.367.213-.427.63-.43.896-.003.304.064.664.173 1.044.196.687.556 1.528 1.035 2.402L.752 8.22c-.277.277-.269.656-.218.918.055.283.187.593.36.903.348.627.92 1.361 1.626 2.068.707.707 1.441 1.278 2.068 1.626.31.173.62.305.903.36.262.05.64.059.918-.218l5.615-5.615c.118.257.092.512.05.939-.03.292-.068.665-.073 1.176v.123h.003a1 1 0 0 0 1.993 0H14v-.057a1 1 0 0 0-.004-.117c-.055-1.25-.7-2.738-1.86-3.494a4 4 0 0 0-.211-.434c-.349-.626-.92-1.36-1.627-2.067S8.857 3.052 8.23 2.704c-.31-.172-.62-.304-.903-.36-.262-.05-.64-.058-.918.219zM4.16 1.867c.381.356.844.922 1.311 1.632l-.704.705c-.382-.727-.66-1.402-.813-1.938a3.3 3.3 0 0 1-.131-.673q.137.09.337.274m.394 3.965c.54.852 1.107 1.567 1.607 2.033a.5.5 0 1 0 .682-.732c-.453-.422-1.017-1.136-1.564-2.027l1.088-1.088q.081.181.183.365c.349.627.92 1.361 1.627 2.068.706.707 1.44 1.278 2.068 1.626q.183.103.365.183l-4.861 4.862-.068-.01c-.137-.027-.342-.104-.608-.252-.524-.292-1.186-.8-1.846-1.46s-1.168-1.32-1.46-1.846c-.147-.265-.225-.47-.251-.607l-.01-.068zm2.87-1.935a2.4 2.4 0 0 1-.241-.561c.135.033.324.11.562.241.524.292 1.186.8 1.846 1.46.45.45.83.901 1.118 1.31a3.5 3.5 0 0 0-1.066.091 11 11 0 0 1-.76-.694c-.66-.66-1.167-1.322-1.458-1.847z"></path></svg>'},857:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-type-h1" viewBox="0 0 16 16"><path d="M7.648 13V3H6.3v4.234H1.348V3H0v10h1.348V8.421H6.3V13zM14 13V3h-1.333l-2.381 1.766V6.12L12.6 4.443h.066V13z"></path></svg>'},636:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-type-h2" viewBox="0 0 16 16"><path d="M7.495 13V3.201H6.174v4.15H1.32V3.2H0V13h1.32V8.513h4.854V13zm3.174-7.071v-.05c0-.934.66-1.752 1.801-1.752 1.005 0 1.76.639 1.76 1.651 0 .898-.582 1.58-1.12 2.19l-3.69 4.2V13h6.331v-1.149h-4.458v-.079L13.9 8.786c.919-1.048 1.666-1.874 1.666-3.101C15.565 4.149 14.35 3 12.499 3 10.46 3 9.384 4.393 9.384 5.879v.05z"></path></svg>'},456:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-type-h3" viewBox="0 0 16 16"><path d="M11.07 8.4h1.049c1.174 0 1.99.69 2.004 1.724s-.802 1.786-2.068 1.779c-1.11-.007-1.905-.605-1.99-1.357h-1.21C8.926 11.91 10.116 13 12.028 13c1.99 0 3.439-1.188 3.404-2.87-.028-1.553-1.287-2.221-2.096-2.313v-.07c.724-.127 1.814-.935 1.772-2.293-.035-1.392-1.21-2.468-3.038-2.454-1.927.007-2.94 1.196-2.981 2.426h1.23c.064-.71.732-1.336 1.744-1.336 1.027 0 1.744.64 1.744 1.568.007.95-.738 1.639-1.744 1.639h-.991V8.4ZM7.495 13V3.201H6.174v4.15H1.32V3.2H0V13h1.32V8.513h4.854V13z"></path></svg>'},40:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-type-h4" viewBox="0 0 16 16"><path d="M13.007 3H15v10h-1.29v-2.051H8.854v-1.18C10.1 7.513 11.586 5.256 13.007 3m-2.82 6.777h3.524v-5.62h-.074a95 95 0 0 0-3.45 5.554zM7.495 13V3.201H6.174v4.15H1.32V3.2H0V13h1.32V8.513h4.854V13z"></path></svg>'},256:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-type-h5" viewBox="0 0 16 16"><path d="M9 10.516h1.264c.193.976 1.112 1.364 2.01 1.364 1.005 0 2.067-.782 2.067-2.247 0-1.292-.983-2.082-2.089-2.082-1.012 0-1.658.596-1.924 1.077h-1.12L9.646 3h5.535v1.141h-4.415L10.5 7.28h.072c.201-.316.883-.84 1.967-.84 1.709 0 3.13 1.177 3.13 3.158 0 2.025-1.407 3.403-3.475 3.403-1.809 0-3.1-1.048-3.194-2.484ZM7.495 13V3.201H6.174v4.15H1.32V3.2H0V13h1.32V8.512h4.854V13z"></path></svg>'},868:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-type-h6" viewBox="0 0 16 16"><path d="M15.596 5.178H14.3c-.106-.444-.62-1.072-1.706-1.072-1.332 0-2.325 1.269-2.325 3.947h.07c.268-.67 1.043-1.445 2.445-1.445 1.494 0 3.017 1.064 3.017 3.073C15.8 11.795 14.37 13 12.48 13c-1.036 0-2.093-.36-2.77-1.452C9.276 10.836 9 9.808 9 8.37 9 4.656 10.494 3 12.636 3c1.812 0 2.883 1.113 2.96 2.178m-5.151 4.566c0 1.367.944 2.15 2.043 2.15 1.128 0 2.037-.684 2.037-2.136 0-1.41-1-2.065-2.03-2.065-1.19 0-2.05.853-2.05 2.051M7.495 13V3.201H6.174v4.15H1.32V3.2H0V13h1.32V8.513h4.854V13z"></path></svg>'},896:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-hr" viewBox="0 0 16 16"><path d="M12 3H4a1 1 0 0 0-1 1v2.5H2V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2.5h-1V4a1 1 0 0 0-1-1M2 9.5h1V12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9.5h1V12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zm-1.5-2a.5.5 0 0 0 0 1h15a.5.5 0 0 0 0-1z"></path></svg>'},480:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-image" viewBox="0 0 16 16"><path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"></path><path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"></path></svg>'},392:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-text-indent-left" viewBox="0 0 16 16"><path d="M2 3.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m.646 2.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L4.293 8 2.646 6.354a.5.5 0 0 1 0-.708M7 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5m0 3a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5m-5 3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5"></path></svg>'},0:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-type-italic" viewBox="0 0 16 16"><path d="M7.991 11.674 9.53 4.455c.123-.595.246-.71 1.347-.807l.11-.52H7.211l-.11.52c1.06.096 1.128.212 1.005.807L6.57 11.674c-.123.595-.246.71-1.346.806l-.11.52h3.774l.11-.52c-1.06-.095-1.129-.211-1.006-.806z"></path></svg>'},448:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16"><path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"></path><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"></path></svg>'},676:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-list-ol" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5"></path><path d="M1.713 11.865v-.474H2c.217 0 .363-.137.363-.317 0-.185-.158-.31-.361-.31-.223 0-.367.152-.373.31h-.59c.016-.467.373-.787.986-.787.588-.002.954.291.957.703a.595.595 0 0 1-.492.594v.033a.615.615 0 0 1 .569.631c.003.533-.502.8-1.051.8-.656 0-1-.37-1.008-.794h.582c.008.178.186.306.422.309.254 0 .424-.145.422-.35-.002-.195-.155-.348-.414-.348h-.3zm-.004-4.699h-.604v-.035c0-.408.295-.844.958-.844.583 0 .96.326.96.756 0 .389-.257.617-.476.848l-.537.572v.03h1.054V9H1.143v-.395l.957-.99c.138-.142.293-.304.293-.508 0-.18-.147-.32-.342-.32a.33.33 0 0 0-.342.338zM2.564 5h-.635V2.924h-.031l-.598.42v-.567l.629-.443h.635z"></path></svg>'},304:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-list-ul" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2"></path></svg>'},780:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-text-indent-right" viewBox="0 0 16 16"><path d="M2 3.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m10.646 2.146a.5.5 0 0 1 .708.708L11.707 8l1.647 1.646a.5.5 0 0 1-.708.708l-2-2a.5.5 0 0 1 0-.708zM2 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5m0 3a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5m0 3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5"></path></svg>'},632:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-text-paragraph" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2 12.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5m4-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5"></path></svg>'},932:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-quote" viewBox="0 0 16 16"><path d="M12 12a1 1 0 0 0 1-1V8.558a1 1 0 0 0-1-1h-1.388q0-.527.062-1.054.093-.558.31-.992t.559-.683q.34-.279.868-.279V3q-.868 0-1.52.372a3.3 3.3 0 0 0-1.085.992 4.9 4.9 0 0 0-.62 1.458A7.7 7.7 0 0 0 9 7.558V11a1 1 0 0 0 1 1zm-6 0a1 1 0 0 0 1-1V8.558a1 1 0 0 0-1-1H4.612q0-.527.062-1.054.094-.558.31-.992.217-.434.559-.683.34-.279.868-.279V3q-.868 0-1.52.372a3.3 3.3 0 0 0-1.085.992 4.9 4.9 0 0 0-.62 1.458A7.7 7.7 0 0 0 3 7.558V11a1 1 0 0 0 1 1z"></path></svg>'},400:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"></path><path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"></path></svg>'},756:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-eraser-fill" viewBox="0 0 16 16"><path d="M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828zm.66 11.34L3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293z"></path></svg>'},232:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"></path></svg>'},548:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-type-strikethrough" viewBox="0 0 16 16"><path d="M6.333 5.686c0 .31.083.581.27.814H5.166a2.8 2.8 0 0 1-.099-.76c0-1.627 1.436-2.768 3.48-2.768 1.969 0 3.39 1.175 3.445 2.85h-1.23c-.11-1.08-.964-1.743-2.25-1.743-1.23 0-2.18.602-2.18 1.607zm2.194 7.478c-2.153 0-3.589-1.107-3.705-2.81h1.23c.144 1.06 1.129 1.703 2.544 1.703 1.34 0 2.31-.705 2.31-1.675 0-.827-.547-1.374-1.914-1.675L8.046 8.5H1v-1h14v1h-3.504c.468.437.675.994.675 1.697 0 1.826-1.436 2.967-3.644 2.967"></path></svg>'},940:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-subscript" viewBox="0 0 16 16"><path d="m3.266 12.496.96-2.853H7.76l.96 2.853H10L6.62 3H5.38L2 12.496zm2.748-8.063 1.419 4.23h-2.88l1.426-4.23zm6.132 7.203v-.075c0-.332.234-.618.619-.618.354 0 .618.256.618.58 0 .362-.271.649-.52.898l-1.788 1.832V15h3.59v-.958h-1.923v-.045l.973-1.04c.415-.438.867-.845.867-1.547 0-.8-.701-1.41-1.787-1.41-1.23 0-1.795.8-1.795 1.576v.06z"></path></svg>'},223:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-superscript" viewBox="0 0 16 16"><path d="m4.266 12.496.96-2.853H8.76l.96 2.853H11L7.62 3H6.38L3 12.496zm2.748-8.063 1.419 4.23h-2.88l1.426-4.23zm5.132-1.797v-.075c0-.332.234-.618.619-.618.354 0 .618.256.618.58 0 .362-.271.649-.52.898l-1.788 1.832V6h3.59v-.958h-1.923v-.045l.973-1.04c.415-.438.867-.845.867-1.547 0-.8-.701-1.41-1.787-1.41C11.565 1 11 1.8 11 2.576v.06z"></path></svg>'},172:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-type-underline" viewBox="0 0 16 16"><path d="M5.313 3.136h-1.23V9.54c0 2.105 1.47 3.623 3.917 3.623s3.917-1.518 3.917-3.623V3.136h-1.23v6.323c0 1.49-.978 2.57-2.687 2.57s-2.687-1.08-2.687-2.57zM12.5 15h-9v-1h9z"></path></svg>'},704:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2z"></path><path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466"></path></svg>'},771:(e,t,n)=>{const i={};i.a=n(956),i["align-center"]=n(160),i["align-justify"]=n(8),i["align-left"]=n(892),i["align-right"]=n(980),i.bold=n(288),i.fill=n(652),i.h1=n(857),i.h2=n(636),i.h3=n(456),i.h4=n(40),i.h5=n(256),i.h6=n(868),i.hr=n(896),i.image=n(480),i.indent=n(392),i.italic=n(0),i.link=n(448),i["list-ordered"]=n(676),i["list-unordered"]=n(304),i.outdent=n(780),i.paragraph=n(632),i.quote=n(932),i.redo=n(400),i.remove=n(756),i.search=n(232),i.strikethrough=n(548),i.subscript=n(940),i.superscript=n(223),i.underline=n(172),i.undo=n(704),e.exports=i},556:(e,t,n)=>{n(528),e.exports=class{MimirUI=n(792);MimirIcons=n(771);ascii=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";invisible="&#xFEFF;";contentTags=["IMG","BR","HR"];stylingTags=["B","STRONG","I","EM","S","U","FONT","SUP","SUB","OL","UL","LI","H1","H2","H3","H4","H5","H6","BLOCKQUOTE"];inlineStylingTags=["B","STRONG","I","EM","S","U","FONT","SUP","SUB","A"];basicAllowedTags=["DIV","BR","P","IMG","LI","UL","OL","BLOCKQUOTE","HR"];blockTags=["BR","DIV","P","OL","UL","LI","H1","H2","H3","H4","H5","H6","BLOCKQUOTE","HR"];childlessTags=["BR","IMG","HR"];inlineStylingCommands=["bold","italic","underline","strikethrough","font","size","foreColor","backColor","sup","sub","link"];blockStylingCommands=["quote","header","align","list","indent","outdent"];inlineBlockStylingCommands=["header","align"];requireSingleNodeToActivateStylingCommands=["quote","list"];multipleValueStylingCommands=["font","size","foreColor","backColor","link"];noUIUpdateStylingCommands=["foreColor","backColor","indent","outdent","link","insertImage","undo","redo","remove","insertHorizontalRule"];cannotCreateCursorCommands=["link"];insertCommands=["insertImage","insertHorizontalRule"];constructor(e,t){t=null==t?{}:t,this.container=e,this.settings=t,this.commands=["bold","italic","underline","strikethrough","font","size","foreColor","backColor","sup","sub","link","quote","header","align","list","indent","outdent","insertImage","insertHorizontalRule","undo","redo"]||0,this.menubarSettings=[["bold","italic","underline","strikethrough","font","size","foreColor","backColor","sup","sub","link","remove"],["quote","header","align","list","indent","outdent"],["insertImage","insertHorizontalRule"],["undo","redo","openFindAndReplace","zoom"]]||0,this.snapshotInterval=t.snapshotInterval||5e3,this.historyLimit=t.historyLimit||100,this.supportedFonts=t.supportedFonts||["Arial","Times New Roman","monospace","Helvetica"],this.defaultFont=t.defaultFont||"Arial",this.defaultSize=16,this.spellcheck=null==t.spellcheck||!!t.spellcheck,this.defaultImageWidth=t.defaultImageWidth||"300px",this.useIcons=null==t.useIcons||!!t.useIcons,this.allowPasteHTML=null==t.allowPasteHTML||!!t.allowPasteHTML,this.zoomOptions=t.zoomOptions||["50","75","90","100","125","150","175","200"];const n=document.createElement("div");n.innerHTML=this.invisible,this.invisibleParsed=n.innerHTML}hash(e,t=0){let n=3735928559^t,i=1103547991^t;for(let t,o=0;o<e.length;o++)t=e.charCodeAt(o),n=Math.imul(n^t,2654435761),i=Math.imul(i^t,1597334677);return n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(n^n>>>13,3266489909),4294967296*(2097151&i)+(n>>>0)}createCursor(){const e=document.createElement("span");return e.setAttribute("class","mimir-temp-cursor"),e.innerHTML=this.invisible,this.currentCursor=e,e}applySizeStyles(){this.editor.style.width=this.settings.width||"600px",this.settings.height?(this.editorContainer.style.height=this.settings.height,this.editor.style.height=this.settings.height):this.settings.minHeight?(this.editorContainer.style.minHeight=this.settings.minHeight,this.editor.style.minHeight=this.settings.minHeight):(this.editorContainer.style.minHeight="600px",this.editor.style.minHeight="600px")}applyDefaultFont(){this.editor.style.fontFamily=this.defaultFont}applyDefaultSize(){this.editor.style.fontSize=String(this.defaultSize)+"px"}createMenubar(){function e(e){return this.MimirIcons[e]}e=e.bind(this),this.menubar=document.createElement("div"),this.menubar.setAttribute("id","mimir-menubar"),this.menubar.setAttribute("role","toolbar"),this.menubar.setAttribute("aria-label","Editor menubar"),this.container.append(this.menubar),this.menubarOptions={};for(const i of this.menubarSettings){for(const o of i)switch(o){case"bold":this.menubarOptions.bold=document.createElement("button"),this.menubarOptions.bold.setAttribute("id","mimir-menubar-option-bold"),this.menubarOptions.bold.innerHTML=this.useIcons?e("bold"):"B",this.menubarOptions.bold.addEventListener("click",this.bold.bind(this)),this.menubarOptions.bold.setAttribute("title","Bold"),this.menubarOptions.bold.setAttribute("aria-pressed","false"),this.menubarOptions.bold.setAttribute("aria-label","Editor toggle bold"),this.menubar.append(this.menubarOptions.bold);break;case"italic":this.menubarOptions.italic=document.createElement("button"),this.menubarOptions.italic.setAttribute("id","mimir-menubar-option-italic"),this.menubarOptions.italic.innerHTML=this.useIcons?e("italic"):"I",this.menubarOptions.italic.addEventListener("click",this.italic.bind(this)),this.menubarOptions.italic.setAttribute("title","Italic"),this.menubarOptions.italic.setAttribute("aria-pressed","false"),this.menubarOptions.italic.setAttribute("aria-label","Editor toggle italic"),this.menubar.append(this.menubarOptions.italic);break;case"underline":this.menubarOptions.underline=document.createElement("button"),this.menubarOptions.underline.setAttribute("id","mimir-menubar-option-underline"),this.menubarOptions.underline.innerHTML=this.useIcons?e("underline"):"U",this.menubarOptions.underline.addEventListener("click",this.underline.bind(this)),this.menubarOptions.underline.setAttribute("title","Underline"),this.menubarOptions.underline.setAttribute("aria-pressed","false"),this.menubarOptions.underline.setAttribute("aria-label","Editor toggle underline"),this.menubar.append(this.menubarOptions.underline);break;case"strikethrough":this.menubarOptions.strikethrough=document.createElement("button"),this.menubarOptions.strikethrough.setAttribute("id","mimir-menubar-option-strikethrough"),this.menubarOptions.strikethrough.innerHTML=this.useIcons?e("strikethrough"):"S",this.menubarOptions.strikethrough.addEventListener("click",this.strikethrough.bind(this)),this.menubarOptions.strikethrough.setAttribute("title","Strikethrough"),this.menubarOptions.strikethrough.setAttribute("aria-pressed","false"),this.menubarOptions.strikethrough.setAttribute("aria-label","Editor toggle strikethrough"),this.menubar.append(this.menubarOptions.strikethrough);break;case"font":var t=[];for(const e of this.supportedFonts){const n=document.createElement("div");n.innerHTML=e,n.style.fontFamily=e,n.setAttribute("value",e),n.setAttribute("title",e),n.setAttribute("aria-label","Editor select font "+e),t.push({name:e,content:n})}this.menubarOptions.font=this.MimirUI.dropdownList(t,this.font.bind(this)),this.menubarOptions.font.list.setAttribute("id","mimir-menubar-option-font"),this.menubarOptions.font.setValue(this.defaultFont),this.menubar.append(this.menubarOptions.font.list),this.menubarOptions.font.list.setAttribute("title","Font"),this.menubarOptions.font.list.setAttribute("aria-label","Editor select font"),this.menubarOptions.font.list.style.width="130px";break;case"size":const{numberInput:i,input:o,plus:s,minus:r}=this.MimirUI.numberInput(1,200);this.menubarOptions.size=o,i.setAttribute("id","mimir-menubar-option-size"),this.menubarOptions.size.value=this.defaultSize,this.menubarOptions.size.addEventListener("change",this.size.bind(this)),this.menubarOptions.size.setAttribute("title","Size"),this.menubarOptions.size.setAttribute("aria-label","Editor change size"),s.setAttribute("title","Increase Size"),s.setAttribute("aria-label","Editor change size increase"),r.setAttribute("title","Decrease Size"),r.setAttribute("aria-label","Editor change size decrease"),this.menubar.append(i);break;case"foreColor":const a=document.createElement("button");a.innerHTML=this.useIcons?e("a"):"A",this.useIcons?a.childNodes[0].style.borderBottom="2px solid rgb(255, 0, 0)":a.style.textDecorationColor="rgb(255, 0, 0)",a.setAttribute("title","Foreground Color"),a.classList.add("mimir-menubar-option-fore-color-button"),a.addEventListener("click",function(){this.foreColor(n.getValue())}.bind(this));const l=document.createElement("button");l.innerHTML="&#9660";var n=this.MimirUI.colorInput(this.foreColor.bind(this),l,200,40,200);this.menubarOptions.foreColor=n,n.colorInput.setAttribute("id","mimir-menubar-option-fore-color");const d=document.createElement("div");d.classList.add("mimir-menubar-option-fore-color-button-container"),d.append(a,n.dropdown.button),n.colorInput.prepend(d),n.dropdown.button.setAttribute("title","Foreground Color"),n.colorInput.setAttribute("aria-label","Editor change foreground color"),this.menubar.append(n.colorInput);break;case"backColor":const c=document.createElement("button");c.innerHTML=this.useIcons?e("fill"):"&#9639;",this.useIcons?c.childNodes[0].style.borderBottom="2px solid rgb(255, 0, 0)":c.style.textDecorationColor="rgb(255, 0, 0)",c.setAttribute("title","Background Color"),c.classList.add("mimir-menubar-option-back-color-button"),c.addEventListener("click",function(){this.backColor(m.getValue())}.bind(this));const u=document.createElement("button");u.innerHTML="&#9660";const m=this.MimirUI.colorInput(this.backColor.bind(this),u,200,40,200);this.menubarOptions.backColor=m,m.colorInput.setAttribute("id","mimir-menubar-option-back-color");const h=document.createElement("div");h.classList.add("mimir-menubar-option-back-color-button-container"),h.append(c,m.dropdown.button),m.colorInput.prepend(h),m.dropdown.button.setAttribute("title","Background Color"),m.colorInput.setAttribute("aria-label","Editor change background color"),this.menubar.append(m.colorInput);break;case"sup":this.menubarOptions.sup=document.createElement("button"),this.menubarOptions.sup.setAttribute("id","mimir-menubar-option-sup"),this.menubarOptions.sup.innerHTML=this.useIcons?e("superscript"):"x<sup>2</sup>",this.menubarOptions.sup.addEventListener("click",this.sup.bind(this)),this.menubarOptions.sup.setAttribute("title","Superscript"),this.menubarOptions.sup.setAttribute("aria-pressed","false"),this.menubarOptions.sup.setAttribute("aria-label","Editor toggle superscript"),this.menubar.append(this.menubarOptions.sup);break;case"sub":this.menubarOptions.sub=document.createElement("button"),this.menubarOptions.sub.setAttribute("id","mimir-menubar-option-sub"),this.menubarOptions.sub.innerHTML=this.useIcons?e("subscript"):"x<sub>2</sub>",this.menubarOptions.sub.addEventListener("click",this.sub.bind(this)),this.menubarOptions.sub.setAttribute("title","Subscript"),this.menubarOptions.sub.setAttribute("aria-pressed","false"),this.menubarOptions.sub.setAttribute("aria-label","Editor toggle subscript"),this.menubar.append(this.menubarOptions.sub);break;case"link":const p=document.createElement("button");p.innerHTML=this.useIcons?e("link"):"&#128279;",p.classList.add("mimir-menubar-option-link-button");const g=this.MimirUI.linkInput(this.link.bind(this),p);this.menubarOptions.link=g,g.linkInput.setAttribute("id","mimir-menubar-option-link"),g.dropdown.button.setAttribute("title","Hyperlink"),g.linkInput.setAttribute("aria-pressed","false"),g.linkInput.setAttribute("aria-label","Editor insert link"),this.menubar.append(g.linkInput);break;case"quote":this.menubarOptions.quote=document.createElement("button"),this.menubarOptions.quote.setAttribute("id","mimir-menubar-option-quote"),this.menubarOptions.quote.innerHTML=this.useIcons?e("quote"):'"',this.menubarOptions.quote.addEventListener("click",this.quote.bind(this)),this.menubarOptions.quote.setAttribute("title","Blockquote"),this.menubarOptions.quote.setAttribute("aria-pressed","false"),this.menubarOptions.quote.setAttribute("aria-label","Editor toggle blockquote"),this.menubar.append(this.menubarOptions.quote);break;case"header":t=[];const f=(e,t)=>{const n=document.createElement("strong");return n.innerHTML=`<span style="font-size: ${e}px" title="${t}" aria-label="Editor select header ${t}">${t}</span>`,n},b=e=>{const t=document.createElement("div");return t.innerHTML=`<span aria-label="Editor select header ${e}">${e}</span>`,t},y={Paragraph:[(e=>{const t=document.createElement("span");return t.innerHTML=`<span title="${e}" aria-label="Editor select header ${e}">${e}</span>`,t})("Paragraph"),b("Paragraph")],H1:[f(36,"Heading 1"),b("Heading 1")],H2:[f(24,"Heading 2"),b("Heading 2")],H3:[f(18,"Heading 3"),b("Heading 3")],H4:[f(16,"Heading 4"),b("Heading 4")],H5:[f(14,"Heading 5"),b("Heading 5")],H6:[f(12,"Heading 6"),b("Heading 6")]};for(const e of["Paragraph","H1","H2","H3","H4","H5","H6"])t.push({name:e,content:y[e][0],buttonDisplay:y[e][1]});this.menubarOptions.header=this.MimirUI.dropdownList(t,this.header.bind(this)),this.menubarOptions.header.list.setAttribute("id","mimir-menubar-option-header"),this.menubarOptions.header.dropdown.button.setAttribute("title","Header"),this.menubarOptions.header.list.setAttribute("aria-label","Editor select header"),this.menubar.append(this.menubarOptions.header.list);break;case"align":t=[];for(const n of["Left","Right","Center","Justify"]){const i=document.createElement("div");i.innerHTML=this.useIcons?e("align-"+n.toLowerCase()):n,i.style.width="18px",i.setAttribute("value",n.toLowerCase()),i.setAttribute("title",n),i.setAttribute("aria-label","Editor change alignment "+n),t.push({name:n.toLowerCase(),content:i})}this.menubarOptions.align=this.MimirUI.dropdownList(t,this.align.bind(this)),this.menubarOptions.align.list.setAttribute("id","mimir-menubar-option-align"),this.menubarOptions.align.dropdown.button.setAttribute("title","Alignment"),this.menubarOptions.align.list.setAttribute("aria-label","Editor change alignment"),this.menubar.append(this.menubarOptions.align.list);break;case"list":this.menubarOptions.listOrdered=document.createElement("button"),this.menubarOptions.listOrdered.setAttribute("id","mimir-menubar-option-ordered-list"),this.menubarOptions.listOrdered.innerHTML=this.useIcons?e("list-ordered"):"OL",this.menubarOptions.listOrdered.addEventListener("click",this.listOrdered.bind(this)),this.menubarOptions.listOrdered.setAttribute("title","Ordered List"),this.menubarOptions.listOrdered.setAttribute("aria-label","Editor toggle ordered list"),this.menubar.append(this.menubarOptions.listOrdered),this.menubarOptions.listUnordered=document.createElement("button"),this.menubarOptions.listUnordered.setAttribute("id","mimir-menubar-option-unordered-list"),this.menubarOptions.listUnordered.innerHTML=this.useIcons?e("list-unordered"):"UL",this.menubarOptions.listUnordered.addEventListener("click",this.listUnordered.bind(this)),this.menubarOptions.listUnordered.setAttribute("title","Unordered List"),this.menubarOptions.listUnordered.setAttribute("aria-label","Editor toggle unordered list"),this.menubar.append(this.menubarOptions.listUnordered);break;case"indent":this.menubarOptions.indent=document.createElement("button"),this.menubarOptions.indent.setAttribute("id","mimir-menubar-option-indent"),this.menubarOptions.indent.innerHTML=this.useIcons?e("indent"):">",this.menubarOptions.indent.addEventListener("click",this.indent.bind(this)),this.menubarOptions.indent.setAttribute("title","Indent"),this.menubarOptions.indent.setAttribute("aria-label","Editor increase indent"),this.menubar.append(this.menubarOptions.indent);break;case"outdent":this.menubarOptions.outdent=document.createElement("button"),this.menubarOptions.outdent.setAttribute("id","mimir-menubar-option-outdent"),this.menubarOptions.outdent.innerHTML=this.useIcons?e("outdent"):"<",this.menubarOptions.outdent.addEventListener("click",this.outdent.bind(this)),this.menubarOptions.outdent.setAttribute("title","Outdent"),this.menubarOptions.outdent.setAttribute("aria-label","Editor decrease indent"),this.menubar.append(this.menubarOptions.outdent);break;case"insertImage":const N=document.createElement("button");N.innerHTML=this.useIcons?e("image"):"&#128444;",N.classList.add("mimir-menubar-option-image-button");const v=this.MimirUI.imageInput(this.insertImage.bind(this),N,this.imageObjectURLs);this.menubarOptions.insertImage=v,v.imageInput.setAttribute("id","mimir-menubar-option-image"),v.dropdown.button.setAttribute("title","Insert Image"),v.imageInput.setAttribute("aria-label","Editor insert image"),this.menubar.append(v.imageInput);break;case"insertHorizontalRule":this.menubarOptions.hr=document.createElement("button"),this.menubarOptions.hr.setAttribute("id","mimir-menubar-option-hr"),this.menubarOptions.hr.innerHTML=this.useIcons?e("hr"):"&#9135;",this.menubarOptions.hr.addEventListener("click",this.insertHR.bind(this)),this.menubarOptions.hr.setAttribute("title","Horizontal Line"),this.menubarOptions.hr.setAttribute("aria-label","Editor insert horizontal line"),this.menubar.append(this.menubarOptions.hr);break;case"undo":this.menubarOptions.undo=document.createElement("button"),this.menubarOptions.undo.setAttribute("id","mimir-menubar-option-undo"),this.menubarOptions.undo.innerHTML=this.useIcons?e("undo"):"&#8630;",this.menubarOptions.undo.addEventListener("click",this.undo.bind(this)),this.menubarOptions.undo.setAttribute("title","Undo"),this.menubarOptions.undo.setAttribute("aria-label","Editor undo"),this.menubar.append(this.menubarOptions.undo);break;case"redo":this.menubarOptions.redo=document.createElement("button"),this.menubarOptions.redo.setAttribute("id","mimir-menubar-option-redo"),this.menubarOptions.redo.innerHTML=this.useIcons?e("redo"):"&#8631;",this.menubarOptions.redo.addEventListener("click",this.redo.bind(this)),this.menubarOptions.redo.setAttribute("title","Redo"),this.menubarOptions.redo.setAttribute("aria-label","Editor redo"),this.menubar.append(this.menubarOptions.redo);break;case"remove":this.menubarOptions.remove=document.createElement("button"),this.menubarOptions.remove.setAttribute("id","mimir-menubar-option-remove"),this.menubarOptions.remove.innerHTML=this.useIcons?e("remove"):"X",this.menubarOptions.remove.addEventListener("click",this.remove.bind(this)),this.menubarOptions.remove.setAttribute("title","Remove Styling"),this.menubarOptions.remove.setAttribute("aria-label","Editor remove all styling"),this.menubar.append(this.menubarOptions.remove);break;case"openFindAndReplace":this.menubarOptions.openFindAndReplace=document.createElement("button"),this.menubarOptions.openFindAndReplace.setAttribute("id","mimir-menubar-option-open-find-and-replace"),this.menubarOptions.openFindAndReplace.innerHTML=this.useIcons?e("search"):"&#128270;",this.menubarOptions.openFindAndReplace.addEventListener("click",this.openFindAndReplace.bind(this)),this.menubarOptions.openFindAndReplace.setAttribute("title","Find and Replace"),this.menubarOptions.openFindAndReplace.setAttribute("aria-label","Editor open find and replace dialog"),this.menubarOptions.openFindAndReplace.setAttribute("aria-haspopup","true"),this.menubarOptions.openFindAndReplace.setAttribute("aria-expanded","false"),this.menubar.append(this.menubarOptions.openFindAndReplace);break;case"zoom":t=[];for(const e of this.zoomOptions){const n=document.createElement("div");n.innerHTML=e+"%",n.style.width="34px",n.setAttribute("value",e.toLowerCase()),n.setAttribute("title",e),n.setAttribute("aria-label","Editor adjust zoom "+e+"%"),t.push({name:e,content:n})}this.menubarOptions.zoom=this.MimirUI.dropdownList(t,this.changeZoom.bind(this)),this.menubarOptions.zoom.list.setAttribute("id","mimir-menubar-option-zoom"),this.menubarOptions.zoom.dropdown.button.setAttribute("title","Zoom level"),this.menubarOptions.zoom.list.setAttribute("aria-label","Editor change alignment"),this.menubarOptions.zoom.setValue("100"),this.menubar.append(this.menubarOptions.zoom.list)}if(this.menubarSettings.indexOf(i)==this.menubarSettings.length-1)continue;const o=document.createElement("div");o.classList.add("mimir-menubar-spacer"),this.menubar.append(o)}}bindKeyboardEvents(){this.editor.addEventListener("keydown",function(e){if("b"==e.key.toLowerCase()&&(e.ctrlKey||e.metaKey))return e.preventDefault(),void this.bold();if("i"==e.key.toLowerCase()&&(e.ctrlKey||e.metaKey))return e.preventDefault(),void this.italic();if("u"==e.key.toLowerCase()&&(e.ctrlKey||e.metaKey))return e.preventDefault(),void this.underline();if("z"==e.key.toLowerCase()&&(e.ctrlKey||e.metaKey))return e.preventDefault(),void this.undo();if("y"==e.key.toLowerCase()&&(e.ctrlKey||e.metaKey))return e.preventDefault(),void this.redo();if("a"!=e.key.toLowerCase()||!e.ctrlKey&&!e.metaKey){if("f"==e.key.toLowerCase()&&(e.ctrlKey||e.metaKey))return e.preventDefault(),void this.openFindAndReplace();if("Enter"==e.key&&(this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0),"Tab"==e.key&&(e.preventDefault(),this.insertTab()),"ArrowLeft"==e.key||"Backspace"==e.key||"Delete"==e.key){const a=this.getRange();if(!a)return;if(this.currentCursor&&this.currentCursor.contains(a.commonAncestorContainer)){for(r=this.currentCursor;this.inEditor(r.parentNode)&&r.parentNode!=this.editor&&this.isEmpty(r.parentNode)&&(this.inlineStylingTags.includes(r.parentNode.tagName)||"SPAN"==r.parentNode.tagName);)r=r.parentNode;const e=this.leftSiblingIgnoreEmpty(r),t=this.rightSiblingIgnoreEmpty(r);if(this.blockTags.includes(r.parentNode.tagName)&&this.isEmpty(r.parentNode)&&!this.childlessTags.includes(r.parentNode.tagName))r.before(document.createElement("BR"));else if(e&&this.blockTags.includes(e.tagName)&&(!t||this.blockTags.includes(t.tagName))||t&&this.blockTags.includes(t.tagName)&&(!e||this.blockTags.includes(e.tagName))){t&&"BR"==t.tagName&&t.remove(),e&&"BR"==e.tagName&&e.remove();const n=document.createElement("div");n.append(document.createElement("br")),r.before(n)}return r.remove(),this.currentCursor=null,void this.updateMenubarOptions()}if(a.endContainer.nodeType==Node.TEXT_NODE)var t=a.endContainer.textContent.length;else t=a.endContainer.childNodes.length;if(0==a.startOffset&&a.endOffset>=t&&(a.startOffset!=a.endOffset||a.startContainer!=a.endContainer)&&"ArrowLeft"!=e.key||"Backspace"==e.key&&1==a.commonAncestorContainer.textContent.length&&a.endOffset>=1||"Delete"==e.key&&1==a.commonAncestorContainer.textContent.length&&0==a.endOffset){if(e.preventDefault(),0==a.startOffset&&a.endOffset>=t&&(a.startOffset!=a.endOffset||a.startContainer!=a.endContainer)){const e=a.extractContents();this.imageModule.getSelected()&&this.imageModule.deselect();const t=[],s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);for(;s.nextNode();)t.push(s.currentNode);if(0==t.length)return;const l=[];var n=!0;for(const o of t)if(o.nodeType!=Node.TEXT_NODE||""!=o.textContent){r=o.parentNode;for(var i=[];r!=e;)i.push(...this.getStylingOfElement(r)),r=r.parentNode;if(n)l.push(...i),n=!1;else{for(const e of l.slice(0,l.length))i.some((t=>this.compareStyling(t,e)))||this.requireSingleNodeToActivateStylingCommands.includes(e.type)||l.splice(l.findIndex((t=>t.type==e.type)),1);for(const e of i)this.requireSingleNodeToActivateStylingCommands.includes(e.type)&&(l.some((t=>this.compareStyling(t,e)))||l.push(e))}}const d=this.createCursor();var o=d;for(const e of l){if(!this.inlineStylingCommands.includes(e.type))continue;const t=this.styleToElement(e);t.append(o),o=t}a.insertNode(o);const c=new Range;return c.selectNodeContents(d),c.collapse(),document.getSelection().removeAllRanges(),document.getSelection().addRange(c),void this.updateMenubarOptions()}const l=new Range,{nodes:d,startOffset:c,endOffset:u}=this.getTextNodesInRange(a);if(0==d.length)return;l.selectNode(d[0]);const m=this.detectStyling(l),h=this.createCursor();o=h;for(const e of m){if(!this.inlineStylingCommands.includes(e.type))continue;const t=this.styleToElement(e);t.append(o),o=t}if(a.startContainer.textContent="",this.imageModule.getSelected()&&this.imageModule.deselect(),a.startContainer.nodeType==Node.TEXT_NODE){if(((s=a.startContainer).nodeType==Node.ELEMENT_NODE&&(this.inlineStylingTags.includes(s.tagName)||"SPAN"==s.tagName)||this.inlineStylingTags.includes(s.parentNode.tagName)||"SPAN"==s.parentNode.tagName)&&(s=this.findLastParent(s,(e=>this.inlineStylingTags.includes(e.tagName)||"SPAN"==e.tagName))),a.startContainer!=s){const e=this.splitNodeAtChild(s,a.startContainer);s.after(o,e),this.isEmpty(e)&&e!=this.editor&&e.remove()}else s.after(o);s&&this.isEmpty(s)&&s!=this.editor&&s.remove()}else if(a.startContainer==this.editor)a.startContainer.prepend(o);else{var s;if(((s=a.startContainer).nodeType==Node.ELEMENT_NODE&&(this.inlineStylingTags.includes(s.tagName)||"SPAN"==s.tagName)||this.inlineStylingTags.includes(s.parentNode.tagName)||"SPAN"==s.parentNode.tagName)&&(s=this.findLastParent(s,(e=>this.inlineStylingTags.includes(e.tagName)||"SPAN"==e.tagName))),a.startContainer!=s){const e=this.splitNodeAtChild(s,a.startContainer);s.after(o,e),this.isEmpty(e)&&e!=this.editor&&e.remove()}else s.after(o);s&&this.isEmpty(s)&&s!=this.editor&&s.remove()}const p=new Range;p.selectNodeContents(h),p.collapse(),document.getSelection().removeAllRanges(),document.getSelection().addRange(p)}this.updateMenubarOptions()}if(1==e.key.length&&!e.ctrlKey&&!e.metaKey){this.shouldTakeSnapshotOnNextChange&&(this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!1);const t=this.getRange();if(null!=t&&this.currentCursor&&this.currentCursor.contains(t.commonAncestorContainer)){e.preventDefault();const t=this.currentCursor,n=document.createTextNode(e.key);t.before(n),t.remove(),this.currentCursor=null;const i=new Range;return i.selectNodeContents(n),i.collapse(!1),document.getSelection().removeAllRanges(),document.getSelection().addRange(i),void this.updateMenubarOptions()}}}else{if(this.rangeCache=null,this.currentCursor){for(var r=this.currentCursor;this.inEditor(r.parentNode)&&r.parentNode!=this.editor&&this.isEmpty(r.parentNode)&&(this.inlineStylingTags.includes(r.parentNode.tagName)||"SPAN"==r.parentNode.tagName);)r=r.parentNode;const e=this.leftSiblingIgnoreEmpty(r),t=this.rightSiblingIgnoreEmpty(r);if(this.blockTags.includes(r.parentNode.tagName)&&this.isEmpty(r.parentNode)&&!this.childlessTags.includes(r.parentNode.tagName))r.before(document.createElement("BR"));else if(e&&this.blockTags.includes(e.tagName)&&(!t||this.blockTags.includes(t.tagName))||t&&this.blockTags.includes(t.tagName)&&(!e||this.blockTags.includes(e.tagName))){t&&"BR"==t.tagName&&t.remove(),e&&"BR"==e.tagName&&e.remove();const n=document.createElement("div");n.append(document.createElement("br")),r.before(n)}r.remove(),this.currentCursor=null}this.editor.innerHTML=this.editor.innerHTML}}.bind(this))}bindInputEvents(){this.editor.addEventListener("beforeinput",function(e){if(this.editor.dispatchEvent(new Event("mimiredited")),"formatBold"==e.inputType)return e.preventDefault(),void this.bold();if("formatItalic"==e.inputType)return e.preventDefault(),void this.italic();if("formatUnderline"==e.inputType)return e.preventDefault(),void this.underline();if("historyUndo"==e.inputType)return e.preventDefault(),void this.undo();if("historyRedo"==e.inputType)return e.preventDefault(),void this.redo();if("insertParagraph"==e.inputType){var t=this.handleEscapeBlockquote(e);(t|=this.handleEscapeLists(e))||this.handleEscapeCursorParagraph(e)}else"insertText"!=e.inputType&&!e.inputType.startsWith("deleteContent")||e.key||this.removeCursor()}.bind(this))}handleEscapeBlockquote(e){for(var t=this.getRange()?.commonAncestorContainer;!this.blockTags.includes(t.tagName)&&this.inEditor(t);)t=t.parentNode;if("DIV"==t.tagName||"P"==t.tagName||"BR"==t.tagName){for(var n=t;"BLOCKQUOTE"!=n.tagName&&this.inEditor(n.parentNode);)n=n.parentNode;"BLOCKQUOTE"==n.tagName&&(t=n)}if("BLOCKQUOTE"==t.tagName&&this.isEmptyOrLineBreak(t)){e.preventDefault();const n=document.createElement("div");if(n.append(...t.childNodes),t.after(n),t.remove(),t=n,this.currentCursor&&n.contains(this.currentCursor)){const e=new Range;return e.selectNodeContents(this.currentCursor),e.collapse(),document.getSelection().removeAllRanges(),document.getSelection().addRange(e),!0}const i=new Range;return i.setStart(t,0),document.getSelection().removeAllRanges(),document.getSelection().addRange(i),!0}return!1}handleEscapeLists(e){for(var t=this.getRange()?.commonAncestorContainer;!this.blockTags.includes(t.tagName)&&this.inEditor(t);)t=t.parentNode;if("DIV"==t.tagName||"P"==t.tagName||"BR"==t.tagName){for(var n=t;"LI"!=n.tagName&&this.inEditor(n.parentNode);)n=n.parentNode;"LI"==n.tagName&&(t=n)}if("LI"==t.tagName&&this.isEmptyOrLineBreak(t)){e.preventDefault();const n=t.parentNode,i=Array.from(n.childNodes).slice(Array.from(n.childNodes).indexOf(t)+1,n.childNodes.length),o=n.cloneNode(!1);if(o.append(...i),n.after(t,o),this.isEmpty(o)&&o.remove(),this.isEmpty(n)&&n.remove(),!["UL","OL"].includes(t.parentNode.tagName))if("LI"==t.parentNode.tagName){const e=Array.from(t.parentNode.childNodes).slice(Array.from(t.parentNode.childNodes).indexOf(t)+1,t.parentNode.childNodes.length);t.parentNode.after(t,...e),t.previousSibling&&this.isEmpty(t.previousSibling)&&t.previousSibling.remove()}else{const e=document.createElement("div");e.append(...t.childNodes),t.after(e),t.remove(),t=e}if(this.currentCursor&&t.contains(this.currentCursor)){const e=new Range;return e.selectNodeContents(this.currentCursor),e.collapse(),document.getSelection().removeAllRanges(),document.getSelection().addRange(e),!0}const s=new Range;return s.setStart(t,0),document.getSelection().removeAllRanges(),document.getSelection().addRange(s),!0}return!1}inlineSiblingsAfterNode(e){const t=[];for(;e.nextSibling&&!this.blockTags.includes(e.tagName);)e=e.nextSibling,t.push(e);return t}inlineSiblingsBeforeNode(e){const t=[];for(;e.previousSibling&&!this.blockTags.includes(e.tagName);)e=e.previousSibling,t.push(e);return t}handleEscapeCursorParagraph(e){const t=this.getRange();if(!t)return!1;if(!this.currentCursor||!this.currentCursor.contains(t.commonAncestorContainer))return!1;e.preventDefault();for(var n=t.commonAncestorContainer,i=null,o=null;!["LI"].includes(n.tagName)&&this.inEditor(n)&&n!=this.editor;)o=n,n=n.parentNode,this.blockTags.includes(n.tagName)&&n!=this.editor&&(i=n);if(n==this.editor){if(!i){if(o==this.currentCursor){const e=document.createElement("div");this.currentCursor.after(e),e.append(this.currentCursor);const t=new Range;return t.selectNodeContents(this.currentCursor),t.collapse(),document.getSelection().removeAllRanges(),document.getSelection().addRange(t),!0}const e=this.splitNodeAtChild(o,this.currentCursor,!0),t=this.inlineSiblingsAfterNode(o),n=document.createElement("div");n.append(e,...t),o.after(n);const i=document.createElement("div");if(o.after(i),i.append(o,...this.inlineSiblingsBeforeNode(o)),this.isEmpty(i)){for(var s=i;s.lastChild&&!this.childlessTags.includes(s.lastChild.tagName)&&s.lastChild.nodeType==Node.ELEMENT_NODE;)s=s.lastChild;s.append(document.createElement("br"))}const r=new Range;return r.selectNodeContents(this.currentCursor),r.collapse(),document.getSelection().removeAllRanges(),document.getSelection().addRange(r),!0}const e=this.splitNodeAtChild(i,this.currentCursor,!0);if(i.after(e),this.isEmpty(i)){for(s=i;s.lastChild&&!this.childlessTags.includes(s.lastChild.tagName)&&s.lastChild.nodeType==Node.ELEMENT_NODE;)s=s.lastChild;s.append(document.createElement("br"))}const t=new Range;return t.selectNodeContents(this.currentCursor),t.collapse(),document.getSelection().removeAllRanges(),document.getSelection().addRange(t),!0}const r=this.splitNodeAtChild(n,this.currentCursor,!0);if(n.after(r),this.isEmpty(n)){for(s=n;s.lastChild&&!this.childlessTags.includes(s.lastChild.tagName)&&s.lastChild.nodeType==Node.ELEMENT_NODE;)s=s.lastChild;s.append(document.createElement("br"))}const a=new Range;return a.selectNodeContents(this.currentCursor),a.collapse(),document.getSelection().removeAllRanges(),document.getSelection().addRange(a),!0}removeCursor(e=!0){const t=this.getRange();if(this.currentCursor&&this.currentCursor.contains(t.commonAncestorContainer)){for(var n=this.currentCursor;this.inEditor(n.parentNode)&&n.parentNode!=this.editor&&this.isEmpty(n.parentNode)&&(this.inlineStylingTags.includes(n.parentNode.tagName)||"SPAN"==n.parentNode.tagName);)n=n.parentNode;if(e){const e=this.leftSiblingIgnoreEmpty(n),t=this.rightSiblingIgnoreEmpty(n);if(this.blockTags.includes(n.parentNode.tagName)&&this.isEmpty(n.parentNode)&&!this.childlessTags.includes(n.parentNode.tagName))n.before(document.createElement("BR"));else if(e&&this.blockTags.includes(e.tagName)&&(!t||this.blockTags.includes(t.tagName))||t&&this.blockTags.includes(t.tagName)&&(!e||this.blockTags.includes(e.tagName))){t&&"BR"==t.tagName&&t.remove(),e&&"BR"==e.tagName&&e.remove();const i=document.createElement("div");i.append(document.createElement("br")),n.before(i)}}n.remove(),this.currentCursor=null,this.updateMenubarOptions()}}handleClickLink(e){const t=this.findClosestParent(e,(e=>"A"==e.tagName));if(!t)return;const n=t.getAttribute("href");n&&window.open(n)}bindClickEvents(){this.editor.addEventListener("click",function(e){e.ctrlKey&&this.handleClickLink(e.target)}.bind(this))}addStylingToNode(e,t){var n=e;for(const e of t){var i=this.styleToElement(e);i.append(n),n=i}return n}leftSibling(e){for(var t=e;this.inEditor(t)&&t!=this.editor;){if(t.previousSibling)return t.previousSibling;t=t.parentNode}return null}rightSibling(e){for(var t=e;this.inEditor(t)&&t!=this.editor;){if(t.nextSibling)return t.nextSibling;t=t.parentNode}return null}leftSiblingIgnoreEmpty(e){for(var t=e.previousSibling;t&&this.isEmpty(t);)t=t.previousSibling;return t}rightSiblingIgnoreEmpty(e){for(var t=e.nextSibling;t&&this.isEmpty(t);)t=t.nextSibling;return t}reconstructNodeContents(e,t,n,i=!0,o=null){const s=[];for(var r of Array.from(e.childNodes))if(r.nodeType==Node.TEXT_NODE||this.contentTags.includes(r.tagName)){for(var a=[],l=r,d=[];t.contains(l);){if(l.nodeType==Node.TEXT_NODE){l=l.parentNode;continue}var c=this.getStylingOfElement(l,!0);const e=(c=(c=c.filter((e=>!a.some((t=>e.type==t.type))))).filter((e=>!d.some((t=>e.type==t.target.type))))).filter((e=>"override"==e.type));c=(c=c.filter((e=>"override"!=e.type))).filter((e=>this.inlineStylingCommands.includes(e.type))),a.push(...c),d.push(...e),l=l.parentNode}if(r.nodeType==Node.ELEMENT_NODE){var u=r;if(r=document.createElement(u.tagName),"IMG"==u.tagName){if(u.getAttribute("src")){var m=u.getAttribute("src");if(m.toLowerCase().startsWith("http")||m.toLowerCase().startsWith("blob"))r.setAttribute("src",m);else if(m.toLowerCase().startsWith("data")){for(var h=m.split(",")[0].split(":")[1].split(";")[0],p=atob(m.split(",")[1]),g=[],f=0;f<p.length;f++)g.push(p.charCodeAt(f));const e=new Blob([new Uint8Array(g)],{type:h});m=URL.createObjectURL(e),r.setAttribute("src",m),this.imageObjectURLs.push(m)}}u.getAttribute("alt")&&r.setAttribute("alt",u.getAttribute("alt")),u.getAttribute("width")?r.style.width=u.getAttribute("width")+"px":u.style.width&&(r.style.width=u.style.width),u.getAttribute("height")?r.style.height=u.getAttribute("height")+"px":u.style.height&&(r.style.height=u.style.height)}}if(i){if(r.nodeType==Node.TEXT_NODE){if(r.textContent=r.textContent.replace(/[\t\n\r ]+/g," "),""==r.textContent.split(" ").join("")&&(" "==r.textContent[0]&&(r.textContent=r.textContent.slice(1,r.textContent.length))," "==r.textContent[r.textContent.length-1]&&(r.textContent=r.textContent.slice(0,r.textContent.length-1))),""==r.textContent)continue;r.previousSibling?r.nextSibling||" "==r.textContent[r.textContent.length-1]&&(r.textContent=r.textContent.slice(0,r.textContent.length-1)):" "==r.textContent[0]&&(r.textContent=r.textContent.slice(1,r.textContent.length))}r=this.addStylingToNode(r.cloneNode(),a),s.push(r)}else if(r.nodeType==Node.TEXT_NODE){const e=r.textContent.split(/\r?\n|\r|\n/g);var b=this.addStylingToNode(document.createTextNode(e[0]),a);""!=b.textContent&&s.push(b);for(const t of e.slice(1)){const e=document.createElement("br");""!=(b=this.addStylingToNode(document.createTextNode(t),a)).textContent?s.push(e,b):s.push(e)}}else r=this.addStylingToNode(r,a),s.push(r)}else if(r.nodeType==Node.ELEMENT_NODE){if(o&&o.includes(r.tagName))continue;var y=i;if("PRE"==r.tagName&&(y=!1),["pre","pre-wrap","pre-line","break-spaces"].some((e=>r.style.whiteSpace.toLowerCase().includes(e)))&&(y=!1),("OL"==r.tagName||"UL"==r.tagName)&&!Array.from(r.childNodes).some((e=>"LI"==e.tagName)))continue;if(["H1","H2","H3","H4","H5","H6"].includes(r.tagName)){var N=document.createElement("div");const e=this.reconstructNodeContents(r,t,n,y);if(N.append(...e),r.style.marginLeft||r.style.paddingLeft){const e=r.style.marginLeft?r.style.marginLeft:r.style.paddingLeft;if(e.toLowerCase().endsWith("px")){const t=parseInt(e.slice(0,-2)),n=Math.ceil(t/40);for(f=0;f<n;f++){const e=document.createElement("div");e.style.marginLeft="40px",e.append(N),N=e}}}s.push(N),n.push({node:N,inlineBlockStyling:this.getStylingOfElement(r).filter((e=>this.inlineBlockStylingCommands.includes(e.type)))});continue}if(!this.basicAllowedTags.includes(r.tagName)){const e=this.reconstructNodeContents(r,t,n,y);if("address, article, aside, blockquote, canvas, dd, div, dl, dt, tr, fieldset, figcaption, figure, footer, form, h1, h2, h3, h4, h5, h6, header, hr, li, main, nav, noscript, ol, p, pre, section, table, tfoot, ul, video".toUpperCase().split(", ").includes(r.tagName.toUpperCase())){(N=document.createElement("div")).append(...e);const t=r.style.marginLeft?r.style.marginLeft:r.style.paddingLeft;if(t&&t.toLowerCase().endsWith("px")){const e=parseInt(t.slice(0,-2)),n=Math.ceil(e/40);for(f=0;f<n;f++){const e=document.createElement("div");e.style.marginLeft="40px",e.append(N),N=e}}s.push(N);continue}s.push(...e);continue}N=document.createElement(r.tagName);const e=this.getStylingOfElement(r).filter((e=>this.inlineBlockStylingCommands.includes(e.type)));0!=e.length&&this.blockTags.includes(N.tagName)&&n.push({node:N,inlineBlockStyling:e}),"A"==r.tagName&&r.getAttribute("href")&&"javascript:"!==r.getAttribute("href").trim().substring(0,11).toLowerCase()&&N.setAttribute("href",r.getAttribute("href"));const a=this.reconstructNodeContents(r,t,n,y);if(N.append(...a),"LI"==r.tagName&&r.style.listStyleType&&(N.style.listStyleType=r.style.listStyleType),"LI"==r.tagName&&r.style.listStyle&&r.style.listStyle.split(" ").length>0&&(N.style.listStyleType=r.style.listStyle.split(" ")[0]),["UL","OL"].includes(r.tagName)&&r.style.listStyleType&&a.forEach((e=>{e.style.listStyleType=r.style.listStyleType})),["UL","OL"].includes(r.tagName)&&r.style.listStyle&&r.style.listStyle.split(" ").length>0){const e=r.style.listStyle.split(" ")[0];a.forEach((t=>{t.style.listStyleType=e}))}if(r.style.marginLeft||r.style.paddingLeft){const e=r.style.marginLeft?r.style.marginLeft:r.style.paddingLeft;if(e.toLowerCase().endsWith("px")){const t=parseInt(e.slice(0,-2)),n=Math.ceil(t/40);for(f=0;f<n;f++){const e=document.createElement("div");e.style.marginLeft="40px",e.append(N),N=e}}}s.push(N)}return s}sanitize(e,t=null){const n=document.createElement("div");n.innerHTML=e;const i=[],o=this.reconstructNodeContents(n,n,i,!0,t),s=[];for(const h of o)(0!=o.indexOf(h)&&o.indexOf(h)!=o.length-1||h.nodeType!=Node.TEXT_NODE||""!=h.textContent.split("\n").join("").split("\r").join("").split(" ").join(""))&&s.push(h);const r=document.createDocumentFragment();r.append(...s);for(const p of i)if(r.contains(p.node))for(const g of p.inlineBlockStyling){var a=null,l=null;const f=[];if("header"==g.type)var d="blockquote, ul, ol, li, h1, h2, h3, h4, h5, h6, div, p";else this.inlineBlockStylingCommands.includes(g.type)&&(d="blockquote, ul, ol, li, div, p");function b(e){if(e.nodeType==Node.ELEMENT_NODE&&d&&(e.matches(d)||e.querySelector(d)))for(const t of e.childNodes)b(t);else f.push(e)}for(var c of((b=b.bind(this))(p.node),f)){const y=c,N=c.nextSibling,v=this.styleToElement(g),C=document.createTextNode("");c.after(C),0==v.childNodes.length?v.appendChild(c):v.childNodes[0].appendChild(c),C.replaceWith(v),c=v,a&&a.nextSibling==c&&!this.blockTags.filter((e=>"BR"!=e)).includes(y.tagName)&&l==y?(a.append(...c.childNodes),c.remove()):a=c,l=N}}const u=r.querySelectorAll("div, p"),m=[];for(const E of u)!E.getAttribute("style")&&Array.from(E.childNodes).every((e=>this.blockTags.filter((e=>"BR"!=e)).includes(e.tagName)||""==e.textContent))&&m.push(E);for(const x of m)x.after(...x.childNodes),x.remove();return Array.from(r.childNodes)}scrollTextNodeIntoView(e){const t=document.createElement("a");t.innerHTML=" ",e.after(t),t.scrollIntoView({block:"start"}),t.remove()}insertTab(){const e=this.getRange();if(!e)return;if(this.editor.dispatchEvent(new Event("mimiredited")),this.currentCursor&&this.currentCursor.contains(e.commonAncestorContainer)){const e=document.createTextNode("\t");this.currentCursor.after(e),this.currentCursor.remove(),this.currentCursor=null;const t=new Range;return t.selectNodeContents(e),t.collapse(!1),window.getSelection().removeAllRanges(),void window.getSelection().addRange(t)}e.deleteContents(),this.imageModule.getSelected()&&this.imageModule.deselect();const t=document.createTextNode("\t");if(this.childlessTags.includes(e.commonAncestorContainer)){e.commonAncestorContainer.after(t),e.commonAncestorContainer.remove();const n=new Range;return n.selectNodeContents(t),n.collapse(!1),window.getSelection().removeAllRanges(),void window.getSelection().addRange(n)}if(this.isEmptyOrLineBreak(e.commonAncestorContainer)){const n=e.commonAncestorContainer.querySelector("br");if(n){n.replaceWith(t);const e=new Range;return e.selectNodeContents(t),e.collapse(!1),window.getSelection().removeAllRanges(),void window.getSelection().addRange(e)}}e.insertNode(t);const n=new Range;n.selectNodeContents(t),n.collapse(!1),window.getSelection().removeAllRanges(),window.getSelection().addRange(n)}findLastParent(e,t){for(var n=e,i=null;this.inEditor(n)&&this.editor!=n;)t(n)&&(i=n),n=n.parentElement;return i}findClosestParent(e,t){for(var n=e;this.inEditor(n)&&this.editor!=n;){if(t(n))return n;n=n.parentElement}return null}insertHTML(e,t,n="end",i=null,o=null){if(t){if(0==(s=this.sanitize(t,o)).length)return}else{if(!i)return;var s=i}if(1==s.length&&""==s[0].textContent){"IMG"==s[0].tagName&&(n=null,this.onNodeDrawn(s[0],function(){this.imageModule.select(s[0])}.bind(this)));const e=s[0].querySelectorAll(this.contentTags.join(", "));1==e.length&&"IMG"==e[0].tagName&&(n=null,this.onNodeDrawn(e[0],function(){this.imageModule.select(e[0])}.bind(this)))}var r=e,a=null;for(var l of s){if(l.nodeType==Node.TEXT_NODE)r.after(l),r=l;else if(l.nodeType!=Node.ELEMENT_NODE||!this.inlineStylingTags.includes(l.tagName)&&"SPAN"!=l.tagName)if(l.nodeType==Node.ELEMENT_NODE&&"LI"==l.tagName)if(u=this.findLastParent(r,(e=>e.nodeType==Node.ELEMENT_NODE&&("OL"==e.tagName||"UL"==e.tagName)))){const e=document.createTextNode("");r.after(e);const t=this.splitNodeAtChild(u,e);r=u,r=l,u.append(l),null==t||this.isEmpty(t)||u.append(...t.childNodes)}else{var d=this.findLastParent(r,(e=>e.nodeType==Node.ELEMENT_NODE&&(this.blockTags.includes(l.tagName)||this.stylingTags.includes(e.tagName)||"SPAN"==e.tagName)));const e=document.createElement("li");if(e.append(l),l=e,d){const e=document.createTextNode("");r.after(e);const t=this.splitNodeAtChild(d,e);null!=t&&(this.isEmpty(t)||d.after(t)),r=l,d.after(l)}else r.after(l),r=l}else{if("BR"==l.tagName){const e=document.createElement("div");e.append(l),l=e}if(!a){var c=this.findClosestParent(r,(e=>e.tagName==l.tagName));if(c){const e=document.createTextNode("");r.after(e);const t=this.splitNodeAtChild(c,e);r=c;const n=Array.from(l.childNodes).filter((e=>!this.isEmpty(e)));this.isEmpty(r.lastChild)?(r.lastChild.remove(),r=0!=n.length?n[n.length-1]:r,c.append(...n),null==t||this.isEmpty(t)||c.append(...t.childNodes),a=r):(r=0!=n.length?n[n.length-1]:r,c.append(...n),null==t||this.isEmpty(t)||c.append(...t.childNodes),a=r);continue}}var u;if(u=this.findLastParent(r,(e=>e.nodeType==Node.ELEMENT_NODE&&(this.blockTags.includes(l.tagName)||this.stylingTags.includes(e.tagName)||"SPAN"==e.tagName)))){const e=document.createTextNode("");r.after(e);const t=this.splitNodeAtChild(u,e);null!=t&&(this.isEmpty(t)||u.after(t)),r=u}r.after(l),this.isEmpty(r)&&r.remove(),r=l}else{var m=this.findLastParent(r,(e=>e.nodeType==Node.ELEMENT_NODE&&(this.inlineStylingTags.includes(e.tagName)||"SPAN"==e.tagName)));if(m){const e=document.createTextNode("");r.after(e);const t=this.splitNodeAtChild(m,e);null!=t&&(this.isEmpty(t)||m.after(t)),r=m}r.after(l),this.isEmpty(r)&&r.remove(),r=l}a||(a=r)}if("end"==n){const e=new Range;return e.selectNodeContents(r),e.collapse(!1),e}if("all"==n){const e=new Range;return e.setStart(a,0),e.setEndAfter(r),e}}bindPasteEvents(){this.editor.addEventListener("paste",function(e){if(this.editor.dispatchEvent(new Event("mimiredited")),this.saveHistory(),this.imageModule.deselect(),this.removeCursor(!1),e.clipboardData.getData("text/html")&&this.allowPasteHTML){e.preventDefault();const t=this.getRange();if(null==t)return;t.deleteContents(),this.imageModule.getSelected()&&this.imageModule.deselect();const n=document.createTextNode("");if(t.startContainer.nodeType==Node.TEXT_NODE){const e=document.createTextNode(t.startContainer.textContent.slice(t.startOffset,t.startContainer.textContent.length));t.startContainer.textContent=t.startContainer.textContent.slice(0,t.startOffset),t.startContainer.after(n,e)}else 0==t.startOffset?this.childlessTags.includes(t.startContainer.tagName)?t.startContainer.after(n):t.startContainer.prepend(n):t.startContainer.childNodes[t.startOffset-1].after(n);const i=this.insertHTML(n,e.clipboardData.getData("text/html"));i&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(i))}}.bind(this))}bindDragEvents(){this.editor.addEventListener("drag",function(e){this.dragRangeToRemove=this.getRange()}.bind(this)),this.editor.addEventListener("dragend",function(e){this.dragRangeToRemove=null}.bind(this)),this.editor.addEventListener("drop",function(e){if(this.editor.dispatchEvent(new Event("mimiredited")),this.saveHistory(),this.imageModule.deselect(),this.removeCursor(!1),e.dataTransfer.getData("text/html")){if(e.preventDefault(),document.caretRangeFromPoint)var t=document.caretRangeFromPoint(e.clientX,e.clientY);else{if(!document.caretPositionFromPoint)return void console.error("Cannot find selection drop range. Try using a newer browser.");{const n=document.caretPositionFromPoint(e.clientX,e.clientY);if(t=document.createRange(),!n)return;(t=document.createRange()).setStart(n.offsetNode,n.offset),t.setEnd(n.offsetNode,n.offset)}}if(!this.inEditor(t.commonAncestorContainer))return;const r=this.dragRangeToRemove,a=document.createTextNode("");if(r){var n=r.startContainer,i=r.startOffset,o=r.endContainer,s=r.endOffset;if(t.startContainer.nodeType==Node.TEXT_NODE){const e=t.startOffset,r=document.createTextNode(t.startContainer.textContent.slice(e,t.startContainer.textContent.length));t.startContainer.textContent=t.startContainer.textContent.slice(0,e),t.startContainer.after(a,r),n==t.startContainer?i>=e&&(n=r,i-=e):n==t.startContainer.parentNode&&i>=Array.from(a.parentNode.childNodes).indexOf(a)&&(i+=2),o==t.startContainer?s>=e&&(o=r,s-=e):o==t.startContainer.parentNode&&s>=Array.from(a.parentNode.childNodes).indexOf(a)&&(s+=2)}else 0==t.startOffset?this.childlessTags.includes(t.startContainer.tagName)?(t.startContainer.before(a),n==t.startContainer.parentNode&&i>=Array.from(a.parentNode.childNodes).indexOf(a)&&(i+=1),o==t.startContainer.parentNode&&s>=Array.from(a.parentNode.childNodes).indexOf(a)&&(s+=1)):(t.startContainer.prepend(a),n==t.startContainer&&i>=t.startOffset&&(i+=1),o==t.startContainer&&s>=t.startOffset&&(s+=1)):(t.startContainer.childNodes[t.startOffset-1].after(a),n==t.startContainer&&i>=t.startOffset&&(i+=1),o==t.startContainer&&s>=t.startOffset&&(s+=1));const e=new Range;if(e.setStart(n,i),e.setEnd(o,s),e.intersectsNode(a))return void console.error("Drag source contains drop location.");e.deleteContents(),this.imageModule.getSelected()&&this.imageModule.deselect()}else if(t.startContainer.nodeType==Node.TEXT_NODE){const e=t.startOffset,n=document.createTextNode(t.startContainer.textContent.slice(e,t.startContainer.textContent.length));t.startContainer.textContent=t.startContainer.textContent.slice(0,e),t.startContainer.after(a,n)}else 0==t.startOffset?this.childlessTags.includes(t.startContainer.tagName)?t.startContainer.before(a):t.startContainer.prepend(a):t.startContainer.childNodes[t.startOffset-1].after(a);const l=e.dataTransfer.getData("text/html"),d=this.insertHTML(a,l,"all");d&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(d))}}.bind(this))}updateMenubarOptions(){const e=this.getRange();if(null==e)return;const t=this.detectStyling(e);for(const e of this.commands)"font"!=e?"header"!=e?"align"!=e?"size"!=e?this.noUIUpdateStylingCommands.includes(e)||("list"!=e?t.some((t=>t.type==e))?(this.menubarOptions[e].classList.contains("mimir-pressed")||this.menubarOptions[e].classList.add("mimir-pressed"),this.menubarOptions[e].setAttribute("aria-pressed","true")):(this.menubarOptions[e].classList.contains("mimir-pressed")&&this.menubarOptions[e].classList.remove("mimir-pressed"),this.menubarOptions[e].setAttribute("aria-pressed","false")):(t.find((e=>"list"==e.type&&"ordered"==e.listType))?(this.menubarOptions.listOrdered.classList.contains("mimir-pressed")||this.menubarOptions.listOrdered.classList.add("mimir-pressed"),this.menubarOptions.listOrdered.setAttribute("aria-pressed","true")):(this.menubarOptions.listOrdered.classList.remove("mimir-pressed"),this.menubarOptions.listOrdered.setAttribute("aria-pressed","false")),t.find((e=>"list"==e.type&&"unordered"==e.listType))?(this.menubarOptions.listUnordered.classList.contains("mimir-pressed")||this.menubarOptions.listUnordered.classList.add("mimir-pressed"),this.menubarOptions.listUnordered.setAttribute("aria-pressed","true")):(this.menubarOptions.listUnordered.classList.remove("mimir-pressed"),this.menubarOptions.listUnordered.setAttribute("aria-pressed","false")))):this.menubarOptions.size.value=t.find((e=>"size"==e.type))?t.find((e=>"size"==e.type)).size:this.defaultSize:this.menubarOptions.align.setValue(t.find((e=>"align"==e.type))?t.find((e=>"align"==e.type)).direction:"left"):this.menubarOptions.header.setValue(t.find((e=>"header"==e.type))?t.find((e=>"header"==e.type)).level:"Paragraph"):this.menubarOptions.font.setValue(t.find((e=>"font"==e.type))?t.find((e=>"font"==e.type)).family:"")}onChangeSelect(){var e=this.getRange();if(null!=e){if(this.currentCursor&&!this.currentCursor.contains(e.commonAncestorContainer)){for(var t=this.currentCursor;this.inEditor(t.parentNode)&&t.parentNode!=this.editor&&this.isEmpty(t.parentNode)&&(this.inlineStylingTags.includes(t.parentNode.tagName)||"SPAN"==t.parentNode.tagName);)t=t.parentNode;const e=this.leftSiblingIgnoreEmpty(t),n=this.rightSiblingIgnoreEmpty(t);if(this.blockTags.includes(t.parentNode.tagName)&&this.isEmpty(t.parentNode)&&!this.childlessTags.includes(t.parentNode.tagName))t.before(document.createElement("BR"));else if(e&&this.blockTags.includes(e.tagName)&&(!n||this.blockTags.includes(n.tagName))||n&&this.blockTags.includes(n.tagName)&&(!e||this.blockTags.includes(e.tagName))){n&&"BR"==n.tagName&&n.remove(),e&&"BR"==e.tagName&&e.remove();const i=document.createElement("div");i.append(document.createElement("br")),t.before(i)}t.remove(),this.currentCursor=null}this.updateMenubarOptions()}}bindSelectEvents(){const e=this.onChangeSelect.bind(this);this.editor.addEventListener("focus",function(t){e(),document.addEventListener("selectionchange",e)}.bind(this)),this.editor.addEventListener("focusout",function(t){const n=document.getSelection();if(0!=n.rangeCount){const e=n.getRangeAt(0);this.editor.contains(e.commonAncestorContainer)&&(this.rangeCache=e)}e(),document.removeEventListener("selectionchange",e)}.bind(this)),this.editor.addEventListener("click",function(e){if(3==e.detail){const e=this.getRange();for(var t=e.startContainer,n=e.startOffset,i=e.endContainer,o=e.endOffset;i[o]&&this.isEmpty(i[o]);)i==t&&o==n&&(n-=1),o-=1;if(0==o&&i!=this.editor&&(o!=n||i!=t)&&!this.childlessTags.includes(i.tagName))for(;0==o&&i!=this.editor;)for(o=Array.from(i.parentNode.childNodes).indexOf(i),i=i.parentNode;i[o]&&this.isEmpty(i[o]);)i==t&&o==n&&(n-=1),o-=1;i.childNodes[o-1]&&(o=(i=i.childNodes[o-1]).nodeType==Node.ELEMENT_NODE?i.childNodes.length:i.textContent.length);const s=new Range;s.setStart(t,n),s.setEnd(i,o),document.getSelection().removeAllRanges(),document.getSelection().addRange(s)}}.bind(this))}bindSaveHistoryInterval(){setInterval(function(){this.saveHistory()}.bind(this),this.snapshotInterval)}bindExternalClickEvents(){document.addEventListener("mousedown",function(){const e=document.getSelection();if(0!=e.rangeCount){const t=e.getRangeAt(0);this.editor.contains(t.commonAncestorContainer)&&(this.rangeCache=t)}}.bind(this)),document.addEventListener("keydown",function(e){!e.metaKey&&!e.ctrlKey||"z"!=e.key&&"y"!=e.key||e.preventDefault()}.bind(this))}inEditor(e){return this.editor.contains(e)}returnFallbackRange(){const e=new Range;return e.setStart(this.editor,0),e.setEnd(this.editor,0),e}getRange(){if(this.imageModule&&this.imageModule.getSelected()&&this.inEditor(this.imageModule.getSelected())){const e=new Range;return e.selectNode(this.imageModule.getSelected()),e}const e=window.getSelection();if(0==e.rangeCount)return this.rangeCache?this.rangeCache:this.returnFallbackRange();const t=e.getRangeAt(0);return this.editor.contains(t.commonAncestorContainer)?t:this.rangeCache?this.rangeCache:this.returnFallbackRange()}getTextNodesInRange(e){if(null==e)return null;const t=new Range;t.setStart(e.startContainer,e.startOffset),t.setEnd(e.endContainer,e.endOffset);const n=[];for(var i=t.startContainer,o=t.startOffset,s=t.endOffset;i.nodeType==Node.ELEMENT_NODE&&!this.childlessTags.includes(i.tagName)&&0!=i.childNodes.length;)o==i.childNodes.length?o=(i=i.childNodes[o-1]).nodeType==Node.ELEMENT_NODE?this.childlessTags.includes(i.tagName)?1:i.childNodes.length:i.textContent.length:(i=i.childNodes[o],o=0);if(0==t.endOffset&&t.endContainer!=this.editor&&(t.endOffset!=t.startOffset||t.endContainer!=t.startContainer))for(;0==t.endOffset&&t.endContainer!=this.editor;){const e=Array.from(t.endContainer.parentNode.childNodes).indexOf(t.endContainer),n=t.endContainer.parentNode;t.setEnd(n,e)}for(var r=!1;this.inEditor(i)&&(!r||t.endContainer.contains(i)&&t.isPointInRange(i,0));)if((i.nodeType==Node.TEXT_NODE||this.childlessTags.includes(i.tagName))&&n.push(i),t.endContainer.contains(i)&&(r=!0),i.firstChild)i=i.firstChild;else if(i.nextSibling)i=i.nextSibling;else{for(;!i.nextSibling&&this.inEditor(i);)i=i.parentNode;i=i.nextSibling}if(t.endContainer.nodeType!=Node.TEXT_NODE&&this.inEditor(t.endContainer)&&n.slice(-1)[0]&&(s=1==t.comparePoint(n.slice(-1)[0],0)?0:this.childlessTags.includes(n.slice(-1)[0].tagName)?1:n.slice(-1)[0].textContent.length),t.endContainer.childNodes&&t.endContainer.childNodes[t.endOffset]&&this.childlessTags.includes(this.firstChildlessChild(t.endContainer.childNodes[t.endOffset]).tagName)){const e=this.firstChildlessChild(t.endContainer.childNodes[t.endOffset]);n.includes(e)||n[n.length-1]&&n[n.length-1].contains(e)||(n.push(e),s=1)}return{nodes:n,startOffset:o,endOffset:s}}styleToElement(e){switch(e.type){case"bold":return document.createElement("strong");case"italic":return document.createElement("em");case"underline":return document.createElement("u");case"strikethrough":return document.createElement("s");case"font":return(t=document.createElement("span")).style.fontFamily=e.family,t;case"size":return(t=document.createElement("span")).style.fontSize=String(e.size)+"px",t;case"foreColor":return(t=document.createElement("span")).style.color=e.color,t;case"backColor":return(t=document.createElement("span")).style.backgroundColor=e.color,t;case"sup":return document.createElement("sup");case"sub":return document.createElement("sub");case"link":return(t=document.createElement("a")).setAttribute("href",e.url),t;case"quote":return document.createElement("blockquote");case"header":return document.createElement(e.level);case"align":return(t=document.createElement("div")).style.textAlign=e.direction,t;case"list":var t=document.createElement("ordered"==e.listType?"ol":"ul");const n=document.createElement("li");return t.append(n),t}}getStylingOfElement(e,t=!1){if(e.nodeType!=Node.ELEMENT_NODE)return[];var n=[];switch(e.tagName){case"STRONG":case"B":n.push({type:"bold"});break;case"EM":case"I":case"VAR":n.push({type:"italic"});break;case"U":n.push({type:"underline"});break;case"S":n.push({type:"strikethrough"});break;case"FONT":var i;if(e.getAttribute("face")&&(i=(i=(i=(i=e.getAttribute("face")).split("&quot;")).map((e=>e.split('"').join("")))).map((e=>e.split("'").join(""))),n.push({type:"font",family:i})),e.getAttribute("size")&&+e.getAttribute("size")!=Number.NaN){var o=parseInt(e.getAttribute("size")),s=null;"+"==e.getAttribute("size").trim()[0]?s="plus":"-"==e.getAttribute("size").trim()[0]&&(s="minus"),"plus"!=s&&"minus"!=s||(o=3+o),o<1?o=1:o>7&&(o=7);var r=[10,13,16,18,24,32,48][o-1];n.push({type:"size",size:r})}e.getAttribute("color")&&n.push({type:"foreColor",color:e.getAttribute("color")});break;case"SUP":n.push({type:"sup"});break;case"SUB":n.push({type:"sub"});break;case"A":n.push({type:"link",url:e.getAttribute("href")||""});break;case"BLOCKQUOTE":n.push({type:"quote"});break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":n.push({type:"header",level:e.tagName}),t&&n.push({type:"override",target:{type:"size"}});break;case"UL":n.push({type:"list",listType:"unordered"});break;case"OL":n.push({type:"list",listType:"ordered"})}if("700"==e.style.fontWeight||"bold"==e.style.fontWeight.toLowerCase()?n.some((e=>"bold"==e.type))||n.push({type:"bold"}):"400"!=e.style.fontWeight&&"normal"!=e.style.fontWeight.toLowerCase()||(n.some((e=>"bold"==e.type))&&n.splice(n.findIndex((e=>"bold"==e.type)),1),t&&n.push({type:"override",target:{type:"bold"}})),"italic"==e.style.fontStyle.toLowerCase()?n.some((e=>"italic"==e.type))||n.push({type:"italic"}):"normal"==e.style.fontStyle.toLowerCase()&&(n.some((e=>"italic"==e.type))&&n.splice(n.findIndex((e=>"italic"==e.type)),1),t&&n.push({type:"override",target:{type:"italic"}})),e.style.textDecoration.toLowerCase().includes("underline")&&(n.some((e=>"underline"==e.type))||n.push({type:"underline"})),e.style.textDecoration.toLowerCase().includes("line-through")&&(n.some((e=>"strikethrough"==e.type))||n.push({type:"strikethrough"})),e.style.fontFamily&&(i=(i=(i=(i=e.style.fontFamily).split("&quot;").join("")).split('"').join("")).split("'").join(""),n.some((e=>"font"==e.type))||n.push({type:"font",family:i})),e.style.fontSize&&(o=String(e.style.fontSize).trim().toLowerCase()).endsWith("px")&&+o.slice(0,-2)!=Number.NaN&&(r=parseFloat(o.slice(0,-2)),n.some((e=>"size"==e.type))||n.push({type:"size",size:r})),e.style.color&&(n.some((e=>"foreColor"==e.type))||n.push({type:"foreColor",color:e.style.color})),e.style.backgroundColor&&(n.some((e=>"backColor"==e.type))||n.push({type:"backColor",color:e.style.backgroundColor})),e.style.textAlign){var a=e.style.textAlign.toLowerCase();n.some((e=>"align"==e.type))||n.push({type:"align",direction:a})}return"PRE"!=e.tagName&&"CODE"!=e.tagName||n.some((e=>"font"==e.type))||n.push({type:"font",family:"monospace"}),n}compareStyling(e,t){for(const n in e)if(e[n]!=t[n])return!1;return!0}elementHasStyle(e,t){const n=this.getStylingOfElement(e);return!(!n.some((e=>"foreColor"==e.type))||"foreColor"!=t.type||null!=t.color)||!(!n.some((e=>"backColor"==e.type))||"backColor"!=t.type||null!=t.color)||!(!n.some((e=>"size"==e.type))||"size"!=t.type||null!=t.size)||!(!n.some((e=>"link"==e.type))||"link"!=t.type)||!(!n.some((e=>"header"==e.type))||"header"!=t.type||null!=t.level)||!(!n.some((e=>"align"==e.type))||"align"!=t.type||null!=t.direction)||n.some((e=>this.compareStyling(e,t)))}detectStyling(e){var t=[];const n=this.getTextNodesInRange(e).nodes;var i=!0,o=0;for(const e of n)if(e.nodeType!=Node.TEXT_NODE||""!=e.textContent){o+=1;for(var s=e.parentNode,r=[];this.inEditor(s)&&s!=this.editor;)r.push(...this.getStylingOfElement(s)),s=s.parentNode;if(r.some((e=>"font"==e.type))||r.push({type:"font",family:this.defaultFont}),r.some((e=>"size"==e.type))||r.push({type:"size",size:this.defaultSize}),i)t.push(...r),i=!1;else{for(const e of t.slice(0,t.length))r.some((t=>this.compareStyling(t,e)))||this.requireSingleNodeToActivateStylingCommands.includes(e.type)||t.splice(t.findIndex((t=>t.type==e.type)),1);for(const e of r)this.requireSingleNodeToActivateStylingCommands.includes(e.type)&&(t.some((t=>this.compareStyling(t,e)))||t.push(e))}}return 0!=o||t.some((e=>"font"==e.type))||t.push({type:"font",family:this.defaultFont}),t}applyStyleToNode(e,t){for(var n=e;this.inEditor(n)&&n!=this.editor;){if(n.nodeType==Node.ELEMENT_NODE&&this.elementHasStyle(n,t))return n;n=n.parentNode}const i=this.styleToElement(t),o=document.createTextNode("");return e.after(o),i.appendChild(e),o.replaceWith(i),i}isAtEndOfParentNode(e,t){for(var n=e;t.contains(n)&&t!=n;){if(n.nextSibling)return!1;n=n.parentNode}return!0}applyStyle(e,t){var n,i,o;if(this.currentCursor){const e=document.createTextNode("");this.currentCursor.after(e),n=[e],i=0,o=0,this.currentCursor.remove(),this.currentCursor=null}else{const e=this.getTextNodesInRange(t);if(!e)return;({nodes:n,startOffset:i,endOffset:o}=e)}if(n.length>=2){this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0;const t=n[0],a=n.slice(-1)[0];if(this.contentTags.includes(t.tagName))s=this.applyStyleToNode(t,e);else{var s=document.createTextNode(t.textContent.slice(i,t.textContent.length));t.textContent=t.textContent.slice(0,i),t.after(s),s=this.applyStyleToNode(s,e),""==t.textContent&&t.remove()}if(this.contentTags.includes(a.tagName))r=this.applyStyleToNode(a,e);else{var r=document.createTextNode(a.textContent.slice(0,o));a.textContent=a.textContent.slice(o,a.textContent.length),a.before(r),r=this.applyStyleToNode(r,e),""==a.textContent&&a.remove()}for(const t of n.slice(1,n.length-1))this.applyStyleToNode(t,e);const l=new Range;l.setStartBefore(s),l.setEndAfter(r),window.getSelection().removeAllRanges(),window.getSelection().addRange(l)}else if(1==n.length){if(this.cannotCreateCursorCommands.includes(e.type)&&""==t.toString())return window.getSelection().removeAllRanges(),void window.getSelection().addRange(t);this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0;const s=n[0];if(this.contentTags.includes(s.tagName)){if("BR"!=s.tagName&&i==o){const t=document.createTextNode("");0==i?s.before(t):s.after(t),this.applyStyleToNode(t,e);const n=this.createCursor();t.after(n),t.remove();const o=new Range;return o.selectNodeContents(n),o.collapse(),window.getSelection().removeAllRanges(),void window.getSelection().addRange(o)}{const t=this.applyStyleToNode(s,e),n=new Range;return n.selectNode(t),this.blockTags.includes(s.tagName)&&n.collapse(),window.getSelection().removeAllRanges(),void window.getSelection().addRange(n)}}var a=document.createTextNode(s.textContent.slice(i,o)),l=document.createTextNode(s.textContent.slice(o,s.textContent.length));s.textContent=s.textContent.slice(0,i),s.after(a,l),a=this.applyStyleToNode(a,e),""==s.textContent&&s.remove(),""==l.textContent&&l.remove();for(var d=s.parentElement,c=null,u=[];this.inEditor(d)&&this.editor!=d;){if("A"==d.tagName){c=d;break}u.push(d.cloneNode(!1)),d=d.parentElement}if(c&&this.isAtEndOfParentNode(a,c)){d=a;for(const e of u)e.append(d),d=e;c.after(d)}if(""==a.textContent){const e=this.createCursor();a.appendChild(e);const t=new Range;return t.selectNodeContents(e),t.collapse(),window.getSelection().removeAllRanges(),void window.getSelection().addRange(t)}const r=new Range;r.selectNodeContents(a),window.getSelection().removeAllRanges(),window.getSelection().addRange(r)}else if(0==n.length){if(!this.inEditor(t.commonAncestorContainer))return;if(this.cannotCreateCursorCommands.includes(e.type))return;this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0;const n=document.createTextNode(""),i=t.commonAncestorContainer.childNodes;0==i.length?t.commonAncestorContainer.append(n):i[t.startOffset].after(n);const o=this.applyStyleToNode(n,e),s=this.createCursor();o.appendChild(s);const r=new Range;r.selectNodeContents(s),r.collapse(),window.getSelection().removeAllRanges(),window.getSelection().addRange(r)}}isEmpty(e){for(var t=e;e.contains(t)&&null!=t;){if(t.nodeType==Node.ELEMENT_NODE&&this.contentTags.includes(t.tagName))return!1;if(t.nodeType==Node.TEXT_NODE&&""!=t.textContent.replace(this.invisibleParsed,""))return!1;if(0!=t.childNodes.length)t=t.firstChild;else if(t.nextSibling)t=t.nextSibling;else{for(;!t.nextSibling&&e.contains(t)&&e!=t;)t=t.parentNode;t=t.nextSibling}}return!0}isEmptyOrLineBreak(e){var t=e,n=0;const i=this.contentTags.filter((e=>"BR"!=e));for(;e.contains(t)&&t!=this.editor;){if(t.nodeType==Node.ELEMENT_NODE&&i.includes(t.tagName))return!1;if(t.nodeType==Node.TEXT_NODE&&""!=t.textContent.replace(this.invisibleParsed,""))return!1;if("BR"==t.tagName){if(1==n)return!1;n=1}if(0!=t.childNodes.length)t=t.firstChild;else if(t.nextSibling)t=t.nextSibling;else{for(;!t.nextSibling&&e.contains(t)&&e!=t;)t=t.parentNode;t=t.nextSibling}}return!0}splitNodeAtChild(e,t,n=!1){for(var i=t,o=null;e.contains(i)&&e!=i;){const e=i.parentNode,t=Array.from(i.parentNode.childNodes);if(n&&null==o)var s=t.slice(t.indexOf(i)+0,t.length);else s=t.slice(t.indexOf(i)+1,t.length);if(null==o)(o=i.parentNode.cloneNode(!1)).append(...s);else{const e=o;(o=i.parentNode.cloneNode(!1)).append(e,...s)}i=e}return o}removeStyleFromElement(e,t){if(this.blockStylingCommands.includes(t.type)){switch(t.type){case"align":if(e.style.textAlign&&(e.style.textAlign.toLowerCase().includes(t.direction)||null==t.direction)){const t=document.createElement("div");t.append(...e.childNodes),t.setAttribute("style",e.getAttribute("style")?e.getAttribute("style"):""),t.style.textAlign="",e.remove(),e=t,i=!0}break;case"quote":if("BLOCKQUOTE"==e.tagName){const t=document.createElement("div");t.append(...e.childNodes),t.setAttribute("style",e.getAttribute("style")?e.getAttribute("style"):""),e.remove(),e=t,i=!0}break;case"header":if(e.tagName==t.level||null==t.level){const t=document.createElement("div");t.append(...e.childNodes),t.setAttribute("style",e.getAttribute("style")?e.getAttribute("style"):""),e.remove(),e=t,i=!0}break;case"list":if(e.tagName==("ordered"==t.listType?"OL":"UL")){const t=document.createElement("div");for(const n of Array.from(e.childNodes))if(Array.from(n.childNodes).every((e=>this.blockTags.includes(e.tagName)))||e.getAttribute("style"))t.append(...n.childNodes),n.remove();else{const i=document.createElement("div");i.append(...n.childNodes),i.setAttribute("style",e.getAttribute("style")?e.getAttribute("style"):""),n.remove(),t.append(i)}e.remove(),e=t,i=!0}}return e}if(e.getAttribute("style")){switch(t.type){case"bold":"bold"!=e.style.fontWeight.toLowerCase()&&"700"!=e.style.fontWeight||(e.style.fontWeight="");break;case"italic":"italic"==e.style.fontStyle.toLowerCase()&&(e.style.fontStyle="");break;case"underline":e.style.textDecoration.toLowerCase().includes("underline")&&(e.style.textDecoration=e.style.textDecoration.toLowerCase().replace("underline",""));break;case"strikethrough":e.style.textDecoration.toLowerCase().includes("line-through")&&(e.style.textDecoration=e.style.textDecoration.toLowerCase().replace("line-through",""));break;case"font":e.style.fontFamily&&(e.style.fontFamily="");break;case"size":e.style.fontSize&&(e.style.fontSize="");break;case"foreColor":e.style.color&&(e.style.color="");break;case"backColor":e.style.backgroundColor&&(e.style.backgroundColor="")}if(!e.getAttribute("style")&&!this.stylingTags.includes(e.tagName))return e.firstChild}const n=e.getAttribute("style");var i=!1;switch(t.type){case"bold":"B"!=e.tagName&&"STRONG"!=e.tagName||(e=e.firstChild,i=!0);break;case"italic":"I"!=e.tagName&&"EM"!=e.tagName||(e=e.firstChild,i=!0);break;case"underline":"U"==e.tagName&&(e=e.firstChild,i=!0);break;case"strikethrough":"S"==e.tagName&&(e=e.firstChild,i=!0);break;case"font":"FONT"==e.tagName&&e.hasAttribute("face")&&e.removeAttribute("face");break;case"size":"FONT"==e.tagName&&e.hasAttribute("size")&&e.removeAttribute("size");break;case"foreColor":"FONT"==e.tagName&&e.hasAttribute("color")&&e.removeAttribute("color");break;case"sup":"SUP"==e.tagName&&(e=e.firstChild,i=!0);break;case"sub":"SUB"==e.tagName&&(e=e.firstChild,i=!0);break;case"link":"A"==e.tagName&&(e=e.firstChild,i=!0)}if(n&&i){const t=document.createElement("span");t.setAttribute("style",n),t.append(e),e=t}return e}removeStyleOnNode(e,t){if(e.nodeType==Node.ELEMENT_NODE&&this.elementHasStyle(e,t)){const n=document.createTextNode("");e.after(n);const i=this.removeStyleFromElement(e,t);return n.after(i),n.remove(),i!=e&&e.remove(),i}const n=document.createTextNode("");e.after(n);var i=n,o=e;const s=e;e=n;for(var r=!1;this.inEditor(i)&&i!=this.editor&&i.parentNode!=this.editor;){var a=(i=i.parentNode).cloneNode(!1);if(a.appendChild(o),o=a,i.nodeType==Node.ELEMENT_NODE&&this.elementHasStyle(i,t)){r=!0;break}}if(!r)return n.after(s),n.remove(),s;o=this.removeStyleFromElement(o,t);const l=i,d=this.splitNodeAtChild(l,e);return this.isEmpty(d)||l.after(d),l.after(o),e.remove(),this.isEmpty(l)&&l.remove(),n.remove(),o}removeStyle(e,t){var n,i,o;if(this.currentCursor){const e=document.createTextNode("");this.currentCursor.after(e),n=[e],i=0,o=0,this.currentCursor.remove(),this.currentCursor=null}else{const e=this.getTextNodesInRange(t);if(!e)return;({nodes:n,startOffset:i,endOffset:o}=e)}if(n.length>=2){this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0;const t=n[0],a=n.slice(-1)[0];if(this.contentTags.includes(t.tagName))s=t;else{var s=document.createTextNode(t.textContent.slice(i,t.textContent.length));t.textContent=t.textContent.slice(0,i),t.after(s),""==t.textContent&&t.remove()}if(this.contentTags.includes(a.tagName))r=a;else{var r=document.createTextNode(a.textContent.slice(0,o));a.textContent=a.textContent.slice(o,a.textContent.length),a.before(r),""==a.textContent&&a.remove()}r=this.removeStyleOnNode(r,e);for(const t of n.slice(1,n.length-1).reverse())this.removeStyleOnNode(t,e);s=this.removeStyleOnNode(s,e);const l=new Range;l.setStartBefore(s),l.setEndAfter(r),window.getSelection().removeAllRanges(),window.getSelection().addRange(l)}else if(1==n.length){this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0;const t=n[0];if(this.contentTags.includes(t.tagName)){if("BR"!=t.tagName&&i==o){const n=document.createTextNode("");0==i?t.before(n):t.after(n),this.removeStyleOnNode(n,e);const o=this.createCursor();n.after(o),n.remove();const s=new Range;return s.selectNodeContents(o),s.collapse(),window.getSelection().removeAllRanges(),void window.getSelection().addRange(s)}{const n=this.removeStyleOnNode(t,e),i=new Range;return i.selectNode(n),this.blockTags.includes(t.tagName)&&i.collapse(),window.getSelection().removeAllRanges(),void window.getSelection().addRange(i)}}var a=document.createTextNode(t.textContent.slice(i,o)),l=document.createTextNode(t.textContent.slice(o,t.textContent.length));if(t.textContent=t.textContent.slice(0,i),t.after(a,l),a=this.removeStyleOnNode(a,e),""==t.textContent&&t.remove(),""==l.textContent&&l.remove(),""==a.textContent){const e=this.createCursor();for(var d=a;d.childNodes&&0!=d.childNodes.length;)d=d.childNodes[0];d.nodeType==Node.TEXT_NODE?d.after(e):d.append(e);const t=new Range;return t.selectNodeContents(e),t.collapse(),window.getSelection().removeAllRanges(),void window.getSelection().addRange(t)}const s=new Range;s.selectNodeContents(a),window.getSelection().removeAllRanges(),window.getSelection().addRange(s)}else if(0==n.length){if(!this.inEditor(t.commonAncestorContainer))return;this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0;const n=document.createTextNode(""),i=t.commonAncestorContainer.childNodes;0==i.length?t.commonAncestorContainer.append(n):i[t.startOffset].after(n);const o=this.removeStyleOnNode(n,e),s=this.createCursor();for(d=o;d.childNodes&&0!=d.childNodes.length;)d=d.childNodes[0];d.nodeType==Node.TEXT_NODE?d.after(s):d.append(s);const r=new Range;r.selectNodeContents(s),r.collapse(),window.getSelection().removeAllRanges(),window.getSelection().addRange(r)}}changeStyleOnNode(e,t){var n=e,i=e.cloneNode(!0);for(n=n.parentNode;this.inEditor(n)&&n!=this.editor&&n!=this.editor;){var o=n.cloneNode(!1);if(o.appendChild(i),i=o,n.nodeType==Node.ELEMENT_NODE&&this.getStylingOfElement(n).some((e=>e.type==t.type))&&n!=this.editor){const o=this.splitNodeAtChild(n,e);switch(this.isEmpty(o)||n.after(o),n.after(i),e.remove(),this.isEmpty(n)&&n.remove(),t.type){case"font":"FONT"==i.tagName?i.setAttribute("face",t.family):i.style.fontFamily=t.family;break;case"size":"FONT"==i.tagName?(i.hasAttribute("size")&&i.removeAttribute("size"),i.style.fontSize=String(t.size)+"px"):i.style.fontSize=String(t.size)+"px";break;case"foreColor":"FONT"==i.tagName?i.setAttribute("color",t.color):i.style.color=t.color;break;case"backColor":i.style.backgroundColor=t.color;break;case"link":i.setAttribute("href",t.url)}return i}n=n.parentNode}const s=this.styleToElement(t);return s.appendChild(e.cloneNode(!0)),e.replaceWith(s),s}changeStyling(e,t){var n,i,o;if(this.currentCursor){const e=document.createTextNode("");this.currentCursor.after(e),n=[e],i=0,o=0,this.currentCursor.remove(),this.currentCursor=null}else{const e=this.getTextNodesInRange(t);if(!e)return;({nodes:n,startOffset:i,endOffset:o}=e)}if(n.length>=2){this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0;const t=n[0],a=n.slice(-1)[0];if(this.contentTags.includes(t.tagName))s=t;else{var s=document.createTextNode(t.textContent.slice(i,t.textContent.length));t.textContent=t.textContent.slice(0,i),t.after(s),""==t.textContent&&t.remove()}if(this.contentTags.includes(a.tagName))r=a;else{var r=document.createTextNode(a.textContent.slice(0,o));a.textContent=a.textContent.slice(o,a.textContent.length),a.before(r),""==a.textContent&&a.remove()}r=this.changeStyleOnNode(r,e);for(const t of n.slice(1,n.length-1).reverse())this.changeStyleOnNode(t,e);s=this.changeStyleOnNode(s,e);const l=new Range;l.setStartBefore(s),l.setEndAfter(r),window.getSelection().removeAllRanges(),window.getSelection().addRange(l)}else if(1==n.length){if(this.cannotCreateCursorCommands.includes(e.type)&&""==t.toString())return window.getSelection().removeAllRanges(),void window.getSelection().addRange(t);this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0;const s=n[0];if(this.contentTags.includes(s.tagName)){if("BR"!=s.tagName&&i==o){const t=document.createTextNode("");0==i?s.before(t):s.after(t),this.changeStyleOnNode(t,e);const n=this.createCursor();t.after(n),t.remove();const o=new Range;return o.selectNodeContents(n),o.collapse(),window.getSelection().removeAllRanges(),void window.getSelection().addRange(o)}{const t=this.changeStyleOnNode(s,e),n=new Range;return n.selectNode(t),this.blockTags.includes(s.tagName)&&n.collapse(),window.getSelection().removeAllRanges(),void window.getSelection().addRange(n)}}var a=document.createTextNode(s.textContent.slice(i,o)),l=document.createTextNode(s.textContent.slice(o,s.textContent.length));if(s.textContent=s.textContent.slice(0,i),s.after(a,l),a=this.changeStyleOnNode(a,e),""==s.textContent&&s.remove(),""==l.textContent&&l.remove(),""==a.textContent){const e=this.createCursor();for(var d=a;d.childNodes&&0!=d.childNodes.length;)d=d.childNodes[0];d.nodeType==Node.TEXT_NODE?d.after(e):d.append(e);const t=new Range;return t.selectNodeContents(e),t.collapse(),window.getSelection().removeAllRanges(),void window.getSelection().addRange(t)}const r=new Range;r.selectNodeContents(a),window.getSelection().removeAllRanges(),window.getSelection().addRange(r)}else if(0==n.length){if(!this.inEditor(t.commonAncestorContainer))return;if(this.cannotCreateCursorCommands.includes(e.type))return;this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0;const n=document.createTextNode(""),i=t.commonAncestorContainer.childNodes;0==i.length?t.commonAncestorContainer.append(n):i[t.startOffset].after(n);const o=this.changeStyleOnNode(n,e),s=this.createCursor();for(d=o;d.childNodes&&0!=d.childNodes.length;)d=d.childNodes[0];d.nodeType==Node.TEXT_NODE?d.after(s):d.append(s);const r=new Range;r.selectNodeContents(s),r.collapse(),window.getSelection().removeAllRanges(),window.getSelection().addRange(r)}}removeAllStylesOnNode(e,t){if(e.nodeType==Node.ELEMENT_NODE&&(this.inlineStylingTags.includes(e.tagName)||"SPAN"==e.tagName)){const t=e.querySelectorAll((this.inlineStylingTags+["SPAN"]).filter((e=>"A"!=e)).join(", "));(this.inlineStylingTags.includes(e.tagName)||"SPAN"==e.tagName)&&t.push(e);for(const e of t)e.after(...e.childNodes),chileElem.remove();return e}for(var n=null,i=e,o=null;this.inEditor(i)&&i!=this.editor&&(i=i.parentNode).nodeType==Node.ELEMENT_NODE&&(this.inlineStylingTags.includes(i.tagName)||"SPAN"==i.tagName);)n=i,"A"==i.tagName&&(o=i.cloneNode(!1));if(!n)return e;const s=this.splitNodeAtChild(n,e);return this.isEmpty(s)||n.after(s),n.after(e),this.isEmpty(n)&&n.remove(),o&&(e.after(o),o.append(e),e=o),e}removeAllStyles(e,t){var n,i,o;if(this.currentCursor){const e=document.createTextNode("");this.currentCursor.after(e),n=[e],i=0,o=0,this.currentCursor.remove(),this.currentCursor=null}else{const e=this.getTextNodesInRange(t);if(!e)return;({nodes:n,startOffset:i,endOffset:o}=e)}if(n.length>=2){this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0;const t=n[0],a=n.slice(-1)[0];if(this.contentTags.includes(t.tagName))s=t;else{var s=document.createTextNode(t.textContent.slice(i,t.textContent.length));t.textContent=t.textContent.slice(0,i),t.after(s),""==t.textContent&&t.remove()}if(this.contentTags.includes(a.tagName))r=a;else{var r=document.createTextNode(a.textContent.slice(0,o));a.textContent=a.textContent.slice(o,a.textContent.length),a.before(r),""==a.textContent&&a.remove()}r=this.removeAllStylesOnNode(r,e);for(const t of n.slice(1,n.length-1).reverse())this.removeAllStylesOnNode(t,e);s=this.removeAllStylesOnNode(s,e);const l=new Range;l.setStartBefore(s),l.setEndAfter(r),window.getSelection().removeAllRanges(),window.getSelection().addRange(l)}else if(1==n.length){this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0;const t=n[0];if(this.contentTags.includes(t.tagName)){if("BR"!=t.tagName&&i==o){const n=document.createTextNode("");0==i?t.before(n):t.after(n),this.removeAllStylesOnNode(n,e);const o=this.createCursor();n.after(o),n.remove();const s=new Range;return s.selectNode(o),s.collapse(),window.getSelection().removeAllRanges(),void window.getSelection().addRange(s)}{const n=this.removeAllStylesOnNode(t,e),i=new Range;return i.selectNodeContents(n),this.blockTags.includes(t.tagName)&&i.collapse(),window.getSelection().removeAllRanges(),void window.getSelection().addRange(i)}}var a=document.createTextNode(t.textContent.slice(i,o)),l=document.createTextNode(t.textContent.slice(o,t.textContent.length));if(t.textContent=t.textContent.slice(0,i),t.after(a,l),a=this.removeAllStylesOnNode(a,e),""==t.textContent&&t.remove(),""==l.textContent&&l.remove(),""==a.textContent){const e=this.createCursor();for(var d=a;d.childNodes&&0!=d.childNodes.length;)d=d.childNodes[0];d.nodeType==Node.TEXT_NODE?d.after(e):d.append(e);const t=new Range;return t.selectNodeContents(e),t.collapse(),window.getSelection().removeAllRanges(),void window.getSelection().addRange(t)}const s=new Range;s.selectNodeContents(a),window.getSelection().removeAllRanges(),window.getSelection().addRange(s)}else if(0==n.length){if(!this.inEditor(t.commonAncestorContainer))return;this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0;const n=document.createTextNode(""),i=t.commonAncestorContainer.childNodes;0==i.length?t.commonAncestorContainer.append(n):i[t.startOffset].after(n);const o=this.removeAllStylesOnNode(n,e),s=this.createCursor();for(d=o;d.childNodes&&0!=d.childNodes.length;)d=d.childNodes[0];d.nodeType==Node.TEXT_NODE?d.after(s):d.append(s);const r=new Range;r.selectNodeContents(s),r.collapse(),window.getSelection().removeAllRanges(),window.getSelection().addRange(r)}}isValidBlockNode(e){return!!e&&e.nodeType==Node.ELEMENT_NODE&&!(!this.blockTags.includes(e.tagName)||"BR"==e.tagName)}isValidBlockStartPoint(e,t){return!!(e==this.editor&&0==t||this.isValidBlockNode(e.childNodes[t-1]))&&0!=(e.nodeType==Node.TEXT_NODE?e.textContent.length:e.childNodes.length)}isValidBlockEndPoint(e,t){for(var n=e.childNodes[t]?.previousSibling;n&&this.isEmpty(n);)n=n.previousSibling;return!!(e==this.editor&&t==this.editor.childNodes.length||this.isValidBlockNode(e.childNodes[t])||n&&this.isValidBlockNode(n)||this.isValidBlockNode(e)&&t==e.childNodes.length)&&0!=(e.nodeType==Node.TEXT_NODE?e.textContent.length:e.childNodes.length)}firstChildlessChild(e){for(;e.firstChild;)e=e.firstChild;return e}blockExtendRange(e,t=!0){for(var n=e.startContainer,i=e.startOffset,o=e.endContainer,s=e.endOffset;o[s]&&this.isEmpty(o[s]);)o==n&&s==i&&(i-=1),s-=1;if(!(0!=s||o==this.editor||s==i&&o==n||this.childlessTags.includes(o.tagName)||this.firstChildlessChild(o)&&"BR"==this.firstChildlessChild(o).tagName))for(;0==s&&o!=this.editor;)for(s=Array.from(o.parentNode.childNodes).indexOf(o),o=o.parentNode;o[s]&&this.isEmpty(o[s]);)o==n&&s==i&&(i-=1),s-=1;for(n.nodeType==Node.ELEMENT_NODE&&i==n.childNodes.length&&0!=i&&(i-=1);!this.isValidBlockStartPoint(n,i)&&(0==i?(i=Array.from(n.parentNode.childNodes).indexOf(n),n=n.parentNode):i-=1,!this.isValidBlockEndPoint(n,i)););if(t)for(;0==i&&n!=this.editor;)i=Array.from(n.parentNode.childNodes).indexOf(n),n=n.parentNode;else for(;0==i&&n!=this.editor&&["DIV","P"].includes(n.tagName);)i=Array.from(n.parentNode.childNodes).indexOf(n),n=n.parentNode;for(o.nodeType==Node.ELEMENT_NODE&&0==s&&0!=o.childNodes.length&&(s+=1);!this.isValidBlockEndPoint(o,s)&&(s==(o.nodeType==Node.TEXT_NODE?o.textContent.length:o.childNodes.length)?(s=Array.from(o.parentNode.childNodes).indexOf(o)+1,o=o.parentNode):s+=1,!this.isValidBlockStartPoint(o,s)););if(t)for(;s==(o.nodeType==Node.TEXT_NODE?o.textContent.length:o.childNodes.length)&&o!=this.editor;)s=Array.from(o.parentNode.childNodes).indexOf(o)+1,o=o.parentNode;else for(;s==(o.nodeType==Node.TEXT_NODE?o.textContent.length:o.childNodes.length)&&o!=this.editor&&["DIV","P"].includes(o.tagName);)s=Array.from(o.parentNode.childNodes).indexOf(o)+1,o=o.parentNode;const r=new Range;return r.setStart(n,i),r.setEnd(o,s),r}getBlockNodesInRange(e){const t=[];if(e.startContainer.nodeType!=Node.ELEMENT_NODE)var n=e.startContainer;else if(0==e.startContainer.length)n=e.startContainer;else{if(e.startContainer==this.editor&&e.startOffset==this.editor.childNodes.length)return;if(e.startOffset==e.startContainer.childNodes.length){for(var i=e.startContainer,o=e.startOffset;o==i.childNodes.length;)if(o=Array.from(i.parentNode.childNodes).indexOf(i),(i=i.parentNode)==this.editor&&e.startOffset==this.editor.childNodes.length)return;n=i.childNodes[o]}else n=e.startContainer.childNodes[e.startOffset]}if(n.nodeType!=Node.ELEMENT_NODE||e.isPointInRange(n,n.childNodes.length)||this.childlessTags.includes(n.tagName)){if(n.nodeType==Node.TEXT_NODE&&!e.intersectsNode(n)&&!this.childlessTags.includes(n.tagName))return t}else{if(0==n.childNodes.length||!e.intersectsNode(n))return t;for(;n.nodeType==Node.ELEMENT_NODE&&!e.isPointInRange(n,n.childNodes.length);)if(0==(n=n.firstChild).childNodes.length&&!e.intersectsNode(n))return t}for(t.push(n);this.inEditor(n);){if(n.nextSibling)n=n.nextSibling;else{for(;!n.nextSibling;)n=n.parentNode;if(n==this.editor||!this.inEditor(n))return t;n=n.nextSibling}if(n.nodeType!=Node.ELEMENT_NODE||e.isPointInRange(n,n.childNodes.length)){if(n.nodeType==Node.TEXT_NODE&&!e.intersectsNode(n))return t}else{if(0==n.childNodes.length||!e.intersectsNode(n))return t;for(;n.nodeType==Node.ELEMENT_NODE&&!e.isPointInRange(n,n.childNodes.length);)if(0==(n=n.firstChild).childNodes.length&&!e.intersectsNode(n))return t}t.push(n)}return t}adjustStartAndEndPoints(e,t,n,i){var o=!0;for(n.childNodes&&n.childNodes[i]&&this.childlessTags.includes(this.firstChildlessChild(n.childNodes[i]).tagName)&&(n=this.firstChildlessChild(n.childNodes[i]),i=0,o=!1);n[i]&&this.isEmpty(n[i])&&o;)n==e&&i==t&&(t-=1),i-=1;if(o&&0==i&&n!=this.editor&&(i!=t||n!=e)&&!this.childlessTags.includes(n.tagName)&&(!this.firstChildlessChild(n)||"BR"!=this.firstChildlessChild(n).tagName))for(;0==i&&n!=this.editor;)for(i=Array.from(n.parentNode.childNodes).indexOf(n),n=n.parentNode;n[i]&&this.isEmpty(n[i]);)n==e&&i==t&&(t-=1),i-=1;for(;e.nodeType==Node.ELEMENT_NODE&&!this.childlessTags.includes(e.tagName)&&!this.inlineStylingTags.includes(e.tagName)&&"SPAN"!=e.tagName&&0!=e.childNodes.length;)t==e.childNodes.length?t=(e=e.childNodes[t-1]).nodeType==Node.ELEMENT_NODE?e.childNodes.length:e.textContent.length:(e=e.childNodes[t],t=0);for(;o&&n.nodeType==Node.ELEMENT_NODE&&!this.childlessTags.includes(n.tagName)&&!this.inlineStylingTags.includes(n.tagName)&&"SPAN"!=n.tagName&&0!=n.childNodes.length;)if(0==i)if(this.childlessTags.includes(n.childNodes[0].tagName)&&"BR"!=n.childNodes[0].tagName){const e=document.createTextNode("");n.prepend(e),n=e,i=0}else n=n.childNodes[i],i=0;else n.childNodes[i-1].compareDocumentPosition(e)==Node.DOCUMENT_POSITION_FOLLOWING&&n.childNodes[i]?(n=n.childNodes[i],i=0):i=(n=n.childNodes[i-1]).nodeType==Node.ELEMENT_NODE?n.childNodes.length:n.textContent.length;return[e,t,n,i]}applyBlockStyleToNode(e,t,n=null,i=!1){for(var o=e;this.inEditor(o)&&o!=this.editor;){if(o.nodeType==Node.ELEMENT_NODE&&this.elementHasStyle(o,t))return o;o=o.parentNode}const s=n?this.findLastParent(e,n):null;if(s&&s!=e){const t=this.splitNodeAtChild(s,e,!0),n=this.splitNodeAtChild(t,e,!1);s.after(t,n),s!=this.editor&&this.isEmpty(s)&&s.remove(),n!=this.editor&&this.isEmpty(n)&&n.remove(),e=t}if(i)for(;e.nodeType==Node.ELEMENT_NODE&&1==e.childNodes.length&&this.blockTags.includes(e.childNodes[0].tagName)&&!this.childlessTags.includes(e.childNodes[0].tagName);)e=e.childNodes[0];const r=this.styleToElement(t);if("LI"==e.tagName)return 0==r.childNodes.length?r.append(...e.childNodes):r.childNodes[0].append(...e.childNodes),e.append(r),r;if(i)"OL"==e.tagName||"UL"==e.tagName?0!=e.childNodes.length&&(r.appendChild(...e.childNodes[0].childNodes),e.childNodes[0].append(r)):(0==r.childNodes.length?r.append(...e.childNodes):r.childNodes[0].append(...e.childNodes),e.append(r));else{const t=document.createTextNode("");e.after(t),0==r.childNodes.length?r.appendChild(e):r.childNodes[0].appendChild(e),t.replaceWith(r)}return r}removeExtraneousParents(e){const t=[];function n(e){if(e!=this.editor)if(["DIV","P"].includes(e.tagName)&&Array.from(e.childNodes).some((e=>this.blockTags.filter((e=>"BR"!=e)).includes(e.tagName)))&&!e.getAttribute("style")){const n=Array.from(e.childNodes),i=[];for(;n.length>0;){const e=n.shift();if(this.blockTags.filter((e=>"BR"!=e)).includes(e.tagName))i.push(e);else{const t=document.createElement("div");for(t.append(e);n[0]&&!this.blockTags.includes(n[0].tagName);){const e=n.shift();t.append(e)}i.push(t)}}t.push(...i),e.after(...i),e.remove()}else t.push(e);else t.push(e)}return n=n.bind(this),e.forEach(n),t}removeExtraneousParentsRecursively(e){const t=document.createTextNode("");function n(e){if(e.firstChild)if(["DIV","P"].includes(e.tagName)&&Array.from(e.childNodes).some((e=>this.blockTags.filter((e=>"BR"!=e)).includes(e.tagName)))&&!e.getAttribute("style")){const t=Array.from(e.childNodes),i=[];for(;t.length>0;){const e=t.shift();if(this.blockTags.filter((e=>"BR"!=e)).includes(e.tagName))i.push(e);else{const n=document.createElement("div");for(n.append(e);t[0]&&!this.blockTags.includes(t[0].tagName);){const e=t.shift();n.append(e)}i.push(n)}}e.after(...i),e.remove();for(const e of i)e.nodeType==Node.ELEMENT_NODE&&(e.querySelector("div:not([style]), p:not([style])")||e.matches("div:not([style]), p:not([style])"))&&n(e)}else for(const t of Array.from(e.childNodes))t.nodeType==Node.ELEMENT_NODE&&(t.querySelector("div:not([style]), p:not([style])")||t.matches("div:not([style]), p:not([style])"))&&n(t)}e.after(t),e.remove(),n=n.bind(this),Array.from(e.childNodes).forEach(n),t.replaceWith(e)}applyBlockStyle(e,t){this.shouldTakeSnapshotOnNextChange=!0,""==this.editor.innerHTML&&(this.editor.append(document.createElement("br")),t=this.getRange());var n=t.startContainer,i=t.startOffset,o=t.endContainer,s=t.endOffset,r=this.imageModule.getSelected();this.imageModule.deselect();const a=!this.inlineBlockStylingCommands.includes(e.type),l=this.blockExtendRange(t);[n,i,o,s]=this.adjustStartAndEndPoints(n,i,o,s);const d=this.getBlockNodesInRange(l);if(t.endContainer.childNodes&&t.endContainer.childNodes[t.endOffset]&&this.childlessTags.includes(this.firstChildlessChild(t.endContainer.childNodes[t.endOffset]).tagName)){const e=this.firstChildlessChild(t.endContainer.childNodes[t.endOffset]);d.includes(e)||d[d.length-1]&&d[d.length-1].contains(e)||d.push(e)}const c=this.removeExtraneousParents(d),u=[];if("header"==e.type)var m="blockquote, ul, ol, li, h1, h2, h3, h4, h5, h6, div, p";else m=this.inlineBlockStylingCommands.includes(e.type)?"blockquote, ul, ol, li, div, p":null;function h(e){if(e.nodeType==Node.ELEMENT_NODE&&(e==this.editor||m&&(e.matches(m)||e.querySelector(m))))for(const t of e.childNodes)h(t);else u.push(e)}h=h.bind(this);for(const e of c)h(e);if("header"==e.type)for(const e of u){if(e.nodeType!=Node.ELEMENT_NODE)continue;const t=Array.from(e.querySelectorAll("span, font"));e.matches("span, font")&&t.push(e);for(const e of t)e.style.fontSize&&(e.style.fontSize=""),e.getAttribute("size")&&e.removeAttribute("size")}if("quote"==e.type||"list"==e.type)var p=e=>this.inlineStylingTags.includes(e.tagName)||"SPAN"==e.tagName||["H1","H2","H3","H4","H5","H6"].includes(e.tagName)||e.style&&(e.style.textAlign||e.style.marginLeft);else p=this.inlineBlockStylingCommands.includes(e.type)?e=>this.inlineStylingTags.includes(e.tagName)||"SPAN"==e.tagName||["H1","H2","H3","H4","H5","H6"].includes(e.tagName):e=>this.inlineStylingTags.includes(e.tagName)||"SPAN"==e.tagName;var g=null,f=null,b=null,y=null;for(const n of u){const i=n.nextSibling;if(this.isEmpty(n)&&(!this.currentCursor||!n.contains(this.currentCursor))){y=i,n.remove();continue}if(!n.contains(t.commonAncestorContainer)||n==t.commonAncestorContainer||!this.blockTags.includes(n.tagName)||this.childlessTags.includes(n.tagName)||this.inlineBlockStylingCommands.includes(e.type)||n.getAttribute("style")||["H1","H2","H3","H4","H5","H6"].includes(n.tagName))N=!1;else var N=!0;const o=this.applyBlockStyleToNode(n,e,p,N);this.removeExtraneousParents([o.parentNode]),g||(g=o),f&&f.nextSibling==o&&y==n?!a&&this.blockTags.filter((e=>"BR"!=e)).includes(n.tagName)?f=o:"list"!=e.type||this.blockTags.includes(n.tagName)||this.blockTags.includes(b.tagName)||"BR"==this.firstChildlessChild(n).tagName?this.inlineBlockStylingCommands.includes(e.type)&&this.blockTags.filter((e=>"BR"!=e)).includes(n.tagName)?f=o:(f.append(...o.childNodes),o.remove()):(f.lastChild.append(...o.firstChild.childNodes),o.remove()):f=o,N&&["DIV","P"].includes(n.tagName)&&!n.getAttribute("style")?(n.after(...n.childNodes),n.remove(),b=n.childNodes[0]):b=n,y=i}if(this.removeExtraneousParentsRecursively(this.editor),"list"==e.type){if(g){const e=this.leftSiblingIgnoreEmpty(g);e&&e.tagName==g.tagName&&(e.append(...g.childNodes),g.remove(),f==g&&(f=e),g=e)}if(f){const e=this.rightSiblingIgnoreEmpty(f);e&&e.tagName==f.tagName&&(e.prepend(...f.childNodes),f.remove(),f=e)}}if(r)return void this.imageModule.select(r);const v=new Range;v.setStart(n,i),v.setEnd(o,s),document.getSelection().removeAllRanges(),document.getSelection().addRange(v)}removeBlockStyleOnNode(e,t,n=!0){const i=document.createNodeIterator(e,NodeFilter.SHOW_ELEMENT,(e=>this.elementHasStyle(e,t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT));var o;const s=[];for(;o=i.nextNode();)o!=this.editor&&s.push(o);var r=null;const a=[];for(const n of s){const i=document.createTextNode("");n.after(i);const o=this.removeStyleFromElement(n,t);this.inEditor(e)||r||(r=o),Array.from(o.childNodes).every((e=>this.blockTags.filter((e=>"BR"!=e)).includes(e.tagName)))&&a.push(o),i.after(o),i.remove(),Array.from(o.parentNode.childNodes).every((e=>this.blockTags.filter((e=>"BR"!=e)).includes(e.tagName)))&&!o.parentNode.getAttribute("style")&&o.parentNode!=this.editor&&"DIV"==o.parentNode.tagName&&a.push(o.parentNode)}for(var l=[],d=e=r||e;this.inEditor(d)&&d!=this.editor;)this.elementHasStyle(d,t)&&l.push(d),d=d.parentNode;for(const i of l){if(0==n&&r)break;const o=this.splitNodeAtChild(i,e,!0),s=this.splitNodeAtChild(o,e),l=document.createTextNode("");i.after(l);var c=this.removeStyleFromElement(o,t);this.inEditor(e)||r||(r=c),Array.from(c.childNodes).every((e=>this.blockTags.filter((e=>"BR"!=e)).includes(e.tagName)))&&a.push(c),l.after(c,s),l.remove(),Array.from(c.parentNode.childNodes).every((e=>this.blockTags.filter((e=>"BR"!=e)).includes(e.tagName)))&&!c.parentNode.getAttribute("style")&&c.parentNode!=this.editor&&"DIV"==c.parentNode.tagName&&a.push(c.parentNode),i!=this.editor&&this.isEmpty(i)&&i.remove(),i.lastChild&&this.isEmpty(i.lastChild)&&i.lastChild.remove(),s!=this.editor&&this.isEmpty(s)&&s.remove(),s.firstChild&&this.isEmpty(s.firstChild)&&s.firstChild.remove(),e=c}for(const e of a)r==e&&(r=1!=e.childNodes.length?Array.from(e.childNodes):e.firstChild),e.after(...e.childNodes),e.remove();return r}removeBlockStyle(e,t,n=!0){if(this.shouldTakeSnapshotOnNextChange=!0,""==this.editor.innerHTML)return;var i=t.startContainer,o=t.startOffset,s=t.endContainer,r=t.endOffset,a=this.imageModule.getSelected();this.imageModule.deselect();const l=this.blockExtendRange(t);[i,o,s,r]=this.adjustStartAndEndPoints(i,o,s,r);const d=this.getBlockNodesInRange(l);if(t.endContainer.childNodes&&t.endContainer.childNodes[t.endOffset]&&this.childlessTags.includes(this.firstChildlessChild(t.endContainer.childNodes[t.endOffset]).tagName)){const e=this.firstChildlessChild(t.endContainer.childNodes[t.endOffset]);d.includes(e)||d[d.length-1]&&d[d.length-1].contains(e)||d.push(e)}const c=this.removeExtraneousParents(d);var u=null,m=null;for(const t of c){const i=u&&m&&u==t&&!this.blockTags.filter((e=>"BR"!=e)).includes(t.tagName);u=t.nextSibling;const o=this.removeBlockStyleOnNode(t,e,n);!i||!o||o instanceof Array?m=o instanceof Array?null:o:(m.append(...o.childNodes),o.remove())}if(a)return void this.imageModule.select(a);const h=new Range;h.setStart(i,o),h.setEnd(s,r),document.getSelection().removeAllRanges(),document.getSelection().addRange(h)}replaceListsOnNode(e,t,n){const i=document.createNodeIterator(e,NodeFilter.SHOW_ELEMENT,(e=>e.tagName==t?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT));var o;const s=[];for(;o=i.nextNode();)o!=this.editor&&s.push(o);var r=!1,a=null;for(const t of s){const i=document.createTextNode("");t.after(i);const o=document.createElement(n);o.append(...t.childNodes),t.remove(),this.inEditor(e)||a||(a=o,r=!0),i.after(o),i.remove()}if(!r){const t=this.findClosestParent(e,(e=>"OL"==e.tagName||"UL"==e.tagName));if(t){e=t;const i=document.createTextNode("");e.after(i);const o=document.createElement(n);o.append(...e.childNodes),e.remove(),i.after(o),i.remove()}}}replaceListStyle(e,t,n){if(this.shouldTakeSnapshotOnNextChange=!0,""==this.editor.innerHTML)return;var i=n.startContainer,o=n.startOffset,s=n.endContainer,r=n.endOffset,a=this.imageModule.getSelected();this.imageModule.deselect();const l=this.blockExtendRange(n);[i,o,s,r]=this.adjustStartAndEndPoints(i,o,s,r);const d=this.getBlockNodesInRange(l);if(n.endContainer.childNodes&&n.endContainer.childNodes[n.endOffset]&&this.childlessTags.includes(this.firstChildlessChild(n.endContainer.childNodes[n.endOffset]).tagName)){const e=this.firstChildlessChild(n.endContainer.childNodes[n.endOffset]);d.includes(e)||d[d.length-1]&&d[d.length-1].contains(e)||d.push(e)}e="ordered"==e?"OL":"UL",t="ordered"==t?"OL":"UL";for(const n of d)this.replaceListsOnNode(n,e,t);if(a)return void this.imageModule.select(a);const c=new Range;c.setStart(i,o),c.setEnd(s,r),document.getSelection().removeAllRanges(),document.getSelection().addRange(c)}joinAdjacentNestedListsLeft(e){if(!e)return e;const t=this.leftSiblingIgnoreEmpty(e);if(t&&["OL","UL"].includes(e.tagName)&&t.tagName==e.tagName)return t.append(...e.childNodes),e.remove(),t;if(!t&&["OL","UL"].includes(e.tagName)&&"LI"==e.parentNode.tagName&&this.leftSiblingIgnoreEmpty(e.parentNode)&&0!=this.leftSiblingIgnoreEmpty(e.parentNode).childNodes.length&&this.leftSiblingIgnoreEmpty(e.parentNode).childNodes[this.leftSiblingIgnoreEmpty(e.parentNode).childNodes.length-1].tagName==e.tagName){const t=this.leftSiblingIgnoreEmpty(e.parentNode),n=t.childNodes[t.childNodes.length-1];t.childNodes[t.childNodes.length-1].append(...e.childNodes);const i=e.parentNode;return e.remove(),0==i.childNodes.length&&i.remove(),n}return e}joinAdjacentNestedListsRight(e){if(!e)return e;const t=this.rightSiblingIgnoreEmpty(e);if(t&&["OL","UL"].includes(e.tagName)&&t.tagName==e.tagName)return t.prepend(...e.childNodes),e.remove(),t;if(!t&&["OL","UL"].includes(e.tagName)&&"LI"==e.parentNode.tagName&&this.rightSiblingIgnoreEmpty(e.parentNode)&&0!=this.rightSiblingIgnoreEmpty(e.parentNode).childNodes.length&&this.rightSiblingIgnoreEmpty(e.parentNode).childNodes[0].tagName==e.tagName){this.rightSiblingIgnoreEmpty(e.parentNode).childNodes[0].prepend(...e.childNodes);const t=e.parentNode;e.remove(),0==t.childNodes.length&&t.remove()}}updateHideNestedLists(e){const t=e.querySelectorAll("li");for(const e of t)e.firstChild&&["OL","UL"].includes(e.firstChild.tagName)?e.style.listStyleType="none":"none"==e.style.listStyleType.toLowerCase()&&(e.style.listStyleType="");for(var n=e;this.inEditor(n)&&n!=this.editor;)"LI"==n.tagName&&n.firstChild&&["OL","UL"].includes(n.firstChild.tagName)?n.style.listStyleType="none":"LI"==n.tagName&&"none"==n.style.listStyleType.toLowerCase()&&(n.style.listStyleType=""),n=n.parentNode}blockIndentSiblingNodes(e){const t=this.findClosestParent(e[0],(e=>e.nodeType==Node.ELEMENT_NODE&&(["OL","UL"].includes(e.tagName)||e.style&&"40px"==e.style.marginLeft.toLowerCase())));var n=null,i=null;if("LI"==e[0].tagName){const o=document.createElement("li");e[0].before(o);const s=t.cloneNode(!1);if(s.append(...e),o.append(s),i||(i=s),n=s,"LI"==s.parentNode.tagName&&s.parentNode.previousSibling){const e=s.parentNode;e.previousSibling.append(...e.childNodes),e.remove()}}else{const o=t?t.cloneNode(!1):document.createElement("div");if("DIV"==o.tagName){o.style.marginLeft="40px";const t=document.createTextNode("");e[0].before(t);const n=[];for(;0!=e.length;){const t=e[0];if(this.blockTags.includes(t.tagName)){const i=o.cloneNode(!1);i.append(t),n.push(i),e.shift()}else{const i=o.cloneNode(!1);for(i.append(t),e.shift();0!=e.length&&!this.blockTags.includes(e[0].tagName);)i.append(e.shift());n.push(i)}}t.before(...n),t.remove()}else if(["OL","UL"].includes(o.tagName)){e[0].before(o);const t=[];for(;0!=e.length;){const n=e[0];if(this.blockTags.includes(n.tagName)){const i=document.createElement("li");i.append(n),t.push(i),e.shift()}else{const i=document.createElement("li");for(i.append(n),e.shift();0!=e.length&&!this.blockTags.includes(e[0].tagName);)i.append(e.shift());t.push(i)}}if(o.append(...t),i||(i=o),n=o,"LI"==o.parentNode.tagName&&o.parentNode.previousSibling){const e=o.parentNode;e.previousSibling.append(...e.childNodes),e.remove()}}}const o=i==n,s=this.joinAdjacentNestedListsLeft(i);return o&&(n=s),n&&this.updateHideNestedLists(n),n}blockIndent(e){this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0,""==this.editor.innerHTML&&(this.editor.append(document.createElement("br")),e=this.getRange());var t=e.startContainer,n=e.startOffset,i=e.endContainer,o=e.endOffset,s=this.imageModule.getSelected();this.imageModule.deselect();const r=this.blockExtendRange(e);[t,n,i,o]=this.adjustStartAndEndPoints(t,n,i,o);var a=this.getBlockNodesInRange(r);if(e.endContainer.childNodes&&e.endContainer.childNodes[e.endOffset]&&this.childlessTags.includes(this.firstChildlessChild(e.endContainer.childNodes[e.endOffset]).tagName)){const t=this.firstChildlessChild(e.endContainer.childNodes[e.endOffset]);a.includes(t)||a[a.length-1]&&a[a.length-1].contains(t)||a.push(t)}const l=this.removeExtraneousParents(a),d=[];function c(e){if(e.nodeType==Node.ELEMENT_NODE&&(e==this.editor||!["OL","UL"].includes(e.tagName)&&e.querySelector("blockquote, ul, ol, li, div, p")))for(const t of e.childNodes)c(t);else d.push(e)}c=c.bind(this);for(const e of l)c(e);a=d.reverse();for(var u=null;0!=a.length;){const e=[a.pop()];for(;0!=a.length&&e[e.length-1].nextSibling==a[a.length-1];)e.push(a.pop());u=this.blockIndentSiblingNodes(e)}if(this.joinAdjacentNestedListsRight(u),s)return void this.imageModule.select(s);const m=new Range;m.setStart(t,n),m.setEnd(i,o),document.getSelection().removeAllRanges(),document.getSelection().addRange(m)}blockOutdentSiblingNodes(e){for(const t of e){const e=this.findClosestParent(t,(e=>["OL","UL"].includes(e.tagName)||e.style&&"40px"==e.style.marginLeft.toLowerCase()));if(e)if(["OL","UL"].includes(e.tagName)){if(e==t){const t=Array.from(e.childNodes),n=[];for(const e of t){const t=Array.from(e.childNodes);if(t.every((e=>this.blockTags.includes(e.tagName))))n.push(...t);else{const e=document.createElement("div");e.append(...t),n.push(e)}}e.after(...n);const i=e.parentNode;if(e.remove(),this.updateHideNestedLists(i),"LI"==n[0].parentNode.tagName){const e=n[0].parentNode,t=Array.from(e.childNodes).slice(Array.from(e.childNodes).indexOf(n[n.length-1])+1,e.childNodes.length),i=document.createElement("li");i.append(...t),e.after(i),this.isEmpty(i)&&i.remove();const o=[];for(;0!=n.length;){const t=n[0];if(this.blockTags.includes(t.tagName)){const e=document.createElement("li");e.append(t),o.push(e),n.shift()}else{const e=document.createElement("li");for(e.append(t),n.shift();0!=n.length&&!this.blockTags.includes(n[0].tagName);)e.append(n.shift());o.push(e)}e.after(...o)}o.forEach((e=>this.updateHideNestedLists(e))),this.updateHideNestedLists(e),this.isEmpty(e)&&e.remove()}continue}const n=this.splitNodeAtChild(e,t,!0),i=this.splitNodeAtChild(n,t,!1),o=Array.from(n.childNodes),s=[];for(const e of o){const t=Array.from(e.childNodes);if(t.every((e=>this.blockTags.includes(e.tagName))))s.push(...t);else{const e=document.createElement("div");e.append(...t),s.push(e)}}if(e.after(...s,i),n.remove(),this.isEmpty(e)&&e.remove(),this.isEmpty(i)&&i.remove(),0==s.length)continue;if("LI"==s[0].parentNode.tagName){const e=s[0].parentNode,t=Array.from(e.childNodes).slice(Array.from(e.childNodes).indexOf(s[s.length-1])+1,e.childNodes.length),n=document.createElement("li");n.append(...t),e.after(n),this.isEmpty(n)&&n.remove();const i=[];for(;0!=s.length;){const t=s[0];if(this.blockTags.includes(t.tagName)){const e=document.createElement("li");e.append(t),i.push(e),s.shift()}else{const e=document.createElement("li");for(e.append(t),s.shift();0!=s.length&&!this.blockTags.includes(s[0].tagName);)e.append(s.shift());i.push(e)}e.after(...i)}this.updateHideNestedLists(n),i.forEach((e=>this.updateHideNestedLists(e))),this.updateHideNestedLists(e),this.isEmpty(e)&&e.remove()}this.updateHideNestedLists(e)}else if(e.nodeType==Node.ELEMENT_NODE&&"40px"==e.style.marginLeft.toLowerCase()){if(e==t){e.style.marginLeft="";const t=Array.from(e.childNodes);t.every((e=>this.blockTags.includes(e.tagName)))&&["DIV","P"].includes(e.tagName)&&!e.getAttribute("style")&&(e.after(...t),e.remove());continue}const n=this.splitNodeAtChild(e,t,!0),i=this.splitNodeAtChild(n,t,!1);n.style.marginLeft="";const o=Array.from(n.childNodes);o.every((e=>this.blockTags.includes(e.tagName)))&&["DIV","P"].includes(e.tagName)&&!e.getAttribute("style")?e.after(...o,i):e.after(n,i),this.isEmpty(e)&&e.remove(),this.isEmpty(i)&&i.remove()}}}blockOutdent(e){if(""==this.editor.innerHTML)return;this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0;var t=e.startContainer,n=e.startOffset,i=e.endContainer,o=e.endOffset,s=this.imageModule.getSelected();this.imageModule.deselect();const r=this.blockExtendRange(e);[t,n,i,o]=this.adjustStartAndEndPoints(t,n,i,o);var a=this.getBlockNodesInRange(r);if(e.endContainer.childNodes&&e.endContainer.childNodes[e.endOffset]&&this.childlessTags.includes(this.firstChildlessChild(e.endContainer.childNodes[e.endOffset]).tagName)){const t=this.firstChildlessChild(e.endContainer.childNodes[e.endOffset]);a.includes(t)||a[a.length-1]&&a[a.length-1].contains(t)||a.push(t)}const l=this.removeExtraneousParents(a),d=[];function c(e){if(e.nodeType==Node.ELEMENT_NODE&&(e==this.editor||e.querySelector("ol, ul")||e.querySelector('[style*="margin-left: 40px"]')))for(const t of e.childNodes)c(t);else d.push(e)}c=c.bind(this);for(const e of l)c(e);for(a=d.reverse();0!=a.length;){const e=[a.pop()];for(;0!=a.length&&e[e.length-1].nextSibling==a[a.length-1];)e.push(a.pop());this.blockOutdentSiblingNodes(e)}if(s)return void this.imageModule.select(s);const u=new Range;u.setStart(t,n),u.setEnd(i,o),document.getSelection().removeAllRanges(),document.getSelection().addRange(u)}onNodeDrawn(e,t){ResizeObserver&&new ResizeObserver(function(e,n){0!=e[0].contentRect.height&&(t(),n.disconnect())}.bind(this)).observe(e)}inlineInsertImage(e,t){this.saveHistory(),t.deleteContents(),this.imageModule.getSelected()&&this.imageModule.deselect(),this.removeCursor(!1);const n=document.createElement("img");if(n.setAttribute("src",e.url),e.alt&&n.setAttribute("alt",e.alt),n.style.width=this.defaultImageWidth,this.childlessTags.includes(t.commonAncestorContainer))return t.commonAncestorContainer.after(n),t.commonAncestorContainer.remove(),document.getSelection().removeAllRanges(),void this.onNodeDrawn(n,function(){this.imageModule.select(n)}.bind(this));if(this.isEmptyOrLineBreak(t.commonAncestorContainer)){const e=t.commonAncestorContainer.querySelector("br");if(e)return e.replaceWith(n),void this.onNodeDrawn(n,function(){this.imageModule.select(n)}.bind(this))}t.insertNode(n),document.getSelection().removeAllRanges(),this.onNodeDrawn(n,function(){this.imageModule.select(n)}.bind(this))}blockInsertHR(e,t){var n;if(this.saveHistory(),t.deleteContents(),this.imageModule.getSelected()&&this.imageModule.deselect(),this.removeCursor(!1),t.startContainer.nodeType==Node.TEXT_NODE){n=t.startContainer;const e=document.createTextNode(n.textContent.slice(t.startOffset,n.textContent.length));n.textContent=n.textContent.slice(0,t.startOffset),n.after(e)}else this.childlessTags.includes(t.startContainer)?n=t.startContainer:0==t.startOffset?(n=document.createTextNode(""),t.startContainer.prepend(n)):n=t.startContainer.childNodes[t.startOffset-1];const i=document.createElement("hr"),o=this.findLastParent(n,(e=>["H1","H2","H3","H4","H5","H6"].includes(e.tagName)||e.style&&e.style.textAlign||this.inlineStylingTags.includes(e.tagName)||"SPAN"==e.tagName));if(o){const e=this.splitNodeAtChild(o,n);o.after(i,e)}else n.after(i);const s=new Range;s.selectNode(i),s.collapse(!1),document.getSelection().removeAllRanges(),document.getSelection().addRange(s)}performStyleCommand(e){const t=this.getRange();if(null==t)return;const n=this.detectStyling(t);if(this.editor.dispatchEvent(new Event("mimiredited")),"remove"==e.type)this.removeAllStyles(e,t);else if(this.multipleValueStylingCommands.includes(e.type)&&this.inlineStylingCommands.includes(e.type))("foreColor"==e.type||"backColor"==e.type)&&null==e.color||"link"==e.type&&null==e.url?this.removeStyle(e,t):this.changeStyling(e,t);else if(this.inlineStylingCommands.includes(e.type))if(n.some((t=>t.type==e.type)))this.removeStyle(e,t);else if("sup"==e.type||"sub"==e.type){const n="sub"==e.type?"sup":"sub";this.removeStyle({type:n},t),this.applyStyle(e,this.getRange())}else this.applyStyle(e,t);else if(this.blockStylingCommands.includes(e.type))switch(e.type){case"quote":this.saveHistory(),n.some((t=>t.type==e.type))?this.removeBlockStyle(e,t):this.applyBlockStyle(e,t);break;case"header":this.saveHistory(),this.removeBlockStyle({type:"header",level:null},t);var i=this.getRange();"Paragraph"!=e.level&&this.applyBlockStyle(e,i);break;case"align":this.saveHistory(),this.removeBlockStyle({type:"align",direction:null},t),i=this.getRange(),this.applyBlockStyle(e,i);break;case"list":if(this.saveHistory(),"ordered"==e.listType){const i=n.find((e=>"list"==e.type&&"ordered"==e.listType)),o=n.find((e=>"list"==e.type&&"unordered"==e.listType));i?this.removeBlockStyle(i,t):o?this.replaceListStyle("unordered","ordered",t):this.applyBlockStyle(e,t)}else if("unordered"==e.listType){const i=n.find((e=>"list"==e.type&&"unordered"==e.listType)),o=n.find((e=>"list"==e.type&&"ordered"==e.listType));i?this.removeBlockStyle(i,t):o?this.replaceListStyle("ordered","unordered",t):this.applyBlockStyle(e,t)}break;case"indent":this.blockIndent(t);break;case"outdent":this.blockOutdent(t)}else if(this.insertCommands.includes(e.type))switch(e.type){case"insertImage":this.inlineInsertImage(e,t);break;case"insertHorizontalRule":this.blockInsertHR(e,t)}this.onChangeSelect()}bold(){this.performStyleCommand({type:"bold"})}italic(){this.performStyleCommand({type:"italic"})}underline(){this.performStyleCommand({type:"underline"})}strikethrough(){this.performStyleCommand({type:"strikethrough"})}font(){this.performStyleCommand({type:"font",family:this.menubarOptions.font.getValue()})}foreColor(e){this.performStyleCommand({type:"foreColor",color:e}),null!=e&&(this.useIcons?this.menubarOptions.foreColor.colorInput.getElementsByClassName("mimir-menubar-option-fore-color-button")[0].childNodes[0].style.borderBottom="2px solid "+e:this.menubarOptions.foreColor.colorInput.getElementsByClassName("mimir-menubar-option-fore-color-button")[0].style.textDecorationColor=e)}backColor(e){this.performStyleCommand({type:"backColor",color:e}),null!=e&&(this.useIcons?this.menubarOptions.backColor.colorInput.getElementsByClassName("mimir-menubar-option-back-color-button")[0].childNodes[0].style.borderBottom="2px solid "+e:this.menubarOptions.backColor.colorInput.getElementsByClassName("mimir-menubar-option-back-color-button")[0].style.textDecorationColor=e)}sup(){this.performStyleCommand({type:"sup"})}sub(){this.performStyleCommand({type:"sub"})}size(){this.performStyleCommand({type:"size",size:this.menubarOptions.size.value})}link(e){e&&"javascript:"==e.trim().substring(0,11).toLowerCase()&&(e="about:blank#blocked"),this.performStyleCommand({type:"link",url:e})}quote(){this.performStyleCommand({type:"quote"})}header(){this.performStyleCommand({type:"header",level:this.menubarOptions.header.getValue()})}align(){this.performStyleCommand({type:"align",direction:this.menubarOptions.align.getValue()})}listOrdered(){this.performStyleCommand({type:"list",listType:"ordered"})}listUnordered(){this.performStyleCommand({type:"list",listType:"unordered"})}indent(){this.performStyleCommand({type:"indent"})}outdent(){this.performStyleCommand({type:"outdent"})}insertImage(e,t){this.performStyleCommand({type:"insertImage",url:e,alt:t})}insertHR(){this.performStyleCommand({type:"insertHorizontalRule"})}remove(){this.performStyleCommand({type:"remove"})}openFindAndReplace(){this.findAndReplaceModule.open()}zoom(e){this.currentZoom=e,this.editor.style.MozTransform=`scale(${e})`,this.editor.style.WebkitTransform=`scale(${e})`,this.editor.style.transformOrigin="top left",this.imageModule.deselect()}changeZoom(e){this.zoom(parseInt(e)/100)}applyZoom(e){if(!this.zoomOptions.includes(e))throw new Error("Invalid zoom level.");this.changeZoom(e),this.menubarOptions.zoom.setValue(e)}async serializeContents(e){function t(e){return new Promise(((t,n)=>{const i=new FileReader;i.onload=e=>t(i.result),i.onerror=e=>n(i.error),i.onabort=e=>n(new Error("Failed to read blob")),i.readAsDataURL(e)}))}const n=[];for(const o of e.childNodes)if(!this.isEmpty(o))if(o.nodeType==Node.TEXT_NODE)n.push(o.textContent);else if(o.nodeType==Node.ELEMENT_NODE){const e={};for(var i=0;i<o.attributes.length;i++)if("src"==o.attributes[i].name.toLowerCase()&&"IMG"==o.tagName&&o.attributes[i].value.toLowerCase().startsWith("blob")){const n=await(await fetch(o.attributes[i].value)).blob(),s=await t(n);e.src=s}else e[o.attributes[i].name]=o.attributes[i].value;n.push({tag:o.tagName,children:this.serializeContents(o),attrs:e})}return n}deserializeContents(e,t){for(const a of e)if("string"==typeof a||a instanceof String)t.append(document.createTextNode(a));else{const e=document.createElement(a.tag);for(const t in a.attrs)if("img"==a.tag.toLowerCase()&&"src"==t.toLowerCase()&&a.attrs[t].toLowerCase().startsWith("data")){for(var n=a.attrs[t].split(",")[0].split(":")[1].split(";")[0],i=atob(a.attrs[t].split(",")[1]),o=[],s=0;s<i.length;s++)o.push(i.charCodeAt(s));const l=new Blob([new Uint8Array(o)],{type:n});var r=URL.createObjectURL(l);e.setAttribute("src",r),this.imageObjectURLs.push(r)}else e.setAttribute(t,a.attrs[t]);this.deserializeContents(a.children,e),t.append(e)}}serializeRange(e){function t(e){var t=e;const n=[];for(;this.inEditor(t)&&t!=this.editor;)n.push(Array.from(t.parentNode.childNodes).indexOf(t)),t=t.parentNode;return n}const n=(t=t.bind(this))(e.startContainer),i=t(e.endContainer);return{startContainer:n,startOffset:e.startOffset,endContainer:i,endOffset:e.endOffset}}deserializeRange(e){const t=new Range;function n(e){for(var t=this.editor;0!=e.length;)t=t.childNodes[e[e.length-1]],e.pop();return t}const i=(n=n.bind(this))(e.startContainer),o=n(e.endContainer);return t.setStart(i,e.startOffset),t.setEnd(o,e.endOffset),t}snapshot(){this.findAndReplaceModule&&this.findAndReplaceModule.isOpen()&&this.findAndReplaceModule.unhighlight();const e=this.editor.cloneNode(!0);var t=null;const n=this.getRange();return n&&n&&this.inEditor(n.commonAncestorContainer)&&(t=this.serializeRange(n,this.editor)),this.findAndReplaceModule&&this.findAndReplaceModule.isOpen()&&(this.findAndReplaceModule.highlight(),this.findAndReplaceModule.selectCurrent()),{content:e,range:t,hash:this.hash(this.editor.innerHTML)}}saveHistory(){this.hash(this.editor.innerHTML)==this.history[this.history.length-1]?.hash&&this.history.pop(),this.history.length>=this.historyLimit&&this.history.shift();const e=this.snapshot();this.history.push(e)}undo(){if(0!=this.history.length){var e=this.history.pop();if(e.hash==this.hash(this.editor.innerHTML)&&0!=this.history.length&&(e=this.history.pop()),this.redoHistory.push(this.snapshot()),this.editor.innerHTML="",this.editor.append(...e.content.childNodes),null!=e.range){const t=this.deserializeRange(e.range,this.editor);window.getSelection().removeAllRanges(),window.getSelection().addRange(t)}0!=this.editor.getElementsByClassName("mimir-temp-cursor").length&&(this.currentCursor=this.editor.getElementsByClassName("mimir-temp-cursor")[0]),0==this.history.length&&this.saveHistory(),this.editor.dispatchEvent(new Event("mimiredited")),this.imageModule.deselect()}}redo(){if(0!=this.redoHistory.length){var e=this.redoHistory.pop();if(this.saveHistory(),e.hash==this.hash(this.editor.innerHTML)&&(e=this.redoHistory.pop()),this.editor.innerHTML="",this.editor.append(...e.content.childNodes),null!=e.range){const t=this.deserializeRange(e.range,editor);window.getSelection().removeAllRanges(),window.getSelection().addRange(t)}0!=this.editor.getElementsByClassName("mimir-temp-cursor").length&&(this.currentCursor=this.editor.getElementsByClassName("mimir-temp-cursor")[0]),this.editor.dispatchEvent(new Event("mimiredited")),this.imageModule.deselect()}}new(){for(this.history=[],this.redoHistory=[],this.shouldTakeSnapshotOnNextChange=!1,this.rangeCache=null,this.editor.innerHTML="",this.saveHistory();0!=this.imageObjectURLs.length;){const e=this.imageObjectURLs.pop();URL.revokeObjectURL(e)}}releaseImageURLs(){for(;0!=this.imageObjectURLs.length;){const e=this.imageObjectURLs.pop();URL.revokeObjectURL(e)}}async export(){function e(e){return new Promise(((t,n)=>{const i=new FileReader;i.onload=e=>t(i.result),i.onerror=e=>n(i.error),i.onabort=e=>n(new Error("Failed to read blob")),i.readAsDataURL(e)}))}const t=this.snapshot().content;if(t.querySelector(".mimir-temp-cursor")){for(var n=t.querySelector(".mimir-temp-cursor");n.parentNode!=t&&!this.blockTags.includes(n.parentNode.tagName);)n=n.parentNode;n.remove()}for(const n of t.querySelectorAll("img"))if(n.getAttribute("src")&&n.getAttribute("src").toLowerCase().startsWith("blob")){const t=await(await fetch(n.getAttribute("src"))).blob(),i=await e(t);n.setAttribute("src",i)}return{content:t.innerHTML}}import(e){const t=document.createElement("div");t.innerHTML=e.content;const n=[].concat(this.blockTags).concat(this.stylingTags).concat(this.contentTags).concat(["SPAN","A"]).map((e=>`:not(${e})`)).join("");if(t.querySelector(n))throw new Error("Invalid tag in document content. Ensure the document is valid.");const i=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT),o={A:["href"],IMG:["src"]};for(;i.nextNode();)if(o[i.currentNode.tagName]&&i.currentNode.hasAttributes()){for(const e of i.currentNode.attributes)if(!o[i.currentNode.tagName].includes(e.name.toLowerCase()))throw new Error("Invalid attribute in document content. Ensure the document is valid.");if("A"==i.currentNode.tagName&&i.currentNode.getAttribute("href")&&"javascript:"==i.currentNode.getAttribute("href").trim().substring(0,11).toLowerCase())throw new Error("Invalid attribute in document content. Ensure the document is valid.")}else if(i.currentNode.hasAttributes())for(const e of i.currentNode.attributes)if(!["style"].includes(e.name.toLowerCase()))throw new Error("Invalid attribute in document content. Ensure the document is valid.");this.new();for(const e of t.querySelectorAll("img"))if(e.getAttribute("src")&&e.getAttribute("src").toLowerCase().startsWith("data")){for(var s=e.getAttribute("src").split(",")[0].split(":")[1].split(";")[0],r=atob(e.getAttribute("src").split(",")[1]),a=[],l=0;l<r.length;l++)a.push(r.charCodeAt(l));const t=new Blob([new Uint8Array(a)],{type:s});var d=URL.createObjectURL(t);e.setAttribute("src",d),this.imageObjectURLs.push(d)}this.editor.append(...t.childNodes),this.history=[]}init(){this.currentZoom=1,this.history=[],this.redoHistory=[],this.shouldTakeSnapshotOnNextChange=!1,this.imageObjectURLs=[],this.rangeCache=null,this.ignoreNextSelectEvent=!1,this.container.innerHTML="",this.container.setAttribute("role","application"),this.container.setAttribute("aria-label","Editor"),this.createMenubar(),this.editorContainer=document.createElement("div"),this.editorContainer.setAttribute("id","mimir-body-container"),this.editor=document.createElement("div"),this.editor.setAttribute("id","mimir-body"),this.editor.setAttribute("contenteditable","true"),this.editor.setAttribute("spellcheck",!!this.spellcheck),this.editor.setAttribute("role","textbox"),this.editor.setAttribute("aria-label","Editor main editing area"),this.editor.setAttribute("tabindex","-1"),this.editorContainer.append(this.editor),this.container.append(this.editorContainer),this.saveHistory(),this.applySizeStyles(),this.applyDefaultFont(),this.applyDefaultSize(),this.bindKeyboardEvents(),this.bindInputEvents(),this.bindClickEvents(),this.bindSelectEvents(),this.bindPasteEvents(),this.bindDragEvents(),this.bindExternalClickEvents(),this.bindSaveHistoryInterval(),this.imageModule=this.MimirUI.bindImageEditing(this.editor,function(){this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0,this.editor.dispatchEvent(new Event("mimiredited"))}.bind(this)),this.findAndReplaceModule=this.MimirUI.findAndReplace(this.editor,function(){this.saveHistory(),this.shouldTakeSnapshotOnNextChange=!0,this.editor.dispatchEvent(new Event("mimiredited"))}.bind(this),this)}}},792:e=>{const t={};t.isTouchInput="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,t.dropdown=(e,t)=>{const n=document.createElement("div");n.classList.add("mimir-dropdown");const i=document.createElement("div");i.classList.add("mimir-dropdown-button"),n.append(i),i.append(e);const o=document.createElement("div");function s(e){"Escape"==e.key&&d()}function r(t){o.contains(t.target)||(o.classList.contains("mimir-dropdown-show")&&o.classList.remove("mimir-dropdown-show"),i.setAttribute("aria-expanded","false"),o.setAttribute("aria-hidden","true"),o.setAttribute("aria-disabled","true"),e.contains(t.target)&&(a=!0),document.removeEventListener("mousedown",r),n.dispatchEvent(new Event("editorDropdownClose",{bubbles:!0})),i.addEventListener("click",l),document.removeEventListener("keydown",s))}o.classList.add("mimir-dropdown-body"),n.append(o),o.append(t),o.setAttribute("role","dialog"),o.setAttribute("aria-hidden","true"),o.setAttribute("aria-disabled","true"),i.setAttribute("aria-haspopup","true"),i.setAttribute("aria-expanded","false"),i.addEventListener("mousedown",(function(e){e.preventDefault()}));var a=!1;function l(){if(a)return void(a=!1);i.removeEventListener("click",l),o.style.left="",o.classList.add("mimir-dropdown-show"),i.setAttribute("aria-expanded","true"),o.setAttribute("aria-hidden","false"),o.setAttribute("aria-disabled","false"),document.addEventListener("mousedown",r),document.addEventListener("keydown",s),n.dispatchEvent(new Event("editorDropdownOpen",{bubbles:!0}));const e=o.getBoundingClientRect();e.right>window.innerWidth&&e.right-window.innerWidth>1&&(o.style.left=Math.max(-(e.right-window.innerWidth),-e.left).toString()+"px")}function d(){o.classList.contains("mimir-dropdown-show")&&o.classList.remove("mimir-dropdown-show"),i.setAttribute("aria-expanded","false"),o.setAttribute("aria-hidden","true"),o.setAttribute("aria-disabled","true"),document.removeEventListener("mousedown",r),n.dispatchEvent(new Event("editorDropdownClose",{bubbles:!0})),i.addEventListener("click",l),document.removeEventListener("keydown",s)}return i.addEventListener("click",l),{dropdown:n,body:t,button:i,close:d}},t.dropdownList=(e,n)=>{if(0==e.length)return null;const i=document.createElement("button");i.classList.add("mimir-dropdown-list-open-button");var o=e[0].name;const s=[],r=document.createElement("div");for(const t of e){const e=t.content,i=t.name,o=document.createElement("button");o.append(e),s.push({name:i,button:o,content:e,buttonDisplay:t.buttonDisplay});const d=document.createElement("div");d.append(o),r.append(d),r.setAttribute("role","menuitem"),o.addEventListener("click",(e=>{l(i),n(i),a.close()}))}r.classList.add("mimir-dropdown-list-options");const a=t.dropdown(i,r);function l(e){s.some((t=>t.name==e))||(e=s[0]?.name),o=e,d()}function d(){i.innerHTML="";const e=s.find((e=>e.name==o));e&&(e.buttonDisplay?i.append(e.buttonDisplay.cloneNode(!0)):i.append(e.content.cloneNode(!0)),i.setAttribute("aria-valuetext",o))}return a.dropdown.classList.add("mimir-dropdown-list"),a.dropdown.setAttribute("role","listbox"),d(),{dropdown:a,getValue:function(){return o},setValue:l,list:a.dropdown}},t.numberInput=(e,t)=>{const n=document.createElement("input");n.setAttribute("type","number"),n.setAttribute("min",e),n.setAttribute("max",t),n.classList.add("mimir-number-input-input");const i=document.createElement("button");i.innerHTML="+",i.addEventListener("click",(function(){n.value=Math.max(Math.min(parseFloat(n.value)+1,t),e),n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))})),i.classList.add("mimir-number-input-button");const o=document.createElement("button");o.innerHTML="-",o.addEventListener("click",(function(){n.value=Math.max(Math.min(parseFloat(n.value)-1,t),e),n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))})),o.classList.add("mimir-number-input-button");const s=document.createElement("div");return s.append(o,n,i),s.classList.add("mimir-number-input"),{numberInput:s,input:n,plus:i,minus:o}},t.rgbToHsv=(e,t,n)=>{e/=255,t/=255,n/=255;var i=Math.max(e,Math.max(t,n)),o=Math.min(e,Math.min(t,n)),s=i-o,r=-1;return i==o?r=0:i==e?r=((t-n)/s*60+360)%360:i==t?r=((n-e)/s*60+120)%360:i==n&&(r=((e-t)/s*60+240)%360),[r,0==i?0:s/i*100,100*i]},t.colorInput=(e,n,i,o,r)=>{const a=document.createElement("div");a.classList.add("mimir-color-input-body");const l=document.createElement("div"),d=document.createElement("div");d.style.width=i+"px",d.style.height=r+"px",d.setAttribute("role","slider"),d.classList.add("mimir-color-picker-primary-container");const c=document.createElement("canvas");c.setAttribute("width",i),c.setAttribute("height",r),c.setAttribute("role","presentation"),c.classList.add("mimir-color-picker-primary-canvas"),d.append(c);const u=document.createElement("div");u.classList.add("mimir-color-picker-primary-thumb"),u.setAttribute("role","presentation"),d.append(u),l.append(d);const m=document.createElement("div");m.style.width=o+"px",m.style.height=r+"px",m.setAttribute("role","slider"),m.classList.add("mimir-color-picker-hue-container");const h=document.createElement("canvas");h.setAttribute("width",o),h.setAttribute("height",r),h.setAttribute("role","presentation"),h.classList.add("mimir-color-picker-hue-canvas"),m.append(h);const p=document.createElement("div");p.classList.add("mimir-color-picker-hue-slider"),p.setAttribute("role","presentation"),m.append(p),l.append(m);const g=document.createElement("div");g.classList.add("mimir-color-picker-rgb-form");const f=document.createElement("div");function b(e,n){const o=document.createElement("div");o.classList.add("mimir-color-picker-rgb-form-input-container");const s=document.createElement("label");s.append(e),s.setAttribute("aria-label",n),s.classList.add("mimir-color-picker-rgb-form-input-label");const a=document.createElement("input");return a.setAttribute("type","number"),a.setAttribute("min","0"),a.setAttribute("max","255"),a.addEventListener("change",(()=>{M=N.value,H=E.value,I=w.value,M=Math.min(Math.max(parseInt(M),0),255),H=Math.min(Math.max(parseInt(H),0),255),I=Math.min(Math.max(parseInt(I),0),255),N.value=M,E.value=H,w.value=I;var[e,n,o]=t.rgbToHsv(M,H,I);R=e,z=n/100*i,B=r-o/100*r,D.fillStyle=`hsl(${R}deg 100% 50%)`,D.fillRect(0,0,i,r);var s=D.createLinearGradient(0,0,i,0);s.addColorStop(0,"rgba(255, 255, 255, 1)"),s.addColorStop(1,"rgba(255, 255, 255, 0)"),D.fillStyle=s,D.fillRect(0,0,i,r);var a=D.createLinearGradient(0,0,0,r);a.addColorStop(0,"rgba(0, 0, 0, 0)"),a.addColorStop(1,"rgba(0, 0, 0, 1)"),D.fillStyle=a,D.fillRect(0,0,i,r),u.style.backgroundColor=`rgb(${M}, ${H}, ${I})`,u.style.transform=`translate(${z-5}px, ${B-5}px`,f.style.backgroundColor=`rgb(${M}, ${H}, ${I})`,p.style.transform=`translate(0, ${R/360*r}px`})),o.append(s,a),[o,a]}f.setAttribute("role","presentation"),f.classList.add("mimir-color-picker-rgb-form-color"),g.append(f);const[y,N]=b("R","Red component"),[C,E]=b("G","Green component"),[x,w]=b("B","Blue component");g.append(y,C,x),l.append(g),a.append(l),l.classList.add("mimir-color-picker-row");const T=document.createElement("div"),S=document.createElement("button");S.classList.add("mimir-color-picker-save-button","mimir-action-button-primary"),S.innerHTML="Save",S.addEventListener("click",(()=>{e(`rgb(${M}, ${H}, ${I})`),O()})),S.setAttribute("title","Save Color");const A=document.createElement("button");A.classList.add("mimir-color-picker-remove-button","mimir-action-button-secondary"),A.innerHTML="Remove",A.addEventListener("click",(()=>{e(null),O()})),A.setAttribute("title","Remove Color"),T.append(S,A),a.append(T),T.classList.add("mimir-color-picker-row"),n.classList.add("mimir-color-picker-button");const L=t.dropdown(n,a),k=L.dropdown,O=L.close;var R=0,M=255,H=0,I=0,z=0,B=0,D=c.getContext("2d",{willReadFrequently:!0}),U=h.getContext("2d"),P=!1,V=!1;function _(){D.fillStyle=`hsl(${R}deg 100% 50%)`,D.fillRect(0,0,i,r);var e=D.createLinearGradient(0,0,i,0);e.addColorStop(0,"rgba(255, 255, 255, 1)"),e.addColorStop(1,"rgba(255, 255, 255, 0)"),D.fillStyle=e,D.fillRect(0,0,i,r);var n=D.createLinearGradient(0,0,0,r);n.addColorStop(0,"rgba(0, 0, 0, 0)"),n.addColorStop(1,"rgba(0, 0, 0, 1)"),D.fillStyle=n,D.fillRect(0,0,i,r),[M,H,I]=D.getImageData(z,B,1,1).data,u.style.backgroundColor=`rgb(${M}, ${H}, ${I})`,u.style.transform=`translate(${z-5}px, ${B-5}px`,f.style.backgroundColor=`rgb(${M}, ${H}, ${I})`,N.value=M,E.value=H,w.value=I,[R,s,v]=t.rgbToHsv(M,H,I),c.setAttribute("aria-valuetext",`Saturation: ${s}, Value: ${v}`)}function F(e){if(e.touches){const t=c.getBoundingClientRect();z=Math.min(Math.max(e.touches[0].clientX-t.x,0),i-1),B=Math.max(Math.min(e.touches[0].clientY-t.y,r-1),0)}else{const t=c.getBoundingClientRect();z=Math.min(Math.max(e.clientX-t.x,0),i-1),B=Math.max(Math.min(e.clientY-t.y,r-1),0)}[M,H,I]=D.getImageData(z,B,1,1).data,u.style.backgroundColor=`rgb(${M}, ${H}, ${I})`,u.style.transform=`translate(${z-5}px, ${B-5}px`,f.style.backgroundColor=`rgb(${M}, ${H}, ${I})`,N.value=M,E.value=H,w.value=I}function q(e){P=!0,F(e),document.addEventListener("mouseup",$),document.addEventListener("touchend",$),document.addEventListener("mousemove",j,!1),document.addEventListener("mouseup",$,!1),document.addEventListener("touchmove",j,!1),document.addEventListener("touchend",$,!1)}function j(e){e.preventDefault(),P&&F(e)}function $(e){P=!1,document.removeEventListener("mouseup",$),document.removeEventListener("touchend",$),document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",$),document.removeEventListener("touchmove",j),document.removeEventListener("touchend",$)}function X(e){if(e.touches){const t=h.getBoundingClientRect(),n=Math.max(Math.min(e.touches[0].clientY-t.y,r),0);R=n/r*360,p.style.transform=`translate(0, ${n}px`}else{const t=h.getBoundingClientRect(),n=Math.max(Math.min(e.clientY-t.y,r),0);R=n/r*360,p.style.transform=`translate(0, ${n}px`}_()}function W(e){V=!0,X(e),document.addEventListener("mouseup",G),document.addEventListener("touchend",G),document.addEventListener("mousemove",K,!1),document.addEventListener("mouseup",G,!1),document.addEventListener("touchmove",K,!1),document.addEventListener("touchend",G,!1)}function K(e){e.preventDefault(),V&&X(e)}function G(e){V=!1,document.removeEventListener("mouseup",G),document.removeEventListener("touchend",G),document.removeEventListener("mousemove",K),document.removeEventListener("mouseup",G),document.removeEventListener("touchmove",K),document.removeEventListener("touchend",G)}return k.addEventListener("editorDropdownOpen",(function(){_(),function(){U.rect(0,0,o,r);var e=U.createLinearGradient(0,0,0,r);e.addColorStop(0,"rgba(255, 0, 0, 1)"),e.addColorStop(.17,"rgba(255, 255, 0, 1)"),e.addColorStop(.34,"rgba(0, 255, 0, 1)"),e.addColorStop(.51,"rgba(0, 255, 255, 1)"),e.addColorStop(.68,"rgba(0, 0, 255, 1)"),e.addColorStop(.85,"rgba(255, 0, 255, 1)"),e.addColorStop(1,"rgba(255, 0, 0, 1)"),U.fillStyle=e,U.fill(),c.setAttribute("aria-valuetext",`Hue: ${R} degrees`)}(),c.addEventListener("mousedown",q),c.addEventListener("touchstart",q),h.addEventListener("mousedown",W),h.addEventListener("touchstart",W)})),k.addEventListener("editorDropdownClose",(function(){c.removeEventListener("mousedown",q),c.removeEventListener("touchstart",q),h.removeEventListener("mousedown",W),h.removeEventListener("touchstart",W)})),{colorInput:k,dropdown:L,getValue:function(){return`rgb(${M}, ${H}, ${I})`}}},t.linkInput=(e,n)=>{const i=document.createElement("div");i.classList.add("mimir-link-input-body");const o=document.createElement("h4");o.innerHTML="Insert Link",o.classList.add("mimir-modal-label");const s=document.createElement("input");s.classList.add("mimir-link-input-input","mimir-modal-input"),s.setAttribute("placeholder","URL"),s.setAttribute("type","url"),i.append(o,s),n.classList.add("mimir-link-input-button");const r=t.dropdown(n,i),a=r.dropdown,l=r.close;var d=null;const c=document.createElement("button");c.classList.add("mimir-link-input-save-button","mimir-action-button-primary"),c.innerHTML="Save",c.addEventListener("click",(()=>{e(s.value),d=s.value,l(),s.value=""})),c.setAttribute("title","Save Link");const u=document.createElement("button");u.classList.add("mimir-link-input-remove-button","mimir-action-button-secondary"),u.innerHTML="Remove",u.addEventListener("click",(()=>{e(null),l()})),u.setAttribute("title","Remove Link");const m=document.createElement("div");return m.classList.add("mimir-modal-row"),m.append(c,u),i.append(m),{linkInput:a,dropdown:r,getValue:function(){return d}}},t.imageInput=(e,n,i)=>{const o=document.createElement("div");o.classList.add("mimir-image-input-body");const s=document.createElement("h4");s.innerHTML="Insert Image",s.classList.add("mimir-modal-label");const r=document.createElement("input");r.classList.add("mimir-image-input-input"),r.setAttribute("type","file"),r.setAttribute("accept","image/jpeg, image/png, image/gif, image/bmp, image/webp, image/tiff");const a=document.createElement("input");a.classList.add("mimir-image-url-input","mimir-modal-input"),a.setAttribute("placeholder","URL"),a.setAttribute("type","url");const l=document.createElement("input");l.classList.add("mimir-image-alt-input","mimir-modal-input"),l.setAttribute("placeholder","Alt Text"),o.append(s,r,a,l),n.classList.add("mimir-image-input-button");const d=t.dropdown(n,o),c=d.dropdown,u=d.close,m=document.createElement("button");m.classList.add("mimir-image-input-save-button"),m.innerHTML="Insert",m.addEventListener("click",(()=>{if(0!=r.files.length){const t=URL.createObjectURL(r.files[0]);e(t,l.value?l.value:r.files[0].name),i.push(t)}else a.value&&e(a.value,l.value?l.value:a.value.split("/").pop());r.value=null,a.value="",u()})),m.setAttribute("title","Insert Image"),m.classList.add("mimir-action-button-primary");const h=document.createElement("div");return h.classList.add("mimir-modal-row"),h.append(m),o.append(h),{imageInput:c,dropdown:d}},t.bindImageEditing=(e,t)=>{const n=document.createElement("div");n.setAttribute("id","mimir-image-editing-ui"),e.after(n);const i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),r=document.createElement("div");i.classList.add("resize-bar","resize-bar-horizontal","resize-bar-top"),o.classList.add("resize-bar","resize-bar-horizontal","resize-bar-bottom"),s.classList.add("resize-bar","resize-bar-vertical","resize-bar-left"),r.classList.add("resize-bar","resize-bar-vertical","resize-bar-right"),n.append(i,o,s,r);const a=document.createElement("div"),l=document.createElement("div"),d=document.createElement("div"),c=document.createElement("div");a.classList.add("resize-box","resize-box-top-right"),l.classList.add("resize-box","resize-box-top-left"),d.classList.add("resize-box","resize-box-bottom-right"),c.classList.add("resize-box","resize-box-bottom-left"),a.setAttribute("unselectable","true"),l.setAttribute("unselectable","true"),d.setAttribute("unselectable","true"),c.setAttribute("unselectable","true"),n.append(a,l,d,c);var u,m,h=null,p=null,g=null,f=0,b=0;function y(t){h=t,a.style.display="block",l.style.display="block",d.style.display="block",c.style.display="block",i.style.display="block",o.style.display="block",s.style.display="block",r.style.display="block",x();const n=getComputedStyle(h),u=parseInt(n.width.slice(0,-2)),p=parseInt(n.height.slice(0,-2));m=u,b=p,window.addEventListener("resize",x),e.parentNode.addEventListener("scroll",x),h.classList.add("mimir-hide-selection"),document.getSelection().removeAllRanges()}function N(){h&&(h.classList.remove("mimir-hide-selection"),h=null,a.style.display="none",l.style.display="none",d.style.display="none",c.style.display="none",i.style.display="none",o.style.display="none",s.style.display="none",r.style.display="none",window.removeEventListener("resize",x),e.parentNode.removeEventListener("scroll",x))}function v(e,t,n){return e>n.left&&e<n.right&&t>n.top&&t<n.bottom}function C(e,t,n,i,o){n<o.top||n>o.bottom?e.style.display="none":(e.style.display="block",t<o.left&&(i-=Math.max(o.left-t,0),t=o.left),t+i>o.right&&(i=o.right-t),0!=i?(e.style.left=t+"px",e.style.top=n+"px",e.style.width=i+"px"):e.style.display="none")}function E(e,t,n,i,o){t<o.left||t>o.right?e.style.display="none":(e.style.display="block",n<o.top&&(i-=Math.max(o.top-n,0),n=o.top),n+i>o.bottom&&(i=o.bottom-n),0!=i?(e.style.left=t+"px",e.style.top=n+"px",e.style.height=i+"px"):e.style.display="none")}function x(){if(!h)return;const t=h.getBoundingClientRect(),n=e.parentNode.getBoundingClientRect(),u=document.documentElement.scrollTop;l.style.left=t.left-5+"px",l.style.top=t.top+u-5+"px",a.style.left=t.left+t.width-5+"px",a.style.top=t.top+u-5+"px",c.style.left=t.left-5+"px",c.style.top=t.bottom+u-5+"px",d.style.left=t.left+t.width-5+"px",d.style.top=t.bottom+u-5+"px",C(i,t.left,t.top+u,t.width,n),C(o,t.left,t.bottom+u,t.width,n),E(s,t.left,t.top+u,t.height,n),E(r,t.left+t.width,t.top+u,t.height,n),v(t.left,t.top+u,n)?l.style.display="block":l.style.display="none",v(t.right,t.top+u,n)?a.style.display="block":a.style.display="none",v(t.left,t.bottom+u,n)?c.style.display="block":c.style.display="none",v(t.right,t.bottom+u,n)?d.style.display="block":d.style.display="none"}function w(e){h&&(e.preventDefault(),e.touches&&(e=e.touches[0]),p=e.target,u=e.clientX,f=e.clientY)}function T(e){if(!h)return;if(!p)return;e.preventDefault(),e.touches&&(e=e.touches[0]);const t=e.clientX-u,n=e.clientY-f;u=e.clientX,f=e.clientY;const i=Math.sqrt(m*m+b*b),o=m/i,s=b/i;switch(p){case l:m-=t,b-=n;var r=Math.sqrt(m*m+b*b);m=o*r,b=s*r,h.style.width=m+"px",h.style.height=b+"px";break;case a:m+=t,b-=n,r=Math.sqrt(m*m+b*b),m=o*r,b=s*r,h.style.width=m+"px",h.style.height=b+"px";break;case c:m-=t,b+=n,r=Math.sqrt(m*m+b*b),m=o*r,b=s*r,h.style.width=m+"px",h.style.height=b+"px";break;case d:m+=t,b+=n,r=Math.sqrt(m*m+b*b),m=o*r,b=s*r,h.style.width=m+"px",h.style.height=b+"px"}x()}function S(e){h&&p&&(p=null,t())}function A(e){e.addEventListener("mousedown",w),e.addEventListener("touchstart",w)}function L(e){h&&(e.preventDefault(),e.touches&&(e=e.touches[0]),g=e.target,u=e.clientX,f=e.clientY)}function k(e){if(!h)return;if(!g)return;e.preventDefault(),e.touches&&(e=e.touches[0]);const t=e.clientX-u,n=e.clientY-f;switch(u=e.clientX,f=e.clientY,g){case s:m-=t,h.style.width=m+"px",h.style.height=b+"px";break;case r:m+=t,h.style.width=m+"px",h.style.height=b+"px";break;case i:case o:b+=n,h.style.width=m+"px",h.style.height=b+"px"}x()}function O(e){h&&g&&(g=null,t())}function R(e){e.addEventListener("mousedown",L),e.addEventListener("touchstart",L)}return A(a),A(l),A(d),A(c),document.addEventListener("mousemove",T),document.addEventListener("mouseup",S),document.addEventListener("touchmove",T),document.addEventListener("touchend",S),R(i),R(s),R(r),R(o),document.addEventListener("mousemove",k),document.addEventListener("mouseup",O),document.addEventListener("touchmove",k),document.addEventListener("touchend",O),e.addEventListener("mousedown",(e=>{e.target!=h&&(n.contains(e.target)||(e.target!=h&&h&&N(),"IMG"==e.target.tagName&&y(e.target)))})),document.addEventListener("selectionchange",(e=>{h&&document.getSelection().rangeCount&&N()})),window.addEventListener("mousedown",(t=>{e.parentNode&&e.parentNode.contains(t.target)||n.contains(t.target)||N()})),document.addEventListener("keydown",(e=>{h&&("Delete"!=e.key&&"Backspace"!=e.key||(h.remove(),N()))})),e.addEventListener("keydown",(e=>{if("c"==e.key&&(e.ctrlKey||e.metaKey)&&h&&0==document.getSelection().rangeCount){const e=new Range;e.selectNode(h),document.getSelection().removeAllRanges(),document.getSelection().addRange(e)}else if("x"==e.key&&(e.ctrlKey||e.metaKey)&&h&&0==document.getSelection().rangeCount){const e=new Range;e.selectNode(h),document.getSelection().removeAllRanges(),document.getSelection().addRange(e),N()}else if("v"==e.key&&(e.ctrlKey||e.metaKey)&&h&&0==document.getSelection().rangeCount){const e=new Range;e.selectNode(h),document.getSelection().removeAllRanges(),document.getSelection().addRange(e),h.remove(),N()}else if("ArrowLeft"==e.key&&h&&0==document.getSelection().rangeCount){const e=new Range;e.selectNode(h),e.collapse(!0),document.getSelection().removeAllRanges(),document.getSelection().addRange(e),N()}else if("ArrowRight"==e.key&&h&&0==document.getSelection().rangeCount){const e=new Range;e.selectNode(h),e.collapse(!1),document.getSelection().removeAllRanges(),document.getSelection().addRange(e),N()}else if("ArrowUp"==e.key&&h&&0==document.getSelection().rangeCount){const e=new Range;e.selectNode(h),e.collapse(!1),document.getSelection().removeAllRanges(),document.getSelection().addRange(e),N()}else if("ArrowDown"==e.key&&h&&0==document.getSelection().rangeCount){const e=new Range;e.selectNode(h),e.collapse(!1),document.getSelection().removeAllRanges(),document.getSelection().addRange(e),N()}})),{getSelected:()=>h,select:e=>{y(e)},deselect:()=>{N()}}},t.findAndReplace=(e,t,n)=>{const i=document.createElement("div");i.setAttribute("id","mimir-find-and-replace-ui"),i.setAttribute("aria-hidden","true"),i.setAttribute("aria-disabled","true"),e.before(i);const o=document.createElement("div");o.classList.add("mimir-modal-row");const s=document.createElement("input");s.classList.add("mimir-find-and-replace-find-input","mimir-modal-input"),s.setAttribute("placeholder","Search for"),o.append(s);const r=document.createElement("button");r.classList.add("mimir-find-and-replace-find-button","mimir-action-button-primary"),r.innerHTML="Find",r.setAttribute("title","Find"),o.append(r);const a=document.createElement("button");a.classList.add("mimir-find-and-replace-find-up-button","mimir-action-button-secondary"),a.innerHTML="&#9650;",a.setAttribute("title","Find Up"),o.append(a);const l=document.createElement("button");l.classList.add("mimir-find-and-replace-find-down-button","mimir-action-button-secondary"),l.innerHTML="&#9660;",l.setAttribute("title","Find Down"),o.append(l);const d=document.createElement("button");d.classList.add("mimir-find-and-replace-toggle-case-sensitive-button"),d.innerHTML="Aa",d.classList.toggle("mimir-toggled",!0),d.setAttribute("title","Toggle Case Sensitive"),d.setAttribute("aria-pressed","true"),o.append(d),i.append(o);const c=document.createElement("div");c.classList.add("mimir-modal-row");const u=document.createElement("input");u.classList.add("mimir-find-and-replace-replace-input","mimir-modal-input"),u.setAttribute("placeholder","Replace with"),c.append(u);const m=document.createElement("button");m.classList.add("mimir-find-and-replace-replace-button","mimir-action-button-primary"),m.setAttribute("title","Replace"),m.innerHTML="Replace",c.append(m);const h=document.createElement("button");h.classList.add("mimir-find-and-replace-replace-all-button","mimir-action-button-primary"),h.innerHTML="Replace All",h.setAttribute("title","Replace All"),c.append(h),i.append(c);var p=!1,g=null,f=null,b=null,y=!1,N=!0;function v(){const t=i.getBoundingClientRect(),n=e.parentNode.getBoundingClientRect();i.style.left=n.right-t.width+"px",i.style.top=n.top+"px"}function C(){p=!1,i.style.display="none",n.menubarOptions.openFindAndReplace.setAttribute("aria-expanded","false"),i.setAttribute("aria-expanded","false"),i.setAttribute("aria-hidden","true"),i.setAttribute("aria-disabled","true"),w()}function E(e){"Escape"==e.key&&C()}function x(e){i.contains(e.target)||("flex"==i.style.display&&C(),document.removeEventListener("mousedown",x),document.removeEventListener("keydown",E),n.menubarOptions.openFindAndReplace&&n.menubarOptions.openFindAndReplace.contains(e.target)&&(y=!0))}function w(){f&&(O(g),g=null,f=null,b=null)}function T(){if(w(),""==s.value)return f=null,g=null,b=0,a.disabled=!0,l.disabled=!0,m.disabled=!0,void(h.disabled=!0);(g=S(s.value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")))&&(g=function(e){for(const t of e.reverse())for(const e of t){const t=document.createTextNode(e.node.data.slice(e.endOffset,e.node.data.length));e.node.after(t);const n=document.createTextNode(e.node.data.slice(e.startOffset,e.endOffset));e.node.after(n),e.node.data=e.node.data.slice(0,e.startOffset),e.node=n,e.startOffset=0,e.endOffset=0}return e.reverse(),e}(g),f=s.value,g=k(g),b=0,g[b]?.forEach((e=>e.wrapper.classList.add("mimir-find-and-replace-current"))),a.disabled=!1,l.disabled=!1,m.disabled=!1,h.disabled=!1,g[b]&&g[b][0].wrapper?.scrollIntoView(!1))}function S(t){const n=["BR","DIV","P","OL","UL","LI","H1","H2","H3","H4","H5","H6","BLOCKQUOTE","HR"];if(!e.firstChild)return;var i=e.textContent.split(" ").join(" ");N||(i=i.toLowerCase(),t=t.toLowerCase());const o=i.matchAll(t),s=[];function r(t,i){var o=e.firstChild,s=0;const r=[];for(var a=!1;s<i;){if(a&&n.includes(o.tagName))return null;if(s+o.textContent.length>t)if(o.nodeType==Node.TEXT_NODE){const e=Math.max(t-s,0),n=Math.min(i-s,o.data.length);r.push({node:o,startOffset:e,endOffset:n}),a=!0}else if(o.firstChild){o=o.firstChild;continue}if(s+=o.textContent.length,o.nextSibling)o=o.nextSibling;else{for(;!o.nextSibling;)if((o=o.parentNode)==e)return r;o=o.nextSibling}}return r}for(const e of o){const t=r(e.index,e.index+e[0].length);null!=t&&s.push(t)}return s}function A(){const e=document.createElement("span");return e.classList.add("mimir-find-and-replace-match"),e}function L(t){function i(t,i){for(var o=t;n.inEditor(o.parentNode)&&o.parentNode!=e&&n.isEmpty(o.parentNode)&&(n.inlineStylingTags.includes(o.parentNode.tagName)||"SPAN"==o.parentNode.tagName);)o=o.parentNode;if(i){const e=n.leftSiblingIgnoreEmpty(o),t=n.rightSiblingIgnoreEmpty(o);if(n.blockTags.includes(o.parentNode.tagName)&&n.isEmpty(o.parentNode)&&!n.childlessTags.includes(o.parentNode.tagName))o.before(document.createElement("BR"));else if(e&&n.blockTags.includes(e.tagName)&&(!t||n.blockTags.includes(t.tagName))||t&&n.blockTags.includes(t.tagName)&&(!e||n.blockTags.includes(e.tagName))){t&&"BR"==t.tagName&&t.remove(),e&&"BR"==e.tagName&&e.remove();const n=document.createElement("div");n.append(document.createElement("br")),o.before(n)}}return o.remove(),o}if(g[b]){const e=g[b];e[0].node.textContent=t,e[0].wrapper&&""!=t&&(e[0].wrapper.after(e[0].node),e[0].wrapper.remove());for(const t of e.slice(1,-1))i(t.node,!1),t.node.remove(),t.wrapper&&t.wrapper.remove();""==t&&i(e[0].node,!0),g.splice(b,1),b%=g.length,g[b]?.forEach((e=>e.wrapper.classList.add("mimir-find-and-replace-current"))),g[b]&&g[b][0].wrapper?.scrollIntoView(!1)}}function k(e){for(const t of e)for(const e of t)e.wrapper=A(),e.node.after(e.wrapper),e.wrapper.append(e.node);return e}function O(e){for(const t of e)for(const e of t)e.wrapper&&(e.wrapper.after(e.node),e.wrapper.remove());return e}return d.addEventListener("click",(function(e){N=!N,d.classList.toggle("mimir-toggled",N),d.setAttribute("aria-pressed",""+N),f&&T()})),window.addEventListener("resize",(()=>{p&&v()})),r.addEventListener("click",T),a.addEventListener("click",(function(){g[b]?.forEach((e=>e.wrapper.classList.remove("mimir-find-and-replace-current"))),-1==(b-=1)&&(b=g.length-1),g[b]?.forEach((e=>e.wrapper.classList.add("mimir-find-and-replace-current"))),g[b]&&g[b][0].wrapper?.scrollIntoView(!1)})),l.addEventListener("click",(function(){g[b]?.forEach((e=>e.wrapper.classList.remove("mimir-find-and-replace-current"))),b=(b+1)%g.length,g[b]?.forEach((e=>e.wrapper.classList.add("mimir-find-and-replace-current"))),g[b]&&g[b][0].wrapper?.scrollIntoView(!1)})),m.addEventListener("click",(function(){L(u.value),t()})),h.addEventListener("click",(function(){for(;0!=g.length;)L(u.value),t()})),{open:function(){y?y=!1:(p=!0,i.style.display="flex",n.menubarOptions.openFindAndReplace.setAttribute("aria-expanded","true"),i.setAttribute("aria-hidden","false"),i.setAttribute("aria-disabled","false"),s.value="",a.disabled=!0,l.disabled=!0,u.value="",m.disabled=!0,h.disabled=!0,document.addEventListener("mousedown",x),document.addEventListener("keydown",E),s.focus(),v())},close:C,find:S,highlight:function(){k(g)},unhighlight:function(){O(g)},isOpen:function(){return!!g},getMatches:function(){return g},getCurrent:function(){return b},selectCurrent:function(){g[b]&&g[b]?.forEach((e=>e.wrapper.classList.add("mimir-find-and-replace-current")))}}},e.exports=t}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={id:i,exports:{}};return e[i](s,s.exports,n),s.exports}return n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nc=void 0,n(556)})()));